(function(a){function cO(c){if(!c||!c.denied||!a.isFunction(c.denied))return cf(this,g.InvalidArguments,"showUserAuthorization: wrong arguments");document.hidden&&!c.force?(bg("showUserAuthorization deferred with visibilityState: "+document.visibilityState),bi(document,"visibilitychange",function d(){document.hidden||(bg("showUserAuthorization detected visibilitychange from hidden to "+document.visibilityState),cO(c),bj(document,"visibilitychange",d))})):bm("showUserAuthorization",function(){b.deniedCb=c.denied,b.userAuthStatus="UserAuthPending"})}function cN(){var a=bq();if(!a.capabilities.delayedUserAuth){cf(this,g.OperationNotSupported,'Check cwic("about").capabilities.delayedUserAuth');return"Unknown"}return b.userAuthStatus}function cM(a){var b={window:cJ.frame,element:cJ.element};bg(!0,'Sending new "dock" message with parameters: ',b),cK(b)}function cL(){bg(!1,"Undocking ...");var a=this;cJ.hasDockingCapabilities()&&cJ.isDocked?(bg(!0,"undock",arguments),cJ.resetPosition(),bg(!0,"Setting isDocked to false"),cJ.isDocked=!1,bm("undockExternalWindow")):cJ.hasDockingCapabilities()||cf(a,g.DockingCapabilitiesNotAvailable);return a}function cK(a){var b=this,c=a?a.window:window,d=a?a.element:b[0];cJ._about=bq(),cJ.hasDockingCapabilities()&&d instanceof c.HTMLElement?(cJ.isDocked=!0,bg(!0,"dock",arguments),cJ.resetPosition(),cJ.frame=c,cJ.element=d,cJ.sendMessageToAddOn("dockExternalWindow",cJ.updateOffsets(cJ.element.getBoundingClientRect())),cJ.frame.requestAnimationFrame(cJ.move)):cJ.hasDockingCapabilities()?d instanceof c.HTMLElement||cf(b,g.DockArgumentNotHTMLElement):cf(b,g.DockingCapabilitiesNotAvailable);return b}function cI(){v?(bg(!0,"setExternalWindowTitle"),typeof arguments[0]=="string"&&bm("setExternalWindowTitle",{title:arguments[0]})):bg(!1,"returning from setExternalWindowTitle ... not supported in the current state")}function cH(a){v?(bg(!0,"setExternalWindowShowSelfViewPipBorder"),typeof a=="boolean"&&bm("setExternalWindowShowSelfViewPipBorder",{showSelfViewPipBorder:a})):bg(!1,"returning from setExternalWindowShowSelfViewPipBorder ... not supported in the current state")}function cG(a){v?(bg(!0,"setExternalWindowSelfViewPipPosition"),cF(a)):bg(!1,"returning from setExternalWindowShowControls ... not supported in the current state")}function cF(a){if(!p(a))bg(!1,"setExternalWindowSelfViewPipPosition expects object as an argument");else{var b=parseInt(a.topLeftX,10),c=parseInt(a.topLeftY,10),d=parseInt(a.bottomRightX,10),e=parseInt(a.bottomRightY,10);if(!r(b)||!r(c)||!r(d)||!r(e)){bg(!1,"setExternalWindowSelfViewPipPosition invalid arguments ... expecting numbers from 0 to 100");return}bm("setExternalWindowSelfViewPipPosition",{pipLeft:b,pipTop:c,pipRight:d,pipBottom:e})}}function cE(a){v?(bg(!0,"setExternalWindowShowControls"),typeof a=="boolean"&&bm("setExternalWindowShowControls",{showControls:a})):bg(!1,"returning from setExternalWindowShowControls ... not supported in the current state")}function cD(){v?(bg(!0,"setExternalWindowShowSelfViewPip"),typeof arguments[0]=="boolean"&&bm("setExternalWindowShowSelfViewPip",{showSelfViewPip:arguments[0]})):bg(!1,"returning from setExternalWindowShowSelfViewPip ... not supported in the current state")}function cC(){v?(bg(!0,"setExternalWindowAlwaysOnTop"),typeof arguments[0]=="boolean"&&bm("setExternalWindowAlwaysOnTop",{alwaysOnTop:arguments[0]})):bg(!1,"returning from setExternalWindowAlwaysOnTop ... not supported in the current state")}function cB(){v?(bg(!0,"hideExternalWindow"),cJ.isVideoBeingReceived=!1,bm("hideExternalWindow")):bg(!1,"returning from hideExternalWindow ... not supported in the current state")}function cA(){v?(bg(!0,"getExternalWindowState"),bm("getExternalWindowState")):bg(!1,"returning from getExternalWindowState ... not supported in the current state")}function cz(){v?(bg(!0,"showPreviewInExternalWindow"),cJ.isVideoBeingReceived=!0,bm("showPreviewInExternalWindow")):bg(!1,"returning from showPreviewInExternalWindow ... not supported in the current state")}function cy(){bg(!0,"showCallInExternalWindow");var a=this,b=a.data("cwic"),c=b?b.id:null;arguments.length>0&&(typeof arguments[0]=="object"?(b=arguments[0],c=b.id):typeof arguments[0]=="string"&&(c=arguments[0]));if(!c)return cf(a,g.InvalidArguments,"wrong arguments (showCallInExternalWindow)",arguments);cJ.isVideoBeingReceived=!0,bm("showCallInExternalWindow",{callId:c})}function cx(){bg(!0,"setCaptureDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cf(a,g.InvalidArguments,"wrong arguments (setCaptureDevice)",arguments);bm("setCaptureDevice",{clientCaptureID:b}),bm("getMultimediaDevices",function(b){bR(a,b)})}function cw(){bg(!0,"setPlayoutDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cf(a,g.InvalidArguments,"wrong arguments (setPlayoutDevice)",arguments);bm("setPlayoutDevice",{clientPlayoutID:b}),bm("getMultimediaDevices",function(b){bR(a,b)})}function cv(a,b){s()?bg(!1,"getMultimediaDeviceVolume works only on Windows platform for now..."):(a!=="Speaker"&&a!=="Microphone"&&a!=="Ringer"&&bg(!1,'getMultimediaDeviceVolume received wrong "device" parameter. Must be one of ("Speaker", "Microphone", "Ringer") and received: '+a),v?bm("getMultimediaDeviceVolume",{device:a},b):bg(!0,"getMultimediaDeviceVolume: Mutimedia services not started, returning..."))}function cu(){s()?bg(!1,"setPlayRingerOnAllDevices works only on Windows platform for now..."):bm("setPlayRingerOnAllDevices")}function ct(a){s()?bg(!1,"setRingtone works only on Windows platform for now..."):bm("setCurrentRingtone",{ringtone:a})}function cs(b){if(s())bg(!1,"setMicrophoneVolume works only on Windows platform for now...");else{var c=parseInt(b.microphoneVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bm("setCurrentMicrophoneVolume",{volume:c},d,e)}}function cr(b){if(s())bg(!1,"setRingerVolume works only on Windows platform for now...");else{var c=parseInt(b.ringerVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bm("setCurrentRingerVolume",{volume:c},d,e)}}function cq(b){if(s())bg(!1,"setPlayRingerOnAllDevices works only on Windows platform for now...");else{var c=parseInt(b.speakerVolume,10),d=a.isFunction(b.success)?b.success:a.noop,e=a.isFunction(b.error)?b.error:a.noop;bm("setCurrentSpeakerVolume",{volume:c},d,e)}}function cp(){bg(!0,"setRingerDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cf(a,g.InvalidArguments,"wrong arguments (setRingerDevice)",arguments);bm("setRingerDevice",{clientRingerID:b}),bm("getMultimediaDevices",function(b){bR(a,b)})}function co(){bg(!0,"setRecordingDevice",arguments);var a=this,b=arguments[0];if(typeof b!="string"||b.length===0)return cf(a,g.InvalidArguments,"wrong arguments (setRecordingDevice)",arguments);bm("setRecordingDevice",{clientRecordingID:b}),bm("getMultimediaDevices",function(b){bR(a,b)})}function cn(b,c){var d=a.Event("ringtonesListAvailable.cwic");d.ringtones=c.ringtones,b.trigger(d)}function cm(a){s()||bm("getAvailableRingtones",function(b){cn(a,b)})}function cl(){var a={multimediadevices:b.multimediadevices};bg(!0,"getMultimediaDevices returning:",a);return a}function ck(){bg(!0,"getInstanceId");return b.instanceId}function cj(){bg(!0,"sendDTMF");var a=this,b=null,c=a.data("cwic"),d=c?c.id:null,e=["1","2","3","4","5","6","7","8","9","0","#","*","A","B","C","D","a","b","c","d"];arguments.length>0&&(b=typeof arguments[0]=="string"?arguments[0]:null,arguments.length>1&&(typeof arguments[1]=="object"?(c=arguments[1],d=c.id):typeof arguments[1]=="string"&&(d=arguments[1])));if(typeof b!="string"||!d)return cf(a,g.InvalidArguments,"wrong arguments (sendDTMF)",arguments);if(e.indexOf(b)===-1)return cf(a,g.InvalidArguments,"invalid DTMF digit (sendDTMF)",arguments);bm("sendDTMF",{callId:d,digit:b});return a}function ci(){bg(!0,"updateConversation",arguments);var b=this;if(b.length===0)return b;var c=arguments[0],d=null,e=null;typeof arguments[1]=="object"?(d=arguments[1],e=d.id):typeof arguments[1]=="undefined"?(d=b.data("cwic"),typeof d=="object"&&(e=d.id)):(e=arguments[1],d=a(".cwic-conversation-"+e).data("cwic")||b.data("cwic"));if(!e||!d)return cf(b,g.InvalidArguments,"cannot update conversation: undefined or empty conversation id");if(typeof c=="string"){var f=null,h=null;if(c.match(/^hold$/i))f="hold",h={callId:e};else if(c.match(/^resume$/i))f="resume",h={callId:e};else if(c.match(/^mute$/i))f="mute",h={callId:e};else if(c.match(/^unmute$/i))f="unmute",h={callId:e};else if(c.match(/^muteAudio$/i))f="mute",h={callId:e,muteAudio:!0};else if(c.match(/^muteVideo$/i))f="mute",h={callId:e,muteVideo:!0};else if(c.match(/^unmuteAudio$/i))f="unmute",h={callId:e,unmuteAudio:!0};else if(c.match(/^unmuteVideo$/i))f="unmute",h={callId:e,unmuteVideo:!0};else return cf(b,g.InvalidArguments,"wrong arguments (update conversation) - "+c,arguments);bm(f,h,a.noop,function(a){cf(b,i(a),a)})}else if(typeof c=="object"){var k=!1;if(c.transferCall){if(A.inProgress){bg(!0,"Call transfer already in progress, canceling...");return b}k=!0,A.completeBtn=c.completeButton,A.inProgress=!0,bm("transferCall",{callId:e,transferToNumber:c.transferCall},a.noop,function(a){cf(b,i(a,"NativePluginError"),"transferCall",a)})}c.joinCall&&(k=!0,bm("joinCalls",{joinCallId:e,callId:c.joinCall},a.noop,function(a){cf(b,i(a,"NativePluginError"),"joinCall",a)})),c.videoDirection&&(k=!0,bm("setVideoDirection",{callId:e,videoDirection:c.videoDirection},a.noop,function(a){cf(b,i(a,"NativePluginError"),"videoDirection",a)})),c.addRemoteVideoWindow&&(k=!0,bg("updateConversation() calling addWindowToCall() for conversationId: "+e),bN({callId:e,remoteVideoWindow:c.addRemoteVideoWindow,window:c.window})),c.removeRemoteVideoWindow&&(k=!0,bg("updateConversation() calling removeWindowFromCall() for conversationId: "+e),bO({callId:e,remoteVideoWindow:c.removeRemoteVideoWindow,window:c.window,endCall:!1})),k||cf(b,g.InvalidArguments,"wrong arguments (update conversation)",arguments)}else cf(b,g.InvalidArguments,"wrong arguments (update conversation)",arguments);return b}function ch(){bg(!0,"endConversation",arguments);var b=this;if(b.length===0)return b;var c=null,d=null,e=null;if(arguments.length===0){d=b.data("cwic");if(!d)return cf(b,"cannot end conversation: no conversation exists for this element");e=d.id}else arguments.length===1?(c=typeof arguments[0]=="boolean"?arguments[0]:null,d=typeof arguments[0]=="object"?arguments[0]:b.data("cwic"),e=typeof arguments[0]=="string"?arguments[0]:d.id):arguments.length===2&&(c=typeof arguments[0]=="boolean"?arguments[0]:null,d=typeof arguments[1]=="object"?arguments[1]:b.data("cwic"),e=typeof arguments[1]=="string"?arguments[1]:d.id);if(!e)return cf(b,g.InvalidArguments,"cannot end conversation: undefined or empty conversation id");A.callId===e&&A.endTransfer();if(c){d=d||a(".cwic-conversation-"+e).data("cwic");if(!d)return cf(b,"cannot iDivert - undefined conversation");if(!d.capabilities||!d.capabilities.canImmediateDivert)return cf(b,g.CapabilityMissing,"cannot iDivert - missing capability",{conversation:d});bg(!0,"iDivert conversation",d),bm("iDivert",{callId:e})}else bg(!0,"end conversation",d),z.endingCallForId=e,bm("endCall",{callId:e});return b}function cg(){bg(!0,"startConversation",arguments);var b=this,c=arguments[0]||b.data("cwic")||{},d,e;if(b.length===0)return cf(b,c.error,g.InvalidArguments,"cannot start conversation with empty selection");var f=b;typeof c.container=="string"?f=a(c.container):typeof c.container=="object"&&(f=c.container),f=f.first();if(typeof c.id!="undefined"){f.addClass("cwic-data cwic-conversation cwic-conversation-"+c.id).data("cwic",c),arguments.length>=1?(e=c.videoDirection,c.remoteVideoWindow&&(bN({callId:c.id,remoteVideoWindow:c.remoteVideoWindow}),c.remoteVideoWindow.windowhandle&&(d=c.remoteVideoWindow.windowhandle))):e="";var h={callId:c.id,videoDirection:e};d&&(h.windowhandle=d),bm("answer",h)}else{var j=c.participant||{};typeof j=="string"&&(j={recipient:j});if(typeof j.recipient=="undefined")return cf(b,c.error,g.InvalidArguments,"cannot start conversation: undefined or empty recipient");f.addClass("cwic-data cwic-conversation cwic-conversation-outgoing").data("cwic",{participant:j}),f.is(":hidden")&&bg(!0,"startConversation - warning: container is hidden");var k={recipient:j.recipient,videoDirection:c.videoDirection};c.remoteVideoWindow&&c.remoteVideoWindow.windowhandle&&(k.windowhandle=c.remoteVideoWindow.windowhandle),bm("originate",k,function(a){a.callId&&a.callId>=1&&c.remoteVideoWindow&&(c.window=c.window||window,bN({callId:a.callId,remoteVideoWindow:c.remoteVideoWindow,window:c.window}))},function(a){a&&(bg(!0,"originate error",a),cf(b,i(a),a,"cannot start conversation"))})}return b}function cf(){var b=arguments[0],c=null,d=a.extend({details:[]},g.Unknown);for(var e=1;e<arguments.length;e++){var f=arguments[e];a.isFunction(f)?c=f:typeof f=="string"?d.details.push(f):typeof f=="object"&&a.extend(d,f)}bg(d.message,d);if(c)try{c(d)}catch(h){bg("Exception occurred in application error callback",h),typeof console!="undefined"&&console.trace&&console.trace()}else{var i=a.Event("error.cwic");a.extend(i,d),b.trigger(i)}return b}function ce(b,c,e){var f=c.callId,g=c.callState,h=x[f];if(f===z.endingCallForId&&g==="Connected")bg(!0,'Ignoring "connect" state [ending call]!',c);else{x[f]=c;if(h&&h.callState==="Connected"&&g==="Connected"&&cd(c,h)){bg(!0,'Ignoring "connect" state!',c);return}A.inProgress&&(c.capabilities.canDirectTransfer=!1);var i=c.participants&&c.participants.length>0?c.participants[0]:{},j=i.directoryNumber&&i.directoryNumber!==""?i.directoryNumber:i.number;i=a.extend({},i,{recipient:j});var k=a(".cwic-conversation-"+f);k.length===0&&(k=a(".cwic-conversation-outgoing"));var l=k.data("cwic")||{};bg(!0,"conversation id="+f+" state="+c.callState||l.state,c),c=a.extend({},l,c,{id:f,state:g||l.state,participant:a.extend(l.participant,i)});if(c.state==="Ringin"&&k.length===0){k=a("<div>").addClass("cwic-data cwic-conversation cwic-conversation-"+f).data("cwic",c),b.trigger("conversationIncoming.cwic",[c,k]);return}if(c.state==="OnHook"&&!c.capabilities.canOriginateCall||!c.exists){bO({callId:f,remoteVideoWindow:d.videoObject,window:d.window,endCall:!0});if(k.length===0){bg("warning: no container for ended conversation "+f),b.trigger("conversationEnd.cwic",[c]);return}k.removeData("cwic").removeClass("cwic-data cwic-conversation cwic-conversation-"+c.id).trigger("conversationEnd.cwic",[c]);return}if(c.state==="OffHook"||c.state==="Connected"){typeof c.connect=="undefined"&&c.state==="Connected"&&(k.length===0&&(k=a("<div>").addClass("cwic-conversation cwic-conversation-"+f)),a.extend(c,{connect:new Date}),k.data("cwic",c));if(typeof c.start=="undefined"){k.length===0&&(k=a("<div>")),a.extend(c,{start:new Date}),k.data("cwic",c),k.removeClass("cwic-conversation-outgoing").addClass("cwic-conversation cwic-conversation-"+f).data("cwic",c),b.trigger("conversationStart.cwic",[c,k]);return}}if(k.length===0){k=a("<div>").data("cwic",c).addClass("cwic-conversation cwic-conversation-"+f),bg("warning: no container for updated conversation "+f);if(c.exists){b.trigger("conversationStart.cwic",[c,k]);return}b.trigger("conversationUpdate.cwic",[c,k]);return}k.data("cwic",c),k.trigger("conversationUpdate.cwic",[c,k])}}function cd(a,b){if(a.audioMuted!==b.audioMuted||a.callType!==b.callType||a.isConference!==b.isConference||a.exists!==b.exists||a.videoDirection!==b.videoDirection||a.videoMuted!==b.videoMuted)return!1;if(!cc(a.capabilities,b.capabilities)||!cc(a.localParticipant,b.localParticipant)||!cc(a.participant,b.participant)||a.participants.length!==b.participants.length||!cc(a.videoResolution,b.videoResolution))return!1;return!0}function cc(b,c){var d=!0;if(b===c)return!0;a.each(b,function(a,b){c[a]!==b&&(d=!1)});return d}function cb(){bg(!0,"_reset: reseting regGlobals..."),a(".cwic-data").removeData("cwic"),C()}function ca(a){var b;bg(!0,"signOut",arguments),p(arguments[0])&&typeof arguments[0].complete=="function"&&(b=arguments[0].complete),b_({forceLogout:!0,complete:b})}function b_(){bg(!0,"unregisterPhone",arguments);var a=this;cB(),p(arguments[0])&&arguments[0].forceLogout===!0&&(bm("logout"),y={devices:{}});if(p(arguments[0])&&typeof arguments[0].complete=="function"){var b=arguments[0].complete;z.unregisterCb=function(){bg(!0,"Calling unregisterCb...");try{b()}catch(a){bg("Exception occurred in application unregister complete callback",a),typeof console!="undefined"&&console.trace&&console.trace()}z.unregisterCb=null}}cb();return a}function b$(){return}function bZ(c,d){var e=u.get("passphrase"),f={devicesAvailableCb:null,tftp:[],ccmcip:[],cti:[],passphrase:""};f.devicesAvailableCb=a.isFunction(c.devicesAvailable)?c.devicesAvailable:null;if(!b){cf(d,z.errorCb,g.PluginNotAvailable,"Plug-in is not available or has not been initialized",{registration:y});throw new Error("Break manual login")}a.each(a.makeArray(c.cucm),function(b,c){if(typeof c=="string"){var d=c.split(" ").pop();f.tftp.push(d),f.ccmcip.push(d),f.cti.push(d)}else if(typeof c=="object"){var e=[],g=!1;a.isArray(c.tftp)&&(f.tftp=f.tftp.concat(c.tftp),e=c.tftp,g=!0),a.isArray(c.ccmcip)?(f.ccmcip=f.ccmcip.concat(c.ccmcip),g=!0):f.ccmcip=f.ccmcip.concat(e),a.isArray(c.cti)?(f.cti=f.cti.concat(c.cti),g=!0):f.cti=f.cti.concat(e),g||(bg("registerPhone: no ccmcip/tftp/cti properties for cucm element"),bg(!0,c))}else bg("registerPhone: ignoring cucm argument of type "+typeof c)}),bg("registerPhone: "+f.tftp.length+" cucm TFTP address(es)"),bg(!0,f.tftp),bg("registerPhone: "+f.ccmcip.length+" cucm CCMCIP address(es)"),bg(!0,f.ccmcip),bg("registerPhone: "+f.cti.length+" cucm CTI address(es)"),bg(!0,f.cti);if(f.tftp.length>3||f.ccmcip.length>3||f.cti.length>3)bg("registerPhone: Server address(es) are limited to 3 values. Only first 3 values will be kept."),f.tftp=f.tftp.splice(0,3),f.ccmcip=f.ccmcip.splice(0,3),f.cti=f.cti.splice(0,3);bg("registerPhone of user="+y.user+' in mode="'+y.mode+'"');if(!y.user){cf(d,z.errorCb,g.InvalidArguments,"Missing user name",{registration:y});throw new Error("Break manual login")}if(!a.isArray(f.tftp)||f.tftp.length<1){cf(d,z.errorCb,g.NoCallManagerConfigured,"Missing CUCM address",{registration:y});throw new Error("Break manual login")}if(!y.mode.match(/^(SoftPhone|DeskPhone)$/)){cf(d,z.errorCb,g.InvalidArguments,'Invalid phone mode "'+y.mode+'"',{registration:y});throw new Error("Break manual login")}f.passphrase=c.passphrase||c.password;if(typeof f.passphrase=="string"){if(e.isNotValid(f.passphrase)){cf(d,z.errorCb,g.InvalidArguments,"invalid passphrase",{registration:y});throw new Error("Break manual login")}}else{if(typeof f.passphrase!="object"||f.passphrase.cipher!=="cucm"){cf(d,z.errorCb,g.InvalidArguments,"invalid passphrase (type "+typeof f.passphrase+")",{registration:y});throw new Error("Break manual login")}if(e.isNotValid(f.passphrase.encrypted)){cf(d,z.errorCb,g.InvalidArguments,"invalid passphrase",{registration:y});throw new Error("Break manual login")}}return f}function bY(b){z.registeringPhone=!0,z.manual=!0,y={user:b.user,mode:b.mode||"SoftPhone",devices:{},forceRegistration:b.forceRegistration||!1},z.successCb=a.isFunction(b.success)?b.success:null,z.errorCb=a.isFunction(b.error)?b.error:null,z.CUCM=b.cucm,z.user=b.user,bg(!0,"setRegGlobalsM: regGlobals set: ",z),bg(!0,"setRegGlobalsM: registration set: ",y)}function bX(b){var c=a.extend({},b);c.passphrase&&(c.passphrase="*****"),c.password&&(c.password="*****"),bg(!0,"manualSignIn",c)}function bW(c){function p(){var c=b.connectionStatus;c==="eReady"&&bz(d,c),z.passphrase=m;if(c!=="eReady"){z.currState=c,z.authenticatedCallback=G(e,d);if(!m.encrypted||m.cipher!=="cucm")return cf(d,z.errorCb,g.InvalidArguments,"authenticateAndConnect: invalid passphrase (type "+typeof m+")",{registration:y});z.errorState==="credentialsRequired"?L(d,{errors:[],error:"",authenticatorId:z.lastAuthenticatorId}):bm("startSignIn",{manualSettings:!0},a.noop,function(a){cf(d,z.errorCb,i(a),a,{registration:y})})}}function o(a){return function(c){bg(!0,a+" callback received"),l[a]=c[a],l.hasOwnProperty("TftpAddressList")&&l.hasOwnProperty("CtiAddressList")&&l.hasOwnProperty("CcmcipAddressList")&&l.hasOwnProperty("connectionStatus")&&(bg(!0,"All prop callbacks received.  Continuing toward authenticateAndConnect",l),b.connectionStatus=l.connectionStatus,p())}}function n(a){a&&(m={cipher:"cucm",encrypted:a}),bm("setProperty",{TftpAddressList:f},o("TftpAddressList")),bm("setProperty",{CtiAddressList:j},o("CtiAddressList")),bm("setProperty",{CcmcipAddressList:h},o("CcmcipAddressList")),bm("getProperty","connectionStatus",o("connectionStatus"))}var d=this,e,f=[],h=[],j=[],k,l={},m;bX(c),bY(c);try{k=bZ(c,d),e=k.devicesAvailableCb,f=k.tftp,h=k.ccmcip,j=k.cti,m=k.passphrase}catch(q){return d}typeof m=="string"?bm("encryptCucmPassword",m,n):n();return d}function bV(b){function f(c){if(a.isFunction(b.progress))try{b.progress(c)}catch(d){bg("Exception occurred in application switchPhoneMode progress callback",d),typeof console!="undefined"&&console.trace&&console.trace()}}function e(e){var g=e.devices||[],h=!0,j,k,l,m,n=d.phoneMode,o=d.deviceName,p=d.lineDN,q=d.forceRegistration;j=a.grep(g,function(a){return a.isDeskPhone&&n==="DeskPhone"||a.isSoftPhone&&n==="SoftPhone"});if(j.length===0){bg(!0,"switchPhoneMode: filtered device list is empty!"),a.isFunction(b.error)&&cf(c,b.error,'no device found for mode: "'+n+'"');return c}k=a.map(j,function(a){return a.name}),m=o&&a.inArray(o,k)>-1,o&&m&&(h=!1),m||bg(!0,"switchPhoneMode: Device name not set or invalid, proceeding with default device selection"),h?(p="",l=j[0]&&j[0].name):l=o,bg(!0,"switchPhoneMode: selected device: ",l),bg(!0,"switchPhoneMode: switching to mode: ",n),bg(!0,"switchPhoneMode: switching to line: ",p),bm("connect",{phoneMode:n,deviceName:l,lineDN:p,forceRegistration:q},function(){f({message:"Switch mode operation started"})},function(d){a.isFunction(b.error)&&cf(c,b.error,i(d),{message:d})})}var c=this;bg(!0,"switchPhoneMode started with arguments: ",b);if(typeof b!="object"){bg(!0,"switchPhoneMode: no arguments provided, stoping execution!");return c}z.successCb=a.isFunction(b.success)?b.success:null,z.errorCb=a.isFunction(b.error)?b.error:null,z.switchingMode=!0;var d={phoneMode:b.mode||"SoftPhone",deviceName:b.device||(b.mode==="SoftPhone"?br({username:y.user}):""),lineDN:b.line||"",forceRegistration:b.forceRegistration||!1};by(e);return this}function bU(){var a=bT.handlersList,c,d,e,f;if(a)for(e=0,f=a.length;e<f;e+=1)c=a[e].name,d=a[e].handler,typeof c=="string"&&typeof d=="function"&&(bg(!0,"removing npapi listener for "+c+" event."),bj(b.api,c,d));else bg(!0,'trying to remove npapi listeners, but no "_registerNpapiCallbacks.handlersList" found.')}function bT(){function d(a){var b;try{b=JSON.parse(a)}catch(d){bg(!1,"Invalid JSON message from plugin",d);throw new Error(g.NativePluginError.code)}if(b.ciscoChannelMessage&&b.ciscoChannelMessage.ciscoSDKServerMessage){if(b.ciscoChannelMessage.client&&b.ciscoChannelMessage.client.id&&b.ciscoChannelMessage.client.id!==c)return;b=b.ciscoChannelMessage}bk(b)}var a="addonmessage",e=bT.handlersList=[];e.push({name:a,handler:d}),bg(!0,"adding npapi listener for "+a),bi(b.api,a,d)}function bS(b,c){bg(!0,"externalWindowEvent",c);var d=a.Event("externalWindowEvent.cwic");d.externalWindowState=c,b.trigger(d)}function bR(c,d){bg(!0,"mmDeviceChange",d),d&&(b.multimediadevices=d.multimediadevices);var e=a.Event("mmDeviceChange.cwic");c.trigger(e)}function bQ(a,b){var c=b.result,d=b.status;bg(!0,"authentication result: "+c),bg(!0,"authentication status: "+d),z.lastAuthStatus=d}function bP(a){var c=this;bg(!0,"shutdown",arguments),l(),a||ca(),Z(),c.unbind(".cwic"),bU(),bm("releaseInstance"),bn.purge(),b=null}function bO(a){var b=this,c=a.endCall,e=bq();if(e.capabilities.videoPluginObject===!1)bg(!1,"removeWindowFromCall called from unsupported browser");else{if(d.lastId!==a.callId){bg("cannot call removeWindowFromCall for callId "+a.callId+". Last call id was: "+d.lastId);return}bg(!0,"removeWindowFromCall() called with arguments: ",a),bg(!0,"removeWindowFromCall(): activeConversation object: ",d),a.methodName=c?"stopRemoteVideo":"removeWindowFromCall",bg(!0,"removeWindowFromCall() calling method "+a.methodName),a.videoObject=a.remoteVideoWindow,bK(a);return b}}function bN(b){var c=this,e=b.success,f=!1,g=bq();if(g.capabilities.videoPluginObject===!1)bg(!1,"addWindowToCall called from unsupported browser");else{d.lastId!==b.callId&&(f=!0),bg(!0,"addWindowToCall() called with arguments: ",b),bg(!0,"addWindowToCall(): activeConversation object: ",d),b.methodName=f?"startRemoteVideo":"addWindowToCall",bg(!0,"addWindowToCall() calling "+b.methodName),b.videoObject=b.remoteVideoWindow,b.success=function(c){f&&(bg(!0,"addWindowToCall(): setting activeConversation object"),d.videoObject=c,d.window=b.window,d.lastId=b.callId),a.isFunction(e)&&e()},bK(b);return c}}function bM(a){var b=this,c=bq();if(c.capabilities.videoPluginObject===!1)bg(!1,"removePreviewWindow called from unsupported browser");else{a.methodName="removePreviewWindow",a.videoObject=a.previewWindow,bK(a);return b}}function bL(a){var b=this,c=bq();if(c.capabilities.videoPluginObject===!1)bg(!1,"addPreviewWindow called from unsupported browser");else{a.methodName="addPreviewWindow",a.videoObject=a.previewWindow,bK(a);return b}}function bK(a){bg(!0,"execVideoObjectOperation called with arguments",a);var b=a.window||window,c=a.videoObject,d=a.methodName;if(typeof c=="string")try{c=b.document.getElementById(c)}catch(e){bg(!0,"execVideoObjectOperation: invalid window object"),a.error&&a.error(i("InvalidArguments"));return}bv({obj:c,methodName:d,error:a.error||null,success:a.success||null,callId:a.callId||null})}function bJ(b){var c=this,d=bq();if(d.capabilities.video&&d.capabilities.videoPluginObject){b=b||{},b.window=b.window||window;var e="application/x-cisco-cwc-videocall",f=b.onload||"_cwic_onVideoPluginLoaded",g=b.success,h=b.id||"_cwic_vw"+bI;bI++;var i=bs.getWindowId({window:b.window});bs.callbacks[i][h]={callback:g,wascalled:!1};var j='<object type="'+e+'" id="'+h+'"><param name="loadid" value="'+h+'"></param><param name="onload" value="'+f+'"></param></object>';a(c).append(j)}return c}function bH(b){var c=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(c===!0){var d={cwicExtId:"ppbllmlcmhfnfflbkbinnhacecaankdh",verbose:j.verbose},e=function(a){var c=document.createElement("script");c.id=a.cwicExtId,c.onload=function(){cwic_plugin.init(bk,a)},c.onerror=function(){cf(b,j.error,g.ExtensionNotAvailable,"Chrome requires Cisco Web Communicator extension")},c.src="chrome-extension://"+c.id+"/cwic_plugin.js";return c};if(typeof cwic_plugin=="undefined"){var f=e(d);f.onerror=function(){try{document.head.removeChild(document.getElementById(d.cwicExtId))}catch(a){}bg("Failed loading release version of Chrome extension.  Attempting to load dev version next."),d.cwicExtId="kekllijkldgcokjdjphahkijinjhlapf",f=e(d),document.head.appendChild(f)},document.head.appendChild(f)}else bg(!0,"calling init on previously loaded cwic_plugin script"),d.cwicExtId=cwic_plugin.about().cwicExtId,cwic_plugin.init(bk,d)}else{var h=!1,k=navigator.mimeTypes["application/x-ciscowebcommunicator"];if("ActiveXObject"in window)try{var l=new ActiveXObject("CiscoSystems.CWCVideoCall");h=!0}catch(m){bg(!0,'ActiveXObject("CiscoSystems.CWCVideoCall") exception: '+m.message);try{var n=new ActiveXObject("ActivexPlugin.WebPhonePlugin.1");throw i("ReleaseMismatch")}catch(o){bg(!0,'ActiveXObject("ActivexPlugin.WebPhonePlugin.1") exception: '+o.message);throw i("PluginNotAvailable")}}else if(typeof k!="undefined")h=!0;else{k=navigator.mimeTypes["application/x-ciscowebphone"];if(typeof k!="undefined")throw i("ReleaseMismatch")}if(h)a(document.body).append('<object id="cwc-plugin" width="1" height="1" type="application/x-ciscowebcommunicator"><param name="onload" value="_cwic_onFBPluginLoaded"></param></object>');else throw i("PluginNotAvailable")}}function bG(a){if(b===null)try{bH(a)}catch(c){b=null,cf(a,j.error,c)}}function bF(b){a(document.body).ready(function(){bG(b)})}function bE(c){window._cwic_userAuthHandler=function(a){b.userAuthStatus=a?"UserAuthorized":"UserDenied",bg("_cwic_userAuthHandler result: "+b.userAuthStatus),a===!0?bm("getProperty","connectionStatus",function(a){b.connectionStatus=a.connectionStatus,bA(c)}):(cf(c,j.error,"Cannot Initialize Cisco Web Communicator",g.NotUserAuthorized),b.deniedCb&&(b.deniedCb(),b.deniedCb=null))},window._cwic_onInitReceived=function(d){var e;if(typeof cwic_plugin!="undefined"&&b!==null)bg("plugin is already loaded.");else{try{typeof cwic_plugin!="undefined"&&(b={},b.scope=c,b.api=cwic_plugin);if(b.api)b.instanceId=d.instanceId,b.version=d.version,b.userAuthStatus=d.userauthstatus,b.capabilities=d.capabilities;else throw i("PluginNotAvailable");bg("initialized "+b.userAuthStatus+" plugin",b.version);var f=bq();if(f.upgrade.plugin==="mandatory"){cf(c,j.error,g.PluginNotAvailable,'Cisco Web Communicator cannot be used when plugin upgrade is "mandatory"');return}a(window).unload(function(){bP.call(c,!0)}),b.userAuthStatus==="MustShowAuth"?a.isFunction(j.delayedUserAuth)?j.delayedUserAuth():cO({denied:a.noop}):b.userAuthStatus==="UserAuthorized"&&_cwic_userAuthHandler(!0);return}catch(h){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&h.message&&console.log("Exception occured in _cwic_onInitReceived() "+h.message)),b=null,e=a.extend({},g.PluginNotAvailable,h)}return cf(c,j.error,"Cannot Initialize Cisco Web Communicator",e)}},window._cwic_onFBPluginLoaded=function(){var d;if(b!==null)bg("plugin is already loaded.");else{try{b={},b.scope=c;var e=document.getElementById("cwc-plugin");if(e)b.api=e,bT(),bm("init");else throw i("PluginNotAvailable");return}catch(f){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&f.message&&console.log("Exception occured in _cwic_onFBPluginLoaded() "+f.message)),b=null,d=a.extend({},g.PluginNotAvailable,f)}return cf(c,j.error,"Cannot Initialize Cisco Web Communicator",d)}}}function bD(a){var b={result:!0,reason:[]};if(j.serviceDiscovery){typeof a.credentialsRequired!="function"&&(b.reason.push("No credentialRequired callback provided"),b.result=!1),typeof a.emailRequired!="function"&&(b.reason.push("No emailRequired callback provided"),b.result=!1);if(!a.redirectUri||typeof a.redirectUri!="string")b.reason.push("No redirectUri parameter provided"),b.result=!1}return b}function bC(b){typeof b.errorMap!="undefined"&&a.each(b.errorMap,function(b,c){typeof c=="string"?g[b]=a.extend({},g[b],{message:c}):typeof c=="object"?g[b]=a.extend({},g[b],c):bg("ignoring invalid custom error [key="+b+"]",c)}),a.extend(j,b)}function bB(a){var b=this,c;bg("init",arguments),bC(a),c=bD(a);if(!c.result)return cf(b,j.error,g.InvalidArguments,c.reason.join(", "));bE(b),bF(b);return b}function bA(c){var d;try{var e={},f=!1,h=b.connectionStatus;h==="eReady"&&(f=!0);var i=function(b){if(a.isFunction(j.ready))try{j.ready(e,f,b.mode)}catch(c){bg("Exception occurred in application ready callback",c),typeof console!="undefined"&&console.trace&&console.trace()}};bm("getProperty","mode",i);if(f){var k=function(b){a.each(a.makeArray(b.calls),function(a,b){ce(c,b,"state")})};bm("getCalls",k)}else bz(c,h);return}catch(l){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&l.message&&console.log("Exception occured in _cwic_onPluginReady() "+l.message)),b=null,d=a.extend({},g.PluginNotAvailable,l),cf(c,j.error,"Cannot Initialize Cisco Web Communicator",d)}}function bz(c,d){bg(!0,"providerState "+d);var e=a.Event("system.cwic");e.phone={status:d,ready:!1};var f=function(){e.phone.registration=y,b.connectionStatus=d;if(d==="eReady"){if(z.registeringPhone||z.switchingMode){z.registeringPhone=!1,z.switchingMode=!1;if(z.successCb){var f=a.extend({},y,{cucm:a.makeArray(z.CUCM),password:z.passphrase,passphrase:z.passphrase,mode:null}),g=function(b){bg(!0,"getPropsCb res: "+JSON.stringify(b)),a.extend(f,{mode:b.mode});try{z.successCb(f)}catch(c){bg("Exception occurred in application success callback",c),typeof console!="undefined"&&console.trace&&console.trace()}};bm("getProperty","mode",g)}else bg("warning: no registerPhone success callback")}e.phone.ready=!0,c.trigger(e);var h=function(b){a.each(a.makeArray(b.calls),function(a,b){ce(c,b,"state")})};bm("getCalls",h)}else d==="eIdle"?(typeof z.unregisterCb=="function"&&z.unregisterCb(),c.trigger(e)):c.trigger(e)};bx(d,f)}function by(a){bm("getAvailableDevices",a)}function bx(b,c){function e(e){var f;e.devices&&(d.devices=e.devices),e.device&&(d.device=e.device,y.device=a.extend({},e.device)),e.line&&(d.line=e.line,y.line=a.extend(y.line,e.line));if(b==="eIdle"&&d.devices||d.devices&&d.device&&d.line)f=a.makeArray(d.devices),a.each(f,function(b,c){if(c.name){var d=a.trim(c.name);y.devices[d]=a.extend({},y.devices[d],c)}}),a.isFunction(c)&&c(f)}var d={};b!=="eIdle"&&(bm("getProperty","device",e),bm("getProperty","line",e)),by(e)}function bv(a){var b=a.obj,c=a.methodName,d=a.success,e=a.error,f;f=bu(a.callId),!b||typeof b[c]!="function"&&typeof b[c]!="object"?(bg(!0,'calling "'+c+'" method on video object failed!'),e&&e(i("InvalidArguments"))):(bg(!0,'preparing to call "'+c+'" method on video object, with parameters',f),b[c].apply(this,f),d&&d(b))}function bu(a){var b=c||bl(),d=bl(),e=window.location.href,f=window.location.hostname,g=window.document.title,h,i;h=[d,b,e,f,g];if(a){try{i=parseInt(a,10)}catch(j){bg(!0,"generateMessageParamsForIBVideo: invalid callId received..."),i=-1}h.unshift(i)}return h}function br(b){if(!a.isFunction(j.predictDevice))return b.username?j.devicePrefix+b.username:"";try{return j.predictDevice(b)}catch(c){bg("Exception occurred in application predictDevice callback",c),typeof console!="undefined"&&console.trace&&console.trace()}}function bq(){bg(!0,"about",arguments);var c={javascript:{version:"11.0.1.102",system_release:"Cisco Unified Communications System Release 11.0 MR1"},jquery:{version:a.fn.jquery},channel:null,plugin:null,states:{system:"unknown",device:{exists:!1,inService:!1,lineDNs:[],modelDescription:"",name:""}},capabilities:{},upgrade:{}},d=c.javascript.version.match(/(\d+)\.(\d+)\.(\d+)\.(\d+)/);d&&(c.javascript.release=d[1],c.javascript.major=d[2],c.javascript.minor=d[3],c.javascript.revision=d[4]),typeof cwic_plugin!="undefined"&&(c.channel=cwic_plugin.about());if(b&&b.version)c.plugin={version:b.version};else{var e=bp();e===0?c.upgrade.plugin="mandatory":e&&(c.plugin={version:{plugin:e}})}c.plugin?(d=c.plugin.version.plugin.match(/(\d+)\.(\d+)\.(\d+)\.(\d+)/),d&&(c.plugin.release=d[1],c.plugin.major=d[2],c.plugin.minor=d[3],c.plugin.revision=d[4]),c.javascript.release>c.plugin.release?c.upgrade.plugin="mandatory":c.javascript.release<c.plugin.release?c.upgrade.javascript="mandatory":c.javascript.release===c.plugin.release&&(c.javascript.major>c.plugin.major?c.upgrade.plugin="mandatory":c.javascript.major<c.plugin.major?c.upgrade.javascript="recommended":c.javascript.major===c.plugin.major&&(c.javascript.minor>c.plugin.minor?c.upgrade.plugin="recommended":c.javascript.minor<c.plugin.minor&&(c.upgrade.javascript="recommended")))):c.upgrade.plugin="unknown",b&&(c.states.system=b.connectionStatus||c.states.system,c.states.device=y.device||c.states.device,c.capabilities=b.capabilities||c.capabilities);return c}function bp(){var a=/(\d+\.\d+\.\d+\.\d+)/,b,c=null,d=navigator.mimeTypes["application/x-ciscowebcommunicator"],e=d?d.enabledPlugin:undefined;e&&(c=0,e.version?c=e.version:(b=a.exec(e.description),b&&b[0]&&(c=b[0])));return c}function bo(a){var b=bh();b||(bg("Plugin does not exist. Restarting...."),a());return b}function bm(){if(!b||!b.api){bg("_sendClientRequest no plugin available");return!1}var d=arguments[0],e=null,f=null,g=b.scope||this;a.isFunction(arguments[1])?f=arguments[1]:e=arguments[1];var h=function(a){cf(g,i(a),{nativeError:a,nativeRequest:d,nativeArgs:e},"error returned from native plugin")};a.isFunction(arguments[2])&&(f===null?f=arguments[2]:h=arguments[2]),a.isFunction(arguments[3])&&(h=arguments[3]),f=f||a.noop;var j=d==="encryptCucmPassword"?"*****":e;bg(!0,"_sendClientRequest: "+d,{successCb:f,errorCb:h,content:j});var k=d==="init"?0:bl(),l={ciscoSDKClientMessage:{messageId:k,name:d,content:e===null?undefined:e}},m=a.extend({},l.ciscoSDKClientMessage);m.content=j,bg(!0,"send ciscoSDKClientMessage: "+d,m);if(b.api.sendRequest)b.api.sendRequest(l);else if(b.api.postMessage){c=c||bl();var n={id:c,url:window.location.href,hostname:window.location.hostname,name:window.document.title},o={ciscoChannelMessage:a.extend(l,{client:n})};b.api.postMessage(JSON.stringify(o))}bn.callbacks[k]={successCb:f,errorCb:h}}function bl(){return(new Date).valueOf().toString()+Math.floor(Math.random()*1e4+1).toString()}function bg(){var b=typeof arguments[0]=="boolean"?arguments[0]:!1,c=typeof arguments[0]=="string"?arguments[0]:arguments[1],d=typeof arguments[1]=="object"?arguments[1]:arguments[2];if((!b||b&&j.verbose)&&a.isFunction(j.log))try{var e=new Date,f=e.getDate()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"."+("00"+e.getMilliseconds()).slice(-3)+" ";j.log("[cwic] "+f+c,d)}catch(g){}}function bf(b,c){v=c;var d=a.Event("multimediaCapabilities.cwic");d.multimediaCapability=c,b.trigger(d),c&&(cm(b),bm("getMultimediaDevices",function(a){bR(b,a)}),typeof w=="function"&&(bg(!0,'Sending delayed "connect" message'),w(),w=null))}function be(b,c){var d=a.Event("ringtoneChange.cwic");d.currentRingtone=c.ringtone,b.trigger(d)}function bd(b,c){function g(a){ba(b,e),f&&bc(f).unbind()}var d=a.Event("callTransferInProgress.cwic"),e=c.callId,f=A.completeBtn;A.callId=e,d.completeTransfer=m(ba,b,e);if(!e)bg("_triggerAttendedTransferStateChange: No callId received from the plugin. Returning from the function...");else{bg(!0,"_triggerAttendedTransferStateChange: Received callId: "+e),typeof f=="string"&&(f=a("#"+f));if(f&&typeof f.one=="function"&&f.attr){bb(f).unbind().one("click",g);return}b.trigger(d);return}}function bc(a){if(!(a instanceof jQuery))throw new TypeError("disable function accepts only jQuery objects");a.attr("disabled",!0);return a}function bb(a){if(!(a instanceof jQuery))throw new TypeError("enable function accepts only jQuerys");a.attr("disabled",!1);return a}function ba(b,c){if(A.inProgress){bm("completeTransfer",{callId:c},a.noop,function(a){cf(b,i(a,"NativePluginError"),"completeTransfer",a)}),A.endTransfer();return!0}bg(!0,"completeTransfer: transfer not in progress, returning from function...");return!1}function _(b,c){a.isArray(c.invalidReasons)?c.invalidReasons=a.map(c.invalidReasons,function(a){return a.invalidReason}):c.invalidReasons=[];var d=a.Event("invalidCertificate.cwic");d.info=c,d.respond=$,b.trigger(d)}function $(a,b){if(a&&typeof a=="string"&&typeof b=="boolean")bg(!0,"handleInvalidCertificate sending response: "+b+" (for fingerprint - "+a),bm("handleInvalidCertificate",{certFingerprint:a,accept:b});else throw new TypeError("handleInvalidCert: Wrong arguments!")}function Z(){}function Y(a,b){bg(!0,"SSO: CanCancel property changed. New state: "+b.cancancel),B.canCancel=b.cancancel}function X(a,b){bg(!0,"SSO: Lifecycle session changed. New state: "+b)}function W(a,b){bg(!0,"System lifecycle state changed. New state: "+b),z.signingOut&&b==="SIGNEDOUT"&&(z.signingOut=!1,bz(a,"eIdle")),b==="SIGNINGOUT"&&(z.signingOut=!0),b==="RESETTING"&&(z.emailReguiredCalled=!1)}function V(a){bg(!0,"SSO: Show Window Triggered!")}function U(){bg(!0,"SSO: Invoke Reset Data Triggered.")}function T(){bg(!0,"proceedWithDeviceSelection called"),bx(z.currState,z.authenticatedCallback)}function R(a,b){bg(!0,"_triggerTelephonyDevicesChange called with following data: ",b),bg(!0,"_triggerTelephonyDevicesChange: regGlobals: ",z),b.devices&&b.devices.length>0&&z.registeringPhone&&(z.telephonyDevicesSet=!0,bg(!0,"Proceeding with device selection after waiting for TelephonyDevicesChange event."),T())}function Q(a){B.inProgress=!1,bg(!0,"_triggerSignedIn called"),bg(!0,"_triggerSignedIn: authenticatedCB present: ",z.authenticatedCallback?!0:!1),bg(!0,"_triggerSignedIn: telephonyDevicesSet: ",z.telephonyDevicesSet),z.authenticatedCallback&&z.telephonyDevicesSet?(bg(!0,"Proceeding with device selection immediately after SignedIn event"),T()):bg(!0,"_triggerSignedIn: Cannot proceed with device selection until devices are ready...");try{j.signedIn()}catch(b){bg(!0,"No signedIn callback defined...")}}function P(a,b){if(!!z.registeringPhone){var c=b.error;B.inProgress=!1,O(a,c)}}function O(a,b){cf(a,z.errorCb,g.AuthenticationFailure,b,{registration:y}),C()}function N(a,b){z.errorState="emailRequired",localStorage&&localStorage.removeItem("_cwic_cache_email"),O(a,b)}function M(a,b,c){z.errorState="credentialsRequired",z.lastAuthenticatorId=c,O(a,b)}function L(a,b){function m(b,c){function g(d,f){if(d)return cf(a,j.error,i("NativePluginError"),d);c=f,bm("setUserProfileCredentials",{username:b,password:c,authenticator:e})}var f=!1;c&&c.encrypted&&(c=c.encrypted,f=!0);if(d.isNotValid(b,c))return L(a,{errors:["InvalidCredentials"],error:i("AuthenticationFailure"),authenticatorId:e});y.user=z.user=b,f===!1?t(c,g):bm("setUserProfileCredentials",{username:b,password:c,authenticator:e})}function l(a){if(c&&z.credentialsRequiredCalled)return M(a,c);z.credentialsRequiredCalled=!0;try{j.credentialsRequired(m,f)}catch(b){return cf(a,j.error,g.ServiceDiscoveryMissingOrInvalidCallback,b)}}function k(){return z.user?z.user:z.email&&typeof z.email=="string"?z.email.split("@")[0]:""}function h(a){if(z.user&&z.passphrase)return m(z.user,z.passphrase);M(a,i("AuthenticationFailure"),e);return}if(!!z.registeringPhone){var c=b.error,d=u.get("credentials"),e=b.authenticatorId,f="";if(z.manual){if(c){bg(!0,"returning from credentialsRequired in manual mode, because of error..."),M(a,c,e);return}h(a)}else f=k(),l(a);return}}function K(a,b){function k(b){bg(!0,"setEmailAddress: "+b);d.isNotValid(b)?K(a,{error:i("InvalidUserInput"),errors:["Invalid email submited"]}):(z.email=b,b!==e&&(y.email=b),localStorage?b!==e&&b!==localStorage.getItem("_cwic_cache_email")&&(bg(!0,"saving email to localStorage"),localStorage.setItem("_cwic_cache_email",b)):bg(!1,"localStorage not available, check IE mode the app is running in ..."),bm("setUserProfileEmailAddress",{email:b}))}if(!!z.registeringPhone){var c=b.error,d=u.get("email"),f="",h;if(z.manual){if(c){N(a,c);return}return k(e)}if(z.emailReguiredCalled){c||(c="ServiceDiscoveryFailure");return N(a,c)}z.emailReguiredCalled=!0;if(localStorage){h=localStorage.getItem("_cwic_cache_email");if(h){k(h);return}}else bg(!0,"localStorage not available, check IE mode the app is running in ...");z.email&&typeof z.email=="string"&&z.email!==e?f=z.email:z.user&&typeof z.user=="string"&&(f=z.user+"@");try{j.emailRequired(k,f)}catch(l){return cf(a,j.error,g.ServiceDiscoveryMissingOrInvalidCallback,l)}}}function J(b,c){if(!j.redirectUri)return cf(b,B.args.error,g.SSOMissingOrInvalidRedirectURI);var d,e,f={},h=c.split("?"),i=h[0];bg(!0,"Plugin sent URL: "+c);try{e=h[1].split("&"),a.each(e,function(a,b){var c=b.split("=");f[c[0]]=c[1]})}catch(k){bg(!0,"Invalid SSO URL received",k);throw new Error("SSO authorization service URL invalid format")}f.client_id="C69908c4f345729af0a23cdfff1d255272de942193e7d39171ddd307bc488d7a1",f.redirect_uri=j.redirectUri,d=i+"?"+a.param(f),bg(!0,"New URL generated: "+d);var l=a.Event("ssoNavigateTo.cwic");l.url=d,b.trigger(l)}function I(){function a(){}bm("resetData",{},a),localStorage&&(bg(!0,"Removing data from localStorage..."),localStorage.removeItem("_cwic_cache_email"))}function H(){var a=this;B.canCancel?(B.canCancel=!1,bm("cancelSingleSignOn",{})):bg(!1,"SSO(cancelSSO): Not possible to cancel SSO in the current state");return a}function G(b,c){function d(b,e){var f=v;if(!f)bg(!0,'cannot send "connect" now ... waiting for multimedia start!'),w=m(d,b,e);else{if(!b||b===z.lastConnectedDevice){bg(!0,'authenticatedCb: device name empty or already sent "connect" message for this device, returning...',b);return}e=e||"",z.lastConnectedDevice=b,bm("connect",{phoneMode:y.mode,deviceName:b,lineDN:e,forceRegistration:y.forceRegistration},a.noop,function(a){cf(c,z.errorCb,i(a),a,{registration:y})})}}return function(a){var c,e;bg(!0,"Entering authenticatedCallback"),a.length===0&&bg(!0,"authenticatedCallback: devices list of zero length received");if(b)try{b(a,y.mode,function(a,b,c){if(a==="SoftPhone"||!c)c="";bg(!0,"connecting to user selected device: ",b),d(b,c)})}catch(f){bg("Exception occurred in application devicesAvailable callback",f),typeof console!="undefined"&&console.trace&&console.trace()}else{c={name:""};for(e=0;e<a.length;e++){if(y.mode==="SoftPhone"&&a[e].isSoftPhone&&a[e].modelDescription.match(/^\s*Cisco\s+Unified\s+Client\s+Services\s+Framework\s*$/i)){c=a[e];break}if(y.mode==="DeskPhone"&&a[e].isDeskPhone){c=a[e];break}}bg(!0,"connecting to discovered device: ",c),d(c.name)}}}function F(a,c){if(!b){cf(c,z.errorCb,g.PluginNotAvailable,"Plug-in is not available or has not been initialized",{registration:y});return!1}if(a.mode&&typeof a.mode=="string"&&!a.mode.match(/^(SoftPhone|DeskPhone)$/)){cf(c,z.errorCb,g.InvalidArguments,'Invalid phone mode "'+y.mode+'"',{registration:y});return!1}return!0}function E(b,c){var d=a.isFunction(b.devicesAvailable)?b.devicesAvailable:null;z.registeringPhone=!0,z.manual=!1,z.successCb=a.isFunction(b.success)?b.success:null,z.errorCb=a.isFunction(b.error)?b.error:null,z.CUCM="discovery based address",z.authenticatedCallback=G(d,c),y={mode:b.mode||"SoftPhone",devices:{},forceRegistration:b.forceRegistration||!1},bg(!0,"setRegGlobalsD: regGlobals set: ",z),bg(!0,"setRegGlobalsD: registration set: ",y)}function D(a){var b=this;a||(bg(!0,"startDiscovery: empty arguments received"),a={}),bg(!0,"startDiscovery called with arguments: ",a),E(a,b);if(F(a,b)===!1)return b;B.inProgress=!0,bm("startSignIn",{manualSettings:!1});return b}function C(){bg(!0,"resetGlobals: reseting ...");var a=z.user||"",b=z.email||"",c=z.manual,d=z.unregisterCb||null,e=z.errorState||"",f=z.lastAuthenticatorId||null,g=z.lastAuthStatus||"";B={inProgress:!1,canCancel:!1},A.endTransfer(),z={registeringPhone:!1,manual:c,signingOut:!1,endingCallForId:-1,switchingMode:!1,telephonyDevicesSet:!1,lastConnectedDevice:"",lastAuthStatus:g,errorState:e,lastAuthenticatorId:f,successCb:null,errorCb:null,CUCM:[],user:a,password:"",email:b,unregisterCb:d,authenticatedCallback:null,credentialsRequiredCalled:!1,emailRequiredCalled:!1},y={devices:{}}}function t(a,b){function c(a){a?b(null,a):b("Empty response from plugin")}a&&typeof a=="string"?bm("encryptCucmPassword",a,c):b("Invalid input string")}function s(){return navigator.platform&&navigator.platform.indexOf("Mac")!==-1}function r(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0}function p(a){return typeof a=="object"&&a!==null}function o(a){return function(){return!a.apply(this,[].slice.call(arguments))}}function n(b,c){if(!a.browser)bg(!1,"*******************************************************************************************************"),bg(!1,"*******************************************************************************************************"),bg(!1,"Jabber Web SDK with this version of jQuery won't work on IE8! (for IE8 support, use jQuery < 1.9)"),bg(!1,"*******************************************************************************************************"),bg(!1,"*******************************************************************************************************");else if(a.browser.msie&&a.browser.version==="8.0")return b;var d=null;return function(){var a=arguments,e=this;d&&clearTimeout(d),d=setTimeout(function(){d=null,b.apply(e,a)},c)}}function m(a){var b=a,c=[].slice.call(arguments,1);return function(){return b.apply(this,c)}}function l(){j=k}"use strict";var b=null,c,d={videoObject:null,window:null,lastId:-1},e="jabbersdk@any.domain",f=21,g={Unknown:{code:"Unknown",message:"Unknown error"},PluginNotAvailable:{code:"PluginNotAvailable",message:"Plugin not available"},BrowserNotSupported:{code:"BrowserNotSupported",message:"Browser not supported"},InvalidArguments:{code:"InvalidArguments",message:"Invalid arguments"},InvalidState:{code:"InvalidState",message:"Invalid State"},NativePluginError:{code:"NativePluginError",message:"Native plugin error"},OperationNotSupported:{code:"OperationNotSupported",message:"Operation not supported"},InvalidTFTPServer:{code:"InvalidTFTPServer",message:"The configured TFTP server is incorrect"},InvalidCCMCIPServer:{code:"InvalidCCMCIPServer",message:"The configured CCMCIP server is incorrect"},InvalidCTIServer:{code:"InvalidCTIServer",message:"The configured CTI server is incorrect"},ReleaseMismatch:{code:"ReleaseMismatch",message:"Release mismatch"},NoDevicesFound:{code:"NoDevicesFound",message:"No devices found"},TooManyPluginInstances:{code:"TooManyPluginInstances",message:"Too many plug-in instances"},AuthenticationFailure:{code:"AuthenticationFailure",message:"Authentication failed"},SignInError:{code:"SignInError",message:"Sign-in Error"},CallControlError:{code:"CallControlError",message:"Call control error"},PhoneConfigGenError:{code:"PhoneConfigGenError",message:"Phone configuration error"},CreateCallError:{code:"CreateCallError",message:"Cannot create call"},NetworkError:{code:"NetworkError",message:"Network error"},VideoWindowError:{code:"VideoWindowError",message:"Video window error"},CapabilityMissing:{code:"CapabilityMissing",message:"Capability Missing"},NotUserAuthorized:{code:"NotUserAuthorized",message:"User did not authorize access"},OperationFailed:{code:"OperationFailed",message:"Operation Failed"},ExtensionNotAvailable:{code:"ExtensionNotAvailable",message:"Browser extension not available"},DockingCapabilitiesNotAvailable:{code:"DockingCapabilitiesNotAvailable",message:"External video docking capabilities not available"},DockArgumentNotHTMLElement:{code:"DockArgumentNotHTMLElement",message:"Dock needs to be called on an HTMLElement"},ServiceDiscoveryMissingOrInvalidCallback:{code:"ServiceDiscoveryMissingOrInvalidCallback",message:"Service Discovery Error - Callback not implemented or exception occured"},SSOMissingOrInvalidRedirectURI:{code:"SSOMissingOrInvalidRedirectURI",message:"Redirect URI missing or invalid"},InvalidUserInput:{code:"InvalidUserInput",message:"Invalid user input"},CertificateError:{code:"CertificateError",message:"Certificate error"},InvalidURLFragment:{code:"InvalidURLFragment",message:"Invalid URL fragment received"},ErrorReadingConfig:{code:"ErrorReadingConfig",message:"Error reading config"},UnexpectedLifecycleState:{code:"UnexpectedLifecycleState",message:"Unexpected application lifecycle state"},SSOStartSessionError:{code:"SSOStartSessionError",message:"SSO start session error"},SSOCanceled:{code:"SSOCanceled",message:"SSO canceled"},SSOInvalidUserSwitch:{code:"SSOInvalidUserSwitch",message:"Invalid user switch"},SSOSessionExpired:{code:"SSOSessionExpired",message:"SSO session expired"},ServiceDiscoveryFailure:{code:"ServiceDiscoveryFailure",message:"Cannot find services automatically"},CannotConnectToServer:{code:"CannotConnectToServer",message:"Cannot connect to CUCM server"},SelectDeviceFailure:{code:"SelectDeviceFailure",message:"Connecting to phone device failed"},NoError:{code:"NoError",message:"No error"}},h={eCreateCallFailed:"CreateCallError",eCallOperationFailed:"CallControlError",eNoActiveDevice:"PhoneConfigGenError",eLoggedInLock:"TooManyPluginInstances",eLogoutFailed:"SignInError",eNoWindowExists:"VideoWindowError",eInvalidWindowIdOrObject:"VideoWindowError",eWindowAlreadyExists:"VideoWindowError",eNoPhoneMode:"InvalidArgument",eInvalidArgument:"InvalidArguments",eOperationNotSupported:"OperationNotSupported",eCapabilityMissing:"CapabilityMissing",eNotUserAuthorized:"NotUserAuthorized",eSyntaxError:"NativePluginError",eOperationFailed:"OperationFailed",eInvalidCallId:"InvalidArguments",eInvalidState:"InvalidState",eNoError:"NoError",eUnknownServiceEvent:"Unknown",Ok:"NoError",Unknown:"Unknown",DeviceRegNoDevicesFound:"NoDevicesFound",NoCredentialsConfiguredServerHealth:"AuthenticationFailure",InvalidCredential:"AuthenticationFailure",InvalidCredentialServerHealth:"AuthenticationFailure",InvalidCCMCIPServer:"InvalidCCMCIPServer",InvalidTFTPServer:"InvalidTFTPServer",InvalidCTIServer:"InvalidCTIServer",NoNetwork:"NetworkError",TLSFailure:"NetworkError",SSLConnectError:"NetworkError",ServerConnectionFailure:"CannotConnectToServer",ServerAuthenticationFailure:"AuthenticationFailure",SelectDeviceFailure:"SelectDeviceFailure",InValidConfig:"AuthenticationFailure",ServerCertificateRejected:"CertificateError",InvalidToken:"AuthenticationFailure",InvalidAuthorisationTokenServerHealth:"AuthenticationFailure",ErrorReadingConfig:"ErrorReadingConfig",InvalidStartupHandlerState:"UnexpectedLifecycleState",InvalidLifeCycleState:"UnexpectedLifecycleState",InvalidCertRejected:"CertificateError",SSOPageLoadError:"UnexpectedLifecycleState",SSOStartSessionError:"SSOStartSessionError",SSOUnknownError:"UnexpectedLifecycleState",SSOCancelled:"SSOCancelled",SSOCertificateError:"CertificateError",SSOInvalidUserSwitch:"SSOInvalidUserSwitch",SSOWhoAmIFailure:"SSOStartSessionError",SSOSessionExpired:"SSOSessionExpired",ServiceDiscoveryFailure:"ServiceDiscoveryFailure",ServiceDiscoveryAuthenticationFailure:"AuthenticationFailure",ServiceDiscoveryCannotConnectToCucmServer:"CannotConnectToServer",ServiceDiscoveryNoCucmConfiguration:"ServiceDiscoveryFailure",ServiceDiscoveryNoSRVRecordsFound:"ServiceDiscoveryFailure",ServiceDiscoveryCannotConnectToEdge:"CannotConnectToServer",ServiceDiscoveryNoNetworkConnectivity:"NetworkError",ServiceDiscoveryUntrustedCertificate:"CertificateError"},i=function(a,b){var c="Unknown";h[a]?c=h[a]:g[a]?c=a:b&&h[b]?c=h[b]:b&&g[b]&&(c=b);return g[c]},j={ready:null,devicePrefix:"ecp",verbose:!0,log:function(a,b){typeof console!="undefined"&&console.log&&(console.log(a),b&&console.log(b))},error:function(a){bg("Error: ",a)},errorMap:{},delayedUserAuth:null,serviceDiscovery:!0,redirectUri:"",emailRequired:function(a,b){bg(!1,"emailRequired callback not implemented, cannot proceed with sign in");throw{name:g.ServiceDiscoveryMissingOrInvalidCallback.message,message:"emailRequired not implemented",toString:function(){return this.name+": "+this.message}}},credentialsRequired:function(a,b){bg(!1,"credentialsRequired callback not implemented, cannot proceed with sign in");throw{name:g.ServiceDiscoveryMissingOrInvalidCallback.message,message:"credentialsRequired not implemented",toString:function(){return this.name+": "+this.message}}},signedIn:function(){bg(!1,"default signedIn callback called...")}},k=a.extend({},j),q=o(p),u=function(){function i(a){return!0}function h(a,b){return!0}function g(a){return!0}function f(a){return!0}function e(a){return!0}function d(a){return!0}function c(a){return!0}var b;b={email:{validate:c,isValid:c,isNotValid:o(c)},ssourl:{validate:d,isValid:d,isNotValid:o(d)},credentials:{validate:h,isValid:h,isNotValid:o(h)},url:{validate:e,isValid:e,isNotValid:o(e)},passphrase:{validate:g,isValid:g,isNotValid:o(g)},username:{validate:f,isValid:f,isNotValid:o(f)},ssotoken:{validate:i,isValid:i,isNotValid:o(i)}};return{get:function(c){var d;if(typeof c!="string")throw new TypeError(d+" is not a string");d=b[a.trim(c)];if(d)return d;throw new Error(c+" is not defined")}}}(),v=!1,w=null,x={},y,z={},A={endTransfer:function(){this.inProgress=!1,this.completeBtn=null,this.callId=null}},B;C();var S=n(R,20),bh=function(){var a=!0;!b||!b.api?(bg(!0,"_doesPluginExist failed basic existence check"),a=!1):typeof b.api.sendRequest=="undefined"&&typeof b.api.postMessage=="undefined"&&(bg(!0,"_doesPluginExist failed sendRequest/postMessage method check"),a=!1);return a},bi=function(a,b,c){try{a._addListener?a._addListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}catch(d){bg("_addListener error: ",d)}},bj=function(a,b,c){try{if(a._addListener)return;a.attachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}catch(d){bg("_removeListener error: ",d)}},bk=function bk(c){var d=b?b.scope:this,e;if(c.ciscoChannelServerMessage)c.ciscoChannelServerMessage.name==="ChannelDisconnect"?(bg("Extension channel disconnected",c.ciscoChannelServerMessage),b=null,bn.purge(),cf(d,j.error,g.ExtensionNotAvailable,"Lost connection to browser extension")):c.ciscoChannelServerMessage.name==="HostDisconnect"?(bg("Host application disconnected",c.ciscoChannelServerMessage),b=null,bn.purge(),cf(d,j.error,g.PluginNotAvailable,"Lost connection to plugin")):bg("ciscoChannelServerMessage unknown name: "+c.ciscoChannelServerMessage.name);else if(c.ciscoSDKServerMessage){var f=c.ciscoSDKServerMessage.content,h=c.ciscoSDKServerMessage.error,k=c.ciscoSDKServerMessage.replyToMessageId,l=c.ciscoSDKServerMessage.name;bg(!0,"_handlePluginMessage: "+l,c.ciscoSDKServerMessage);if(f&&f.errors){f.errors=a.map(f.errors,function(a){return a.error!==""?a.error:null}),bg(!0,"Lifecycle error list contains "+f.errors.length+" errors");for(e=0;e<f.errors.length;e++)bg(!0,"Lifecycle error from the list",f.errors[e]);f.error=f.errors.length?i(f.errors[0]):null}f&&f.errors===""&&(bg(!0,"Received empty string instead of lifecycle error list"),f.errors=[],f.error=null),k&&bn.callCallback(k,h,f);switch(l){case"init":_cwic_onInitReceived(f);break;case"userauthorized":_cwic_userAuthHandler(f);break;case"connectionstatuschange":bz(d,f);break;case"multimediacapabilitiesstarted":bf(d,!0);break;case"multimediacapabilitiesstopped":bf(d,!1);break;case"ringtonechanged":be(d,f);break;case"attendedtransferstatechange":bd(d,f);break;case"multimediadevicechange":v&&bm("getMultimediaDevices",function(a){bR(d,a)});break;case"connectionfailure":bg(!0,"Connection Failure event received with reason: ",f);if(f==="None"){bg(!1,'Received "None", returning...');return}var n=i(f,"ServerConnectionFailure");cf(d,z.errorCb,n,f,{registration:y});break;case"authenticationresult":bQ(d,f);break;case"telephonydeviceschange":S(d,f);break;case"callstatechange":ce(d,f,"state");break;case"externalwindowevent":bS(d,f),cJ.isVideoBeingReceived=f.showing;break;case"dockexternalwindowneeded":cM(d);break;case"videoresolutionchange":bg(!0,"video resolution change detected for call "+f.callId+". Height: "+f.height+", width: "+f.width,f),ce(d,{callId:f.callId,videoResolution:{width:f.width,height:f.height}},"render");break;case"ssonavigateto":J(d,f);break;case"userprofilecredentialsrequired":L(d,f);break;case"ssosigninrequired":P(d,f);break;case"userprofileemailaddressrequired":K(d,f);break;case"loggedin":Q(d);break;case"invokeresetdata":U(f);break;case"ssoshowwindow":V(f);break;case"ssosessionexpirypromptrequired":_triggerSSOSessionExpiryPromptRequired();break;case"lifecyclestatechanged":W(d,f);break;case"lifecyclessosessionchanged":X(d,f);break;case"cancancelsinglesignonchanged":Y(d,f);break;case"invalidcertificate":_(d,f);break;default:}}else bg(!0,"Unknown msg from plugin: ",c)},bn={callbacks:[],callCallback:function(b,c,d){if(!!this.callbacks[b]){var e,f;c&&c!=="eNoError"?(e=this.callbacks[b].errorCb,f=c):(e=this.callbacks[b].successCb,f=d);if(a.isFunction(e)){bg(!0,"clientRequestCallbacks calling result callback for msgId: "+b);try{e(f)}catch(g){bg("Exception occurred in clientRequestCallbacks callback",g)}}delete this.callbacks[b]}},purge:function(){this.callbacks=[]}},bs={windowobjects:[],getWindowId:function(a){var b=a.window,c=this.windowobjects.indexOf(b);c===-1&&!a.readOnly&&(this.windowobjects.push(b),c=this.windowobjects.indexOf(b),this.callbacks[c]={});return c},callbacks:[],callCallback:function(a,b){function c(a,b,c){if(a.callbacks[b].hasOwnProperty(c)){var d=a.callbacks[b][c];if(!d.wascalled&&d.callback){try{d.callback(c)}catch(e){bg("Exception occurred in application videoLoaded callback",e),typeof console!="undefined"&&console.trace&&console.trace()}d.wascalled=!0}}}var d=this.getWindowId({window:a,readOnly:!0}),e;if(b)c(this,d,b);else for(e in this.callbacks[d])this.callbacks[d].hasOwnProperty(e)&&c(this,d,e)}},bt=!1;window._cwic_onVideoPluginLoaded=function(a,b){bg("_cwic_onVideoPluginLoaded called");var c=b||window;bt||bv({obj:a,methodName:"configure",success:function(){bt=!0}}),bs.callCallback(c,a.loadid)},window._cwic_onPopupVideoPluginLoaded=function(a,b){bg("_cwic_onPopupVideoPluginLoaded called"),_cwic_onVideoPluginLoaded(a,b)},window._cwic_onSSOTokenReceived=function(a){var b=a.url,c=u.get("ssotoken");if(c.isValid(b))bm("ssoNavigationCompleted",{result:200,url:b,document:""});else throw new Error(g.InvalidURLFragment.code)};var bI=1,cJ={_about:null,hasDockingCapabilities:function(){return cJ._about.capabilities.externalWindowDocking},isVideoBeingReceived:!1,isDocked:!1,timeOfPreviousDocking:0,minimalTimeBeforeChangingPosition:10,targetDiv:null,targetDivStyle:{"background-color":"magenta",width:"8px",height:"8px",position:"fixed","border-right":"8px solid black","z-index":"2147483647"},frame:window,element:null,position:{},move:function(){if(cJ.isDocked){var b=(new Date).getTime()-cJ.timeOfPreviousDocking,c=cJ.updateOffsets(cJ.element.getBoundingClientRect()),d=c.top===cJ.position.top&&c.left===cJ.position.left&&c.height===cJ.position.height&&c.width===cJ.position.width&&c.cropTop===cJ.position.cropTop&&c.cropLeft===cJ.position.cropLeft&&c.cropHeight===cJ.position.cropHeight&&c.cropWidth===cJ.position.cropWidth?!1:!0;d&&b>cJ.minimalTimeBeforeChangingPosition&&(cJ.timeOfPreviousDocking=(new Date).getTime(),a.extend(cJ.position,c),cJ.sendMessageToAddOn("dockUpdate",cJ.position)),cJ.frame.requestAnimationFrame(cJ.move)}},updateOffsets:function(b){var c=cJ.frame,d=a(c).height(),e=a(c).width(),g,h,i,j=a.extend({cropTop:0,cropLeft:0,cropBottom:0,cropRight:0,cropWidth:0,cropHeight:0},b),k=0,l=0,m=0,n=0,o=0,p=c.devicePixelRatio*a(cJ.element).css("zoom"),q=0,r=0;if("ontouchstart"in window&&navigator.maxTouchPoints>1){var s=c.innerWidth,t=s-c.document.documentElement.clientWidth;cJ.lastZoomFactor=cJ.lastZoomFactor||1,t>0?s-=t:s-=f/cJ.lastZoomFactor;var u=c.document.documentElement.clientWidth/s;p*=u,cJ.lastZoomFactor=p;var v=a(c.document).width()-a(c).width(),w=a(c.document).height()-a(c).height();if(u>1.01){q=c.scrollX,r=c.scrollY;var x=w-r;x>=0?r=0:r=Math.abs(x);var y=v-q;y>=0?q=0:q=Math.abs(y),x>=0&&(cJ.initPosY=j.top+c.scrollY),j.top>cJ.initPosY-w&&x<0&&(j.top=cJ.initPosY-w),y>=0&&(cJ.initPosX=j.left+c.scrollX),j.left>cJ.initPosX-v&&y<0&&(j.left=cJ.initPosX-v)}}j.left-=q,j.top-=r,j.cropTop=j.top<0?Math.abs(j.top):0,j.cropLeft=j.left<0?Math.abs(j.left):0,j.cropBottom=Math.max(j.bottom-d,0),j.cropRight=Math.max(j.right-e,0);while(c!=c.top)g=c.frameElement.getBoundingClientRect(),h=a(c.parent).width(),i=a(c.parent).height(),c.frameElement.frameBorder!==""&&!parseInt(c.frameElement.frameBorder,10)?k=0:k=2,c.frameElement.style.borderTopWidth===""?l=k:l=parseInt(c.frameElement.style.borderTopWidth||0,10),n=parseInt(c.frameElement.style.paddingTop||0,10),g.top<0&&(j.top+j.cropTop<0?j.cropTop+=Math.abs(g.top):Math.abs(g.top)-(j.top+j.cropTop+l+n)>0&&(j.cropTop+=Math.abs(Math.abs(g.top)-(j.top+j.cropTop+l+n)))),g.top+l+n+j.top+j.height-j.cropBottom>i&&(j.cropBottom=g.top+l+n+j.top+j.height-i),j.top+=g.top+l+n,c.frameElement.style.borderLeftWidth===""?m=k:m=parseInt(c.frameElement.style.borderLeftWidth||0,10),o=parseInt(c.frameElement.style.paddingLeft||0,10),g.left<0&&(j.left+j.cropLeft<0?j.cropLeft+=Math.abs(g.left):Math.abs(g.left)-(j.left+j.cropLeft+m+o)>0&&(j.cropLeft+=Math.abs(Math.abs(g.left)-(j.left+j.cropLeft+m+o)))),g.left+m+o+j.left+j.width-j.cropRight>h&&(j.cropRight=g.left+m+o+j.left+j.width-h),j.left+=g.left+m+o,c=c.parent;j.cropHeight=Math.max(j.height-(j.cropTop+j.cropBottom),0),j.cropTop=j.height>j.cropTop?j.cropTop:0,j.cropWidth=Math.max(j.width-(j.cropLeft+j.cropRight),0),j.cropLeft=j.width>j.cropLeft?j.cropLeft:0,cJ.isVideoBeingReceived&&j.cropHeight>8&&j.cropWidth>16&&cJ._about.capabilities.showingDockingTarget?cJ.setTarget(j):a(cJ.targetDiv).css({display:"none"}),j.left=Math.round(p*j.left),j.top=Math.round(p*j.top),j.width=Math.ceil(p*j.width),j.height=Math.ceil(p*j.height),j.cropLeft=Math.round(p*j.cropLeft)||0,j.cropTop=Math.round(p*j.cropTop)||0,j.cropWidth=Math.floor(p*j.cropWidth)||0,j.cropHeight=Math.floor(p*j.cropHeight)||0,j.scaleCoefficient=p;return j},sendMessageToAddOn:function(b,c){var d={offsetX:c.left,offsetY:c.top,width:c.width,height:c.height,cropOffsetX:c.cropLeft,cropOffsetY:c.cropTop,cropWidth:c.cropWidth,cropHeight:c.cropHeight},e=c.scaleCoefficient;b==="dockExternalWindow"?d.title=cJ.frame.top.document.title||cJ.frame.top.location.host+cJ.frame.top.location.pathname+cJ.frame.top.location.search:(d.pageWidth=Math.floor(a(cJ.frame.top).width()*e),d.pageHeight=Math.floor(a(cJ.frame.top).height()*e)),bm(b,d)},resetPosition:function(){cJ.targetDiv&&a(cJ.targetDiv).css("display","none"),cJ.position={},cJ.timeOfPreviousDocking=0},setTarget:function(b){var c=b.top+b.cropTop>0||b.bottom<=8?Math.ceil(b.top+b.cropTop):0,d=b.left+b.cropLeft>0||b.right<=16?Math.ceil(b.left+b.cropLeft):0;cJ.createTargetDivIfNeeded(),a(cJ.targetDiv).css({display:"block",top:c,left:d})},createTargetDivIfNeeded:function(){cJ.targetDiv||(cJ.targetDiv=cJ.frame.top.document.createElement("div"),cJ.frame.top.document.body.appendChild(cJ.targetDiv),a(cJ.targetDiv).css(cJ.targetDivStyle))}},cP={about:bq,init:bB,shutdown:bP,rebootIfBroken:bo,registerPhone:bW,manualSignIn:bW,switchPhoneMode:bV,unregisterPhone:b_,startConversation:cg,updateConversation:ci,endConversation:ch,createVideoWindow:bJ,addPreviewWindow:bL,removePreviewWindow:bM,sendDTMF:cj,getInstanceId:ck,getMultimediaDevices:cl,setRecordingDevice:co,setPlayoutDevice:cw,setCaptureDevice:cx,setRingerDevice:cp,getUserAuthStatus:cN,showUserAuthorization:cO,showCallInExternalWindow:cy,hideExternalWindow:cB,showPreviewInExternalWindow:cz,setExternalWindowAlwaysOnTop:cC,setExternalWindowShowSelfViewPip:cD,setExternalWindowShowControls:cE,setExternalWindowTitle:cI,getExternalWindowState:cA,setExternalWindowSelfViewPipPosition:cG,setExternalWindowShowSelfViewPipBorder:cH,dock:cK,undock:cL,startDiscovery:D,cancelSSO:H,resetData:I,signOut:ca,setSpeakerVolume:cq,setRingerVolume:cr,setMicrophoneVolume:cs,setRingtone:ct,setPlayRingerOnAllDevices:cu,getMultimediaDeviceVolume:cv};a.fn.cwic=function(a){try{if(cP[a])return cP[a].apply(this,Array.prototype.slice.call(arguments,1));if(typeof a=="object"||!a)return cP.init.apply(this,arguments);throw a+": no such method on jQuery.cwic"}catch(b){typeof console!="undefined"&&(console.trace&&console.trace(),console.log&&b.message&&console.log("Exception occured in $.fn.cwic() "+b.message)),cf(this,b)}}})(jQuery);
