<html><head><meta http-equiv="content-type" content="text/html; charset=utf8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * @fileOverview CWIC is a jQuery plug-in to access the Cisco Web Communicator.&lt;br>
<span class='line'>  3</span>  * Audio and Video media require the Cisco Web Communicator add-on to be installed.&lt;br>
<span class='line'>  4</span>  * @version 11.0.1.102, Unified Communications System Release 11.0 MR1
<span class='line'>  5</span>  */</span><span class="WHIT">
<span class='line'>  6</span> 
<span class='line'>  7</span> </span><span class="COMM">/*
<span class='line'>  8</span>     CWIC is a jQuery plug-in to access the Cisco Web Communicator
<span class='line'>  9</span> 
<span class='line'> 10</span>     CWIC uses jQuery features such as:&lt;ul>
<span class='line'> 11</span>     &lt;li>'cwic' namespacing: jQuery.cwic();&lt;/li>
<span class='line'> 12</span>     &lt;li>custom events (.cwic namespace): conversationStart.cwic&lt;/li>
<span class='line'> 13</span>     &lt;li>attach data with the 'cwic' key: ui.data('cwic', conversation)&lt;/li>
<span class='line'> 14</span>     &lt;/ul>
<span class='line'> 15</span> 
<span class='line'> 16</span>     Audio and Video media require the Cisco Web Communicator add-on to be installed
<span class='line'> 17</span> 
<span class='line'> 18</span> */</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="COMM">/**
<span class='line'> 20</span>  * Global window namespace
<span class='line'> 21</span>  * @name window
<span class='line'> 22</span>  * @namespace
<span class='line'> 23</span>  */</span><span class="WHIT">
<span class='line'> 24</span> 
<span class='line'> 25</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">    </span><span class="STRN">'use strict'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="COMM">/** @scope $.fn.cwic */</span><span class="WHIT">
<span class='line'> 28</span> 
<span class='line'> 29</span> </span><span class="WHIT">    </span><span class="COMM">// a global reference to the CWC native plugin API</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> 
<span class='line'> 32</span> </span><span class="WHIT">    </span><span class="COMM">// client id to differentiate between cwic instances in separate tabs (generated only once per cwic instance)</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> 
<span class='line'> 35</span> </span><span class="WHIT">    </span><span class="COMM">// we have to keep the reference to one of the video objects for active conversation.</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">    </span><span class="COMM">// This is neccessary for calling "removeWindowFromCall" after conversation is ended.</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeConversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">        </span><span class="NAME">videoObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// first video object added to conversation</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">        </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">        </span><span class="NAME">lastId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="COMM">// see addWindowToCall() for explanation</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">emailForManualSignIn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'jabbersdk@any.domain'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">    </span><span class="COMM">// 21px width - this works for surface pro device on Chrome 44</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">    </span><span class="COMM">// see http://stackoverflow.com/questions/986937/how-can-i-get-the-browsers-scrollbar-sizes</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">    </span><span class="COMM">// for chrome it can be calculated with:  window.inner - document.documentElement.clientWidth</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollBarWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">        </span><span class="COMM">// jsdoc does not seem to like enumerating properties (fields) of objects it already considers as properties (fields).</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">    </span><span class="COMM">/** cwic error object
<span class='line'> 52</span>     * @name $.fn.cwic-errorMapEntry
<span class='line'> 53</span>     * @namespace
<span class='line'> 54</span>     * @property {String} code a unique error identifier
<span class='line'> 55</span>     * @property {String} message the message associated with the error
<span class='line'> 56</span>     * @property {Any} [propertyName] Additional properties that will be passed back when an error is raised.
<span class='line'> 57</span>     */</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'> 60</span>     * The error map used to build errors triggered by cwic. &lt;br>
<span class='line'> 61</span>     * Keys are error codes (strings), values objects associated to codes. &lt;br>
<span class='line'> 62</span>     * By default the error object contains a single 'message' property. &lt;br>
<span class='line'> 63</span>     * The error map can be customized via the init function. &lt;br>
<span class='line'> 64</span>     * @namespace
<span class='line'> 65</span>     */</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 67</span> 
<span class='line'> 68</span> </span><span class="WHIT">        </span><span class="COMM">/** Unknown: unknown error or exception
<span class='line'> 69</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'> 70</span>          */</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">        </span><span class="NAME">Unknown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Unknown'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Unknown error'</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span> 
<span class='line'> 76</span> </span><span class="WHIT">        </span><span class="COMM">/** PluginNotAvailable: plugin not available (not installed, not enabled or unable to load)
<span class='line'> 77</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'> 78</span>          */</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">        </span><span class="NAME">PluginNotAvailable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'PluginNotAvailable'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Plugin not available'</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 83</span> 
<span class='line'> 84</span> </span><span class="WHIT">        </span><span class="COMM">/** BrowserNotSupported: browser not supported
<span class='line'> 85</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'> 86</span>          */</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="WHIT">        </span><span class="NAME">BrowserNotSupported</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'BrowserNotSupported'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Browser not supported'</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 91</span> 
<span class='line'> 92</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidArguments: invalid arguments
<span class='line'> 93</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'> 94</span>          */</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">        </span><span class="NAME">InvalidArguments</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidArguments'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Invalid arguments'</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 99</span> 
<span class='line'>100</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidState: invalid state for operation (e.g. startconversation when phone is not registered)
<span class='line'>101</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>102</span>          */</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">        </span><span class="NAME">InvalidState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidState'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Invalid State'</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>107</span> 
<span class='line'>108</span> </span><span class="WHIT">        </span><span class="COMM">/** NativePluginError: plugin returned an error
<span class='line'>109</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>110</span>          */</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">        </span><span class="NAME">NativePluginError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Native plugin error'</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>115</span> 
<span class='line'>116</span> </span><span class="WHIT">        </span><span class="COMM">/** OperationNotSupported: operation not supported
<span class='line'>117</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>118</span>          */</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">        </span><span class="NAME">OperationNotSupported</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'OperationNotSupported'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Operation not supported'</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>123</span> 
<span class='line'>124</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidTFTPServer: The configured TFTP server is incorrect
<span class='line'>125</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>126</span>          */</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">        </span><span class="NAME">InvalidTFTPServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidTFTPServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'The configured TFTP server is incorrect'</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidCCMCIPServer: The configured CCMCIP server is incorrect
<span class='line'>132</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>133</span>          */</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCCMCIPServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidCCMCIPServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'The configured CCMCIP server is incorrect'</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidCTIServer: The configured CTI server is incorrect
<span class='line'>139</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>140</span>          */</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCTIServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidCTIServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'The configured CTI server is incorrect'</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">        </span><span class="COMM">/** ReleaseMismatch: release mismatch
<span class='line'>146</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>147</span>          */</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">        </span><span class="NAME">ReleaseMismatch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ReleaseMismatch'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Release mismatch'</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>152</span> 
<span class='line'>153</span> </span><span class="WHIT">        </span><span class="COMM">/** NoDevicesFound: no devices found for supplied credentials
<span class='line'>154</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>155</span>          */</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">        </span><span class="NAME">NoDevicesFound</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NoDevicesFound'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'No devices found'</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>160</span> 
<span class='line'>161</span> </span><span class="WHIT">        </span><span class="COMM">/** TooManyPluginInstances: already logged in in another process (browser or window in internet explorer)
<span class='line'>162</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>163</span>          */</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">        </span><span class="NAME">TooManyPluginInstances</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'TooManyPluginInstances'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Too many plug-in instances'</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>168</span> 
<span class='line'>169</span> </span><span class="WHIT">        </span><span class="COMM">/** AuthenticationFailure: authentication failed - invalid or missing credentials/token or incorrect server parameters
<span class='line'>170</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>171</span>          */</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">        </span><span class="NAME">AuthenticationFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Authentication failed'</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>176</span> 
<span class='line'>177</span> </span><span class="WHIT">        </span><span class="COMM">/** SignInError: other sign-in error
<span class='line'>178</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>179</span>          */</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">        </span><span class="NAME">SignInError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SignInError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Sign-in Error'</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>184</span> 
<span class='line'>185</span> </span><span class="WHIT">        </span><span class="COMM">/** CallControlError: error performing call control operation
<span class='line'>186</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>187</span>          */</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">        </span><span class="NAME">CallControlError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CallControlError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Call control error'</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span> 
<span class='line'>193</span> </span><span class="WHIT">        </span><span class="COMM">/** PhoneConfigGenError: other phone configuration error
<span class='line'>194</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>195</span>          */</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">        </span><span class="NAME">PhoneConfigGenError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'PhoneConfigGenError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Phone configuration error'</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>200</span> 
<span class='line'>201</span> </span><span class="WHIT">        </span><span class="COMM">/** CreateCallError: error creating a new call. Possible causes:&lt;br>
<span class='line'>202</span>          * - the device is not available anymore&lt;br>
<span class='line'>203</span>          * - the maximum number of active calls configured on the user's line was reached&lt;br>
<span class='line'>204</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>205</span>          */</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">        </span><span class="NAME">CreateCallError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CreateCallError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Cannot create call'</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>210</span> 
<span class='line'>211</span> </span><span class="WHIT">        </span><span class="COMM">/** NetworkError: No network connection or SSL/TLS connection error
<span class='line'>212</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>213</span>          */</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">        </span><span class="NAME">NetworkError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NetworkError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Network error'</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>218</span> 
<span class='line'>219</span> </span><span class="WHIT">        </span><span class="COMM">/** VideoWindowError: error modifying video association (e.g. removing non-attached window or adding non-existing window)
<span class='line'>220</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>221</span>          */</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">        </span><span class="NAME">VideoWindowError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'VideoWindowError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Video window error'</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>226</span> 
<span class='line'>227</span> </span><span class="WHIT">        </span><span class="COMM">/** CapabilityMissing: Capability missing (e.g. no capability to merge call to conference or to transfer a call)
<span class='line'>228</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>229</span>          */</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">        </span><span class="NAME">CapabilityMissing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CapabilityMissing'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Capability Missing'</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>234</span> 
<span class='line'>235</span> </span><span class="WHIT">        </span><span class="COMM">/** NotUserAuthorized: user did not authorize the add-on to run
<span class='line'>236</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>237</span>          */</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">        </span><span class="NAME">NotUserAuthorized</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NotUserAuthorized'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'User did not authorize access'</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span> 
<span class='line'>243</span> </span><span class="WHIT">        </span><span class="COMM">/** OperationFailed: System not started or fully operational
<span class='line'>244</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>245</span>          */</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">        </span><span class="NAME">OperationFailed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'OperationFailed'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Operation Failed'</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>250</span> 
<span class='line'>251</span> </span><span class="WHIT">        </span><span class="COMM">/** ExtensionNotAvailable: browser extension not available (not installed, not enabled or unable to load)
<span class='line'>252</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>253</span>          */</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">        </span><span class="NAME">ExtensionNotAvailable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ExtensionNotAvailable'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Browser extension not available'</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>258</span> 
<span class='line'>259</span> </span><span class="WHIT">        </span><span class="COMM">/** DockingCapabilitiesNotAvailable: External video docking capabilities not available
<span class='line'>260</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>261</span>          */</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">        </span><span class="NAME">DockingCapabilitiesNotAvailable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'DockingCapabilitiesNotAvailable'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'External video docking capabilities not available'</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> 
<span class='line'>267</span> </span><span class="WHIT">        </span><span class="COMM">/** DockArgumentNotHTMLElement: Dock needs to be called on an HTMLElement
<span class='line'>268</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>269</span>          */</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">        </span><span class="NAME">DockArgumentNotHTMLElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'DockArgumentNotHTMLElement'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Dock needs to be called on an HTMLElement'</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>274</span> 
<span class='line'>275</span> </span><span class="WHIT">        </span><span class="COMM">/** ServiceDiscoveryMissingOrInvalidCallback: Service discovery lifecycle error (no callback defined or exception occured within callback for some of lifecycle states)
<span class='line'>276</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>277</span>          */</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryMissingOrInvalidCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryMissingOrInvalidCallback'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Service Discovery Error - Callback not implemented or exception occured'</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>282</span> 
<span class='line'>283</span> </span><span class="WHIT">        </span><span class="COMM">/** SSOMissingOrInvalidRedirectURI: Single Sign On redirect uri is missing or invalid (OAuth2)
<span class='line'>284</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>285</span>          */</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">        </span><span class="NAME">SSOMissingOrInvalidRedirectURI</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOMissingOrInvalidRedirectURI'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Redirect URI missing or invalid'</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>290</span> 
<span class='line'>291</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidUserInput: User input invalid (email, password, redirectUri, etc.)
<span class='line'>292</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>293</span>          */</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">        </span><span class="NAME">InvalidUserInput</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidUserInput'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Invalid user input'</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>298</span> 
<span class='line'>299</span> </span><span class="WHIT">        </span><span class="COMM">/** CertificateError: Cannot start a new session due to a certificate problem.
<span class='line'>300</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>301</span>          */</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">        </span><span class="NAME">CertificateError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CertificateError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Certificate error'</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>306</span> 
<span class='line'>307</span> </span><span class="WHIT">        </span><span class="COMM">/** InvalidURLFragment: Invalid SSO URL fragment received from child window (popup or iFrame)
<span class='line'>308</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>309</span>          */</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">        </span><span class="NAME">InvalidURLFragment</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidURLFragment'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Invalid URL fragment received'</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>314</span> 
<span class='line'>315</span> </span><span class="WHIT">        </span><span class="COMM">/** ErrorReadingConfig: Attempt to load startup handler config failed. Check if StartupHandlerConfig.xml file is present in installation directory.
<span class='line'>316</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>317</span>          */</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">        </span><span class="NAME">ErrorReadingConfig</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ErrorReadingConfig'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Error reading config'</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>322</span> 
<span class='line'>323</span> </span><span class="WHIT">        </span><span class="COMM">/** UnexpectedLifecycleState: Unexpected application lifecycle state.
<span class='line'>324</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>325</span>          */</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">        </span><span class="NAME">UnexpectedLifecycleState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UnexpectedLifecycleState'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Unexpected application lifecycle state'</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>330</span> 
<span class='line'>331</span> </span><span class="WHIT">        </span><span class="COMM">/** SSOStartSessionError: SSO start session error, probably because of missing token.
<span class='line'>332</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>333</span>          */</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">        </span><span class="NAME">SSOStartSessionError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOStartSessionError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSO start session error'</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>338</span> 
<span class='line'>339</span> </span><span class="WHIT">        </span><span class="COMM">/** SSOCanceled: SSO canceled.
<span class='line'>340</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>341</span>          */</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">        </span><span class="NAME">SSOCanceled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOCanceled'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSO canceled'</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>346</span> 
<span class='line'>347</span> </span><span class="WHIT">        </span><span class="COMM">/** SSOInvalidUserSwitch: You have attempted to sign in as a different user. To switch user you must call resetData API.
<span class='line'>348</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>349</span>          */</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">        </span><span class="NAME">SSOInvalidUserSwitch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOInvalidUserSwitch'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Invalid user switch'</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>354</span> 
<span class='line'>355</span> </span><span class="WHIT">        </span><span class="COMM">/** SSOSessionExpired: SSO session has expired.
<span class='line'>356</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>357</span>          */</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">        </span><span class="NAME">SSOSessionExpired</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOSessionExpired'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSO session expired'</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>362</span> 
<span class='line'>363</span> </span><span class="WHIT">        </span><span class="COMM">/** ServiceDiscoveryFailure: Cannot find services automatically. Try to set up server addresses manually.
<span class='line'>364</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>365</span>          */</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Cannot find services automatically'</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>370</span> 
<span class='line'>371</span> </span><span class="WHIT">        </span><span class="COMM">/** CannotConnectToServer: Cannot communicate with the server.
<span class='line'>372</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>373</span>          */</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">        </span><span class="NAME">CannotConnectToServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CannotConnectToServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Cannot connect to CUCM server'</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>378</span> 
<span class='line'>379</span> </span><span class="WHIT">        </span><span class="COMM">/** SelectDeviceFailure: Connecting to phone device failed.
<span class='line'>380</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>381</span>          */</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">        </span><span class="NAME">SelectDeviceFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SelectDeviceFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Connecting to phone device failed'</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>386</span> 
<span class='line'>387</span> </span><span class="WHIT">        </span><span class="COMM">/** NoError: no error (success)
<span class='line'>388</span>          * @type $.fn.cwic-errorMapEntry
<span class='line'>389</span>          */</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">        </span><span class="NAME">NoError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">            </span><span class="NAME">code</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NoError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">            </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'No error'</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> 
<span class='line'>396</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorMapAlias</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">        </span><span class="COMM">//origin in plugin - ApiReturnCodeEnum</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">        </span><span class="NAME">eCreateCallFailed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CreateCallError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">        </span><span class="NAME">eCallOperationFailed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CallControlError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">        </span><span class="NAME">eNoActiveDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'PhoneConfigGenError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">        </span><span class="NAME">eLoggedInLock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'TooManyPluginInstances'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">        </span><span class="NAME">eLogoutFailed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SignInError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">        </span><span class="NAME">eNoWindowExists</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'VideoWindowError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">        </span><span class="NAME">eInvalidWindowIdOrObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'VideoWindowError'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// for addPreviewWindow and removePreviewWindow (CSCuo00772 and CSCuo00654)</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">        </span><span class="NAME">eWindowAlreadyExists</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'VideoWindowError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">        </span><span class="NAME">eNoPhoneMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidArgument'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">        </span><span class="NAME">eInvalidArgument</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidArguments'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">        </span><span class="NAME">eOperationNotSupported</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'OperationNotSupported'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">        </span><span class="NAME">eCapabilityMissing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CapabilityMissing'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">        </span><span class="NAME">eNotUserAuthorized</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NotUserAuthorized'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">        </span><span class="NAME">eSyntaxError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">        </span><span class="NAME">eOperationFailed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'OperationFailed'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">        </span><span class="NAME">eInvalidCallId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidArguments'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">        </span><span class="NAME">eInvalidState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidState'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">        </span><span class="NAME">eNoError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NoError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">        </span><span class="NAME">eUnknownServiceEvent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Unknown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// default for service events</span><span class="WHIT">
<span class='line'>417</span> 
<span class='line'>418</span> </span><span class="WHIT">        </span><span class="NAME">Ok</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NoError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>419</span> 
<span class='line'>420</span> </span><span class="WHIT">        </span><span class="COMM">// Telephony service event codes</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">        </span><span class="NAME">Unknown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Unknown'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">        </span><span class="NAME">DeviceRegNoDevicesFound</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NoDevicesFound'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">        </span><span class="NAME">NoCredentialsConfiguredServerHealth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCredential</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCredentialServerHealth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCCMCIPServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidCCMCIPServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">        </span><span class="NAME">InvalidTFTPServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidTFTPServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCTIServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'InvalidCTIServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">        </span><span class="NAME">NoNetwork</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NetworkError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">        </span><span class="NAME">TLSFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NetworkError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">        </span><span class="NAME">SSLConnectError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NetworkError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">        </span><span class="NAME">ServerConnectionFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CannotConnectToServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">        </span><span class="NAME">ServerAuthenticationFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">        </span><span class="NAME">SelectDeviceFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SelectDeviceFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">        </span><span class="NAME">InValidConfig</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//The last attempt at authentication with CUCM failed because of invalid configuration. The CCMIP server, port etc was incorrect.</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">        </span><span class="NAME">ServerCertificateRejected</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CertificateError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">        </span><span class="NAME">InvalidToken</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">        </span><span class="NAME">InvalidAuthorisationTokenServerHealth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>439</span> 
<span class='line'>440</span> </span><span class="WHIT">        </span><span class="COMM">// System service event codes</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">        </span><span class="NAME">ErrorReadingConfig</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ErrorReadingConfig'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">        </span><span class="NAME">InvalidStartupHandlerState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UnexpectedLifecycleState'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">        </span><span class="NAME">InvalidLifeCycleState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UnexpectedLifecycleState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// The Lifecycle was requested to Start or Stop while in an invalid state.</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">        </span><span class="NAME">InvalidCertRejected</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CertificateError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">        </span><span class="NAME">SSOPageLoadError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UnexpectedLifecycleState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// wrong input provided to "OnNavigationCompleted"</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">        </span><span class="NAME">SSOStartSessionError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOStartSessionError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">        </span><span class="NAME">SSOUnknownError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UnexpectedLifecycleState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// wrong input provided to "OnNavigationCompleted"</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">        </span><span class="NAME">SSOCancelled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOCancelled'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">        </span><span class="NAME">SSOCertificateError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CertificateError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">        </span><span class="NAME">SSOInvalidUserSwitch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOInvalidUserSwitch'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">        </span><span class="NAME">SSOWhoAmIFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOStartSessionError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">        </span><span class="NAME">SSOSessionExpired</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'SSOSessionExpired'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryFailure'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Cannot find your services automatically. Click advanced settings to set up manually.</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryAuthenticationFailure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryCannotConnectToCucmServer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CannotConnectToServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryNoCucmConfiguration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryNoSRVRecordsFound</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryFailure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryCannotConnectToEdge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CannotConnectToServer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryNoNetworkConnectivity</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'NetworkError'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">        </span><span class="NAME">ServiceDiscoveryUntrustedCertificate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CertificateError'</span><span class="WHIT">
<span class='line'>461</span> 
<span class='line'>462</span> </span><span class="WHIT">        </span><span class="COMM">// Connection failure codes</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">        </span><span class="COMM">// if something breaks connection during the session</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">        </span><span class="COMM">// a lot of connection failure codes have the same name as above codes, so it's not repeated here.</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>466</span> 
<span class='line'>467</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">backupkey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorMapKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'Unknown'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorMapAlias</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">            </span><span class="NAME">errorMapKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">errorMapAlias</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">            </span><span class="NAME">errorMapKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">backupkey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">errorMapAlias</span><span class="PUNC">[</span><span class="NAME">backupkey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">            </span><span class="NAME">errorMapKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">errorMapAlias</span><span class="PUNC">[</span><span class="NAME">backupkey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">backupkey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">backupkey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">            </span><span class="NAME">errorMapKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">backupkey</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">errorMapKey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>480</span> 
<span class='line'>481</span> </span><span class="WHIT">    </span><span class="COMM">/** cwic global settings, they can be overridden by passing options to init
<span class='line'>482</span>     * @namespace
<span class='line'>483</span>     */</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">settings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">        </span><span class="COMM">/** The handler to be called when the API is ready and authorized.&lt;br>
<span class='line'>486</span>         * The values in the defaults parameter can be used when invoking registerPhone.&lt;br>
<span class='line'>487</span>         * The API is ready when:&lt;ul>
<span class='line'>488</span>         *      &lt;li>The document (DOM) is ready.&lt;/li>
<span class='line'>489</span>         *      &lt;li>The Cisco Web Communicator add-on was found and could be loaded.&lt;/li>
<span class='line'>490</span>         *      &lt;li>User authorization status is "UserAuthorized" (since 3.0.1).&lt;/li>&lt;/ul>
<span class='line'>491</span>         * @type Function=null
<span class='line'>492</span>         * @param {Object} defaults An object containing default values retrieved from URL query parameters user and/or cucm &lt;i>e.g: http://myserver/phone?user=foo&cucm=1.2.3.4 &lt;/i>&lt;br>
<span class='line'>493</span>         * @param {Boolean} registered Phone registration status - true if the phone is already registered (can be used when using SDK in multiple browser tabs), false otherwise
<span class='line'>494</span>         * @param {String} mode The phone's current call control mode - "SoftPhone" or "DeskPhone"
<span class='line'>495</span>         */</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">        </span><span class="NAME">ready</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">        </span><span class="COMM">/** Device prefix to use for default softphone device prediction algorithm. If not set, default prefix is 'ecp'. See also {@link $.fn.cwic-settings.predictDevice}.
<span class='line'>498</span>         * @type String='ecp'
<span class='line'>499</span>         */</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">        </span><span class="NAME">devicePrefix</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ecp'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">        </span><span class="COMM">/** Callback function to predict softphone device name&lt;br>
<span class='line'>502</span>         * Device prediction algorithm is used to predict softphone device name in switchPhoneMode API function. If device name is not provided in the form of non-empty string, predictDevice function is used to predict device name. If custom predictDevice is not provided, default implementation is to concatenate settings.devicePrefix + options.username, where options.username is the name of the currently logged-in user.
<span class='line'>503</span>         * @name $.fn.cwic-settings.predictDevice
<span class='line'>504</span>         * @type Function=null
<span class='line'>505</span>         * @function
<span class='line'>506</span>         * @param {Object} options
<span class='line'>507</span>         * @param {String} options.username
<span class='line'>508</span>         */</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">        </span><span class="COMM">/** A flag to indicate to cwic that it should log more messages.
<span class='line'>510</span>         * @type Boolean=false
<span class='line'>511</span>         */</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">        </span><span class="NAME">verbose</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">        </span><span class="COMM">/** Handler to be called when cwic needs to log information.&lt;br>
<span class='line'>514</span>         * Default is to use console.log if available, otherwise do nothing.
<span class='line'>515</span>         * @function
<span class='line'>516</span>         * @param {String} msg the message
<span class='line'>517</span>         * @param {Object} [context] the context of the message
<span class='line'>518</span>         * @type Function
<span class='line'>519</span>         */</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">        </span><span class="NAME">log</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.log</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">                </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">        </span><span class="COMM">/** The handler to be called if the API could not be initialized.&lt;br>
<span class='line'>529</span>         * The basic properties of the error object are listed, however more may be added based on the context of the error.&lt;br>
<span class='line'>530</span>         * If the triggered error originated from a caught exception, the original error properties are included in the error parameter.&lt;br>
<span class='line'>531</span>         * An error with code 1 (PluginNotAvailable) can have an extra 'pluginDisabled' property set to true.&lt;br>
<span class='line'>532</span>         * @type Function
<span class='line'>533</span>         * @param {Object} error see {@link $.fn.cwic-errorMap}
<span class='line'>534</span>         * @param {String} [error.message] message associated with the error.
<span class='line'>535</span>         * @param {Number} error.code code associated with the error
<span class='line'>536</span>         */</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">        </span><span class="NAME">error</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Error: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>541</span>         * Allows the application to extend the default error map.&lt;br>
<span class='line'>542</span>         * This parameter is a map of error id to {@link $.fn.cwic-errorMapEntry}
<span class='line'>543</span>         * It may also be a map of error id to String
<span class='line'>544</span>         * By default error messages (String) are associated to error codes (map keys, Numbers).&lt;br>
<span class='line'>545</span>         * The application can define new error codes, or associate a different message/object to a pre-defined error code. &lt;br>
<span class='line'>546</span>         *   Default error map: {@link $.fn.cwic-errorMap}&lt;br>
<span class='line'>547</span>         * @name $.fn.cwic-settings.errorMap
<span class='line'>548</span>         * @type $.fn.cwic-errorMapEntry{}
<span class='line'>549</span>         */</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">        </span><span class="NAME">errorMap</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>552</span>         * A callback used to indicate that CWIC must show the user authorization dialog before the application can use
<span class='line'>553</span>         * the CWIC API.  Can be used to display instructions to the user, etc. before the user authorization dialog is
<span class='line'>554</span>         * displayed to the user.  If implemented, the application must call the {@link $.fn.cwic-showUserAuthorization} API to show the
<span class='line'>555</span>         * user authorization dialog and obtain authorization from the user before using the CWIC API.
<span class='line'>556</span>         * If null, the user authorization dialog will be displayed when the application calls CWIC 'init', unless
<span class='line'>557</span>         * the domain has been previously authorized through the authorization dialog by the user selecting the "Always
<span class='line'>558</span>         * Allow" button, or the applications domain has been allowed by administrative whitelist.
<span class='line'>559</span>         * @since 3.0.1
<span class='line'>560</span>         * @type Function=null
<span class='line'>561</span>         * @function
<span class='line'>562</span>         */</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">        </span><span class="NAME">delayedUserAuth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">        </span><span class="COMM">/** 
<span class='line'>565</span>         * A flag to indicate if service discovery based sign in is active. 
<span class='line'>566</span>         * If discovery lifecycle callbacks are not implemented, set this value to false.  
<span class='line'>567</span>         * @type Boolean=true
<span class='line'>568</span>         */</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">        </span><span class="NAME">serviceDiscovery</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>571</span>         * OAuth2 redirect_uri parameter. An URL to which an OAuth token is sent. Required for SSO sign in scenario.
<span class='line'>572</span>         */</span><span class="WHIT">
<span class='line'>573</span> </span><span class="WHIT">        </span><span class="NAME">redirectUri</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>575</span>          * Discovery lifecycle callback for "User Profile Required" lifecycle event. Only happens on first use.
<span class='line'>576</span>          * After first use, plugin caches user email address/domain and callback won't be triggered again.
<span class='line'>577</span>          * Call resetData API to change email address. 
<span class='line'>578</span>          * @param {Function} setEmail          Callback to call to continue with sign-in.
<span class='line'>579</span>          * @param {string}   cachedEmail       Cached previous value of email which could be used to populate input field on UI.
<span class='line'>580</span>          */</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">        </span><span class="NAME">emailRequired</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">setEmail</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cachedEmail</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'emailRequired callback not implemented, cannot proceed with sign in'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">                </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorMap.ServiceDiscoveryMissingOrInvalidCallback.message</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">                </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"emailRequired not implemented"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">                </span><span class="NAME">toString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">": "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.message</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>592</span>          * Discovery lifecycle callback for "Credentials Required" lifecycle event.
<span class='line'>593</span>          * @param {Function} setCredentials    Callback to call to set credentials and to continue with sign-in.
<span class='line'>594</span>          * @param {string}   cachedUser        Cached username value which could be used to populate input field on UI.
<span class='line'>595</span>         */</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">        </span><span class="NAME">credentialsRequired</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">setCredentials</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cachedUser</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'credentialsRequired callback not implemented, cannot proceed with sign in'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">                </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorMap.ServiceDiscoveryMissingOrInvalidCallback.message</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">                </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"credentialsRequired not implemented"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">                </span><span class="NAME">toString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">": "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.message</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>607</span>          * Discovery lifecycle callback for "SSO Signed In" lifecycle state. Only happens when the app has successfully been authenticated. 
<span class='line'>608</span>          * This does not mean that phone is ready to use, telephony device connection flow is initiated afterwards. Implementation of signedIn callback is optional.
<span class='line'>609</span>          */</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">        </span><span class="NAME">signedIn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'default signedIn callback called...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> 
<span class='line'>615</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultSettings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> 
<span class='line'>617</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">resetInitSettings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">        </span><span class="NAME">settings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">defaultSettings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">    </span><span class="COMM">// --------------------------------------------------------</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">    </span><span class="COMM">// Helper tools - BEGIN</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">    </span><span class="COMM">// --------------------------------------------------------</span><span class="WHIT">
<span class='line'>624</span> 
<span class='line'>625</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>626</span>      * Helper function. Wraps a function of arity n into another anonymous function of arity 0. Used for passing a function with bound(pre-set) arguments as properties on event objects.
<span class='line'>627</span>      * @param   {Function} f function to wrap
<span class='line'>628</span>      * @param   {Any} arg f's argument
<span class='line'>629</span>      * @private                  
<span class='line'>630</span>      */</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">wrap</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">            </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fn.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">debounce</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">        </span><span class="COMM">// IE8 has a bug. When createWindow API adds NPAPI object tag, setTimeout function doesn't work any more!</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">        </span><span class="COMM">// So, when IE8 is detected, fallback to no debouncing.</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">        </span><span class="COMM">// jQuery 1.9 removed support for $.browser!</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">$.browser</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*******************************************************************************************************'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*******************************************************************************************************'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Jabber Web SDK with this version of jQuery won't work on IE8! (for IE8 support, use jQuery &lt; 1.9)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*******************************************************************************************************'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*******************************************************************************************************'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.browser.msie</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$.browser.version</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'8.0'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">                </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timeout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">                </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">            </span><span class="NAME">timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">                </span><span class="NAME">timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">                </span><span class="NAME">fn.apply</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>670</span>      * Function decorator which negates the result of passed function 
<span class='line'>671</span>      * @param   {Function} fn function to decorate
<span class='line'>672</span>      * @returns {Function} negated passed-in function
<span class='line'>673</span>      * @private                    
<span class='line'>674</span>      */</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">fn.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>682</span>      * Check if some value is an object. Needed because of JS quirk "typeof null" returns "object"
<span class='line'>683</span>      * @param   {Any} o value to check
<span class='line'>684</span>      * @returns {Boolean} result of check
<span class='line'>685</span>      * @private                   
<span class='line'>686</span>      */</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">isObject</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isNotObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">isObject</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">isNumeric</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">navigator.platform</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">navigator.platform.indexOf</span><span class="PUNC">(</span><span class="STRN">'Mac'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>702</span>      * send string to plugin for encryption
<span class='line'>703</span>      * @param {String} str
<span class='line'>704</span>      * @param {Function} cb(error, result)  callback to be called with result/error
<span class='line'>705</span>      * @private                      
<span class='line'>706</span>      */</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">encrypt</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">                </span><span class="NAME">cb</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">                </span><span class="NAME">cb</span><span class="PUNC">(</span><span class="STRN">'Empty response from plugin'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>715</span> 
<span class='line'>716</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'encryptCucmPassword'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">            </span><span class="NAME">cb</span><span class="PUNC">(</span><span class="STRN">'Invalid input string'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>722</span> 
<span class='line'>723</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validators</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validatorsMap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>725</span> 
<span class='line'>726</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateEmail</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">            </span><span class="COMM">// FUTURE</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateSSOUrl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">            </span><span class="COMM">// FUTURE</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> 
<span class='line'>735</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateUrl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">            </span><span class="COMM">// FUTURE</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>739</span> 
<span class='line'>740</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateUsername</span><span class="PUNC">(</span><span class="NAME">username</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">            </span><span class="COMM">// FUTURE (how to validate encrypted string!?)</span><span class="WHIT">
<span class='line'>742</span> 
<span class='line'>743</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>745</span> 
<span class='line'>746</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validatePassphrase</span><span class="PUNC">(</span><span class="NAME">passphrase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>749</span> 
<span class='line'>750</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateCredentials</span><span class="PUNC">(</span><span class="NAME">usr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateSSOToken</span><span class="PUNC">(</span><span class="NAME">urlFragmentWithToken</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">            </span><span class="COMM">// FUTURE</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">        </span><span class="NAME">validatorsMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">            </span><span class="NAME">email</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateEmail</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateEmail</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateEmail</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">            </span><span class="NAME">ssourl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateSSOUrl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateSSOUrl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateSSOUrl</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">            </span><span class="NAME">credentials</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateCredentials</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateCredentials</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateCredentials</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateUrl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateUrl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateUrl</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">            </span><span class="NAME">passphrase</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validatePassphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validatePassphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validatePassphrase</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">            </span><span class="NAME">username</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateUsername</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateUsername</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateUsername</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">            </span><span class="NAME">ssotoken</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">                </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateSSOToken</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">                </span><span class="NAME">isValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validateSSOToken</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">                </span><span class="NAME">isNotValid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">not</span><span class="PUNC">(</span><span class="NAME">validateSSOToken</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span> 
<span class='line'>797</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">            </span><span class="NAME">get</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getValidator</span><span class="PUNC">(</span><span class="NAME">validatorName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> 
<span class='line'>801</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">validatorName</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' is not a string'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>804</span> 
<span class='line'>805</span> </span><span class="WHIT">                </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorsMap</span><span class="PUNC">[</span><span class="NAME">$.trim</span><span class="PUNC">(</span><span class="NAME">validatorName</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span> 
<span class='line'>807</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="NAME">validatorName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' is not defined'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>812</span> 
<span class='line'>813</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">    </span><span class="COMM">// --------------------------------------------------------</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">    </span><span class="COMM">// Helper tools - END</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">    </span><span class="COMM">// --------------------------------------------------------</span><span class="WHIT">
<span class='line'>820</span> 
<span class='line'>821</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isMultimediaStarted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pendingConnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> 
<span class='line'>824</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastConversationMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> 
<span class='line'>826</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>827</span>     * Registration object with properties of the currently logged in session &lt;br>
<span class='line'>828</span>     * expanded below in _getRegistrationObject() and authenticateCcmcip() &lt;br>
<span class='line'>829</span>     * @type Object
<span class='line'>830</span>     * @private
<span class='line'>831</span>     */</span><span class="WHIT">
<span class='line'>832</span> 
<span class='line'>833</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">        </span><span class="NAME">transferCallGlobals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">            </span><span class="NAME">endTransfer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">                </span><span class="NAME">this.inProgress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">                </span><span class="NAME">this.completeBtn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">                </span><span class="NAME">this.callId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> 
<span class='line'>844</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">resetGlobals</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'resetGlobals: reseting ...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">            </span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">            </span><span class="NAME">manual</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.manual</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">            </span><span class="NAME">unregisterCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.unregisterCb</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// cannot overwrite because it waits for 'SIGNEDOUT' state to occur!</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">            </span><span class="NAME">errorState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorState</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// after error, logout is called. We must save this values for the next sign in attempt </span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">            </span><span class="NAME">lastAuthenticatorId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.lastAuthenticatorId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">            </span><span class="NAME">lastAuthStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.lastAuthStatus</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">            </span><span class="NAME">inProgress</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">            </span><span class="NAME">canCancel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">            </span><span class="COMM">//popup: null, [postponed]</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">            </span><span class="COMM">//popupParams: {}, [postponed]</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">        </span><span class="NAME">transferCallGlobals.endTransfer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">            </span><span class="NAME">registeringPhone</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">            </span><span class="NAME">manual</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">manual</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">            </span><span class="NAME">signingOut</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">            </span><span class="NAME">endingCallForId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">            </span><span class="NAME">switchingMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">            </span><span class="NAME">telephonyDevicesSet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">            </span><span class="NAME">lastConnectedDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">            </span><span class="NAME">lastAuthStatus</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lastAuthStatus</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">            </span><span class="NAME">errorState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorState</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">            </span><span class="NAME">lastAuthenticatorId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lastAuthenticatorId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">            </span><span class="NAME">successCb</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">            </span><span class="NAME">errorCb</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">            </span><span class="NAME">CUCM</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">            </span><span class="NAME">user</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">user</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">            </span><span class="NAME">password</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">            </span><span class="NAME">email</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">            </span><span class="NAME">unregisterCb</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">unregisterCb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">            </span><span class="NAME">authenticatedCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">            </span><span class="NAME">credentialsRequiredCalled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">            </span><span class="NAME">emailRequiredCalled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">        </span><span class="NAME">registration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">            </span><span class="NAME">devices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// map of available devices (key is device name)</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">    </span><span class="NAME">resetGlobals</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">    </span><span class="COMM">// SSO related work</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>897</span>      * Initiates service discovery based sign-in. Before using this API, following callbacks must be defined in init API:
<span class='line'>898</span>      * &lt;ul>
<span class='line'>899</span>      * &lt;li>emailRequired&lt;/li>
<span class='line'>900</span>      * &lt;li>credentialsRequired&lt;/li>
<span class='line'>901</span>      * &lt;li>signedIn&lt;/li>
<span class='line'>902</span>      * &lt;/ul>
<span class='line'>903</span>      * After successfull service discovery either SSO or credentials based authentication occurs depending on UCM configuration.
<span class='line'>904</span>      * @param {Object} args A map with:
<span class='line'>905</span>      * @param {String} [args.mode]  Register the phone in this mode. Available modes are "SoftPhone" or "DeskPhone". Default of intelligent guess is applied after a device is selected.&lt;br>
<span class='line'>906</span>      * @param {Function} [args.devicesAvailable(devices, phoneMode, selectDeviceCb)] Callback called after successful authentication. Might be called multiple times.
<span class='line'>907</span>      * If this callback is not specified, cwic applies the default device selection algorithm.  An array of {@link device} objects is passed so the application can select the device.&lt;br>
<span class='line'>908</span>      * To complete the device registration, call the selectDeviceCb(phoneMode, deviceName, lineDN) function that is passed in to devicesAvailable as the third parameter. 
<span class='line'>909</span>      * lineDN argument is optional and it is valid only in deskphone mode. It is ignored in softphone mode. 
<span class='line'>910</span>      * @param {Boolean} [args.forceRegistration] Specifies whether to forcibly unregister other softphone instances with CUCM. Default is false. See GracefulRegistration doc for more info.
<span class='line'>911</span>      * @param {Function} [args.success(registration)] Callback called when registration succeeds. A {@link registration} object is passed to the callback
<span class='line'>912</span>      * @param {Function} [args.error(errorMapEntry)] Callback called if the registration fails. 
<span class='line'>913</span>      */</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">startDiscovery</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'startDiscovery: empty arguments received'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">            </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'startDiscovery called with arguments: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">        </span><span class="NAME">setRegGlobalsD</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canProceed</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">        </span><span class="COMM">// start service discovery</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals.inProgress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'startSignIn'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">            </span><span class="NAME">manualSettings</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">    </span><span class="COMM">// D for Discovery</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRegGlobalsD</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">devicesAvailableCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.devicesAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.devicesAvailable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.registeringPhone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.manual</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.CUCM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'discovery based address'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.authenticatedCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getAuthenticatedCb</span><span class="PUNC">(</span><span class="NAME">devicesAvailableCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">        </span><span class="COMM">// reset global registration object</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">        </span><span class="NAME">registration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">            </span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.mode</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">            </span><span class="NAME">devices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">            </span><span class="NAME">forceRegistration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.forceRegistration</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRegGlobalsD: regGlobals set: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRegGlobalsD: registration set: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">    </span><span class="COMM">// also triggers error as a side effect. (_triggerError does not stop the execution of current function, so it must be done manually in top function)</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">canProceed</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_plugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Plug-in is not available or has not been initialized'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.mode</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">args.mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">args.mode.match</span><span class="PUNC">(</span><span class="REGX">/^(SoftPhone|DeskPhone)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Invalid phone mode "'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">registration.mode</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">       </span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">    </span><span class="COMM">// authenticatedCallback is called after receiving authenticationresult event with positive outcome</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">    </span><span class="COMM">// required both for manual and sd based sign in</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getAuthenticatedCb</span><span class="PUNC">(</span><span class="NAME">devicesAvailableCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">sendConnectMsg</span><span class="PUNC">(</span><span class="NAME">deviceName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">            </span><span class="COMM">// cannot send connect msg before MM has started</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canConnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isMultimediaStarted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span> 
<span class='line'>984</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">canConnect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot send "connect" now ... waiting for multimedia start!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">                </span><span class="NAME">pendingConnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wrap</span><span class="PUNC">(</span><span class="NAME">sendConnectMsg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>987</span> 
<span class='line'>988</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>990</span> 
<span class='line'>991</span> </span><span class="WHIT">            </span><span class="COMM">// because of stream like behavior of available devices list, availableDevicesCB could be triggered multiple times, </span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">            </span><span class="COMM">// so we need to guard against calling connect multiple times  for the same device </span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">            </span><span class="COMM">// on failure, regGlobals.lastConnectedDevice will be reset, so it should not block connectiong to device again after failure</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">deviceName</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">regGlobals.lastConnectedDevice</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'authenticatedCb: device name empty or already sent "connect" message for this device, returning...'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">            </span><span class="NAME">lineDN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.lastConnectedDevice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'connect'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">                </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">phoneMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration.mode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceRegistration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration.forceRegistration</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">                              </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_devices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultDevice</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">                </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Entering authenticatedCallback'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_devices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'authenticatedCallback: devices list of zero length received'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">             </span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">devicesAvailableCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">                    </span><span class="NAME">devicesAvailableCb</span><span class="PUNC">(</span><span class="NAME">_devices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">registration.mode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">phoneMode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">                        </span><span class="COMM">// in softphone mode, lineDN is not allowed</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">phoneMode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">                            </span><span class="NAME">lineDN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">                        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'connecting to user selected device: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">                        </span><span class="NAME">sendConnectMsg</span><span class="PUNC">(</span><span class="NAME">deviceName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">devicesAvailableException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application devicesAvailable callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">devicesAvailableException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">                        </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">                </span><span class="NAME">defaultDevice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">                </span><span class="COMM">//...use the first available one</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_devices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">registration.mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_devices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isSoftPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">                        </span><span class="COMM">// Note device objects retrieved from ECC will have device model description in device.modelDescription</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">                        </span><span class="COMM">// This differs from csf node.js module 'phoneconfig' implementation which puts it in device.model - this is also removed from 11.0</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">                        </span><span class="COMM">// device.model is removed from 11.0 release</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_devices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modelDescription.match</span><span class="PUNC">(</span><span class="REGX">/^\s*Cisco\s+Unified\s+Client\s+Services\s+Framework\s*$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// On CUCM Product Type: Cisco Unified Client Services Framework</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">                            </span><span class="NAME">defaultDevice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_devices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">                            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">registration.mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'DeskPhone'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_devices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDeskPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">                        </span><span class="NAME">defaultDevice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_devices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">                        </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'connecting to discovered device: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaultDevice</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">                </span><span class="NAME">sendConnectMsg</span><span class="PUNC">(</span><span class="NAME">defaultDevice.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1066</span>      * Cancels ongoing Single Sign On procedure if internal 'canCancelSingleSignOn' capability is enabled. 
<span class='line'>1067</span>      * 'canCancelSingleSignOn' is enabled immediately before 'ssoNavigateTo.cwic' event is triggered. It is disabled again after the token is acquired or after 'cancelSSO' call.
<span class='line'>1068</span>      * @since: 4.0.0 &lt;br>
<span class='line'>1069</span>      */</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">cancelSSO</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SSOGlobals.canCancel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">            </span><span class="COMM">// set to false early to prevent multiple calls to plugin. (It would be set to false anyway by plugin when Lifecycle state changes)</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">            </span><span class="NAME">SSOGlobals.canCancel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'cancelSingleSignOn'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'SSO(cancelSSO): Not possible to cancel SSO in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1084</span>      * Clears cached user and system data. Must be called before manual sign in if previous sign in type was discovery based.
<span class='line'>1085</span>      * Can only be called in signed out state. 
<span class='line'>1086</span>      */</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">resetData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">resetCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">            </span><span class="COMM">// check if success cb means that reset is finished? Maybe call this on InvokeResetData event?</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">        </span><span class="COMM">// it's possible to call this function only in state LifeCycleStateEnum::SIGNEDOUT</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'resetData'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resetCompleted</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">localStorage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Removing data from localStorage...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">            </span><span class="NAME">localStorage.removeItem</span><span class="PUNC">(</span><span class="STRN">'_cwic_cache_email'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1099</span> 
<span class='line'>1100</span> </span><span class="WHIT">    </span><span class="COMM">// FUTURE</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">    </span><span class="COMM">// function getSSOSessionTimeRemaining() {</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">    </span><span class="COMM">//     function remainingTimeCb(time) {</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">    </span><span class="COMM">//         // do something with time</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">    </span><span class="COMM">//     }</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">    </span><span class="COMM">//     _sendClientRequest('getSSOSessionTimeRemaining', remainingTimeCb, {});</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">    </span><span class="COMM">// } </span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1109</span>      * Handler for 'ssonavigateto' event. Constructs valid sso url and triggers public event 'ssoNavigateTo.cwic'.
<span class='line'>1110</span>      * Developers have to implement logic for redirecting to passed url (popup or iframe).
<span class='line'>1111</span>      * @param   {jQuery} $this plugin
<span class='line'>1112</span>      * @param   {String}   url   base url passed from JCF
<span class='line'>1113</span>      * @fires 'ssoNavigateTo.cwic'
<span class='line'>1114</span>      * @private
<span class='line'>1115</span>      */</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerSSONavigateTo</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">settings.redirectUri</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SSOGlobals.args.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.SSOMissingOrInvalidRedirectURI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newUrl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">            </span><span class="NAME">paramsObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">            </span><span class="NAME">urlParts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">url.split</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="WHIT">            </span><span class="NAME">server</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">urlParts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1126</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Plugin sent URL: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1128</span> 
<span class='line'>1129</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">urlParts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'&'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// split url to form ['param1=value', 'param2=value']</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">            </span><span class="COMM">// convert array to object</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">            </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pair.split</span><span class="PUNC">(</span><span class="STRN">'='</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">                </span><span class="NAME">paramsObj</span><span class="PUNC">[</span><span class="NAME">param</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">param</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Invalid SSO URL received'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'SSO authorization service URL invalid format'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1140</span> 
<span class='line'>1141</span> </span><span class="WHIT">        </span><span class="NAME">paramsObj.client_id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'C69908c4f345729af0a23cdfff1d255272de942193e7d39171ddd307bc488d7a1'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">        </span><span class="NAME">paramsObj.redirect_uri</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings.redirectUri</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// encodeURIComponent(settings.redirectUri); - not needed, $ does it in param method</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">        </span><span class="NAME">newUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">server</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'?'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">$.param</span><span class="PUNC">(</span><span class="NAME">paramsObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'New URL generated: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newUrl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'ssoNavigateTo.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">        </span><span class="NAME">event.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newUrl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1152</span> 
<span class='line'>1153</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1154</span>      * Only happens:
<span class='line'>1155</span>      *    1. On first use if bootstrapped 
<span class='line'>1156</span>      *    2. Provisioned keys have  not been set to auto generate user profile (for Jabber)
<span class='line'>1157</span>      *    3. Discovery error occurs
<span class='line'>1158</span>      * @param   {jQuery} $this  jquery object on which SDK is initiated
<span class='line'>1159</span>      * @param   {string[]}  content.errors List of errors
<span class='line'>1160</span>      * @param   {errorMapEntry}   content.error First error from the list converted to errorMapEntry object
<span class='line'>1161</span>      * @private
<span class='line'>1162</span>      */</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerEmailRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">regGlobals.registeringPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">            </span><span class="NAME">emailValidator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validators.get</span><span class="PUNC">(</span><span class="STRN">'email'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">            </span><span class="NAME">cachedEmail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">            </span><span class="NAME">emailFromLocalStorage</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setEmailAddress</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setEmailAddress: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">emailValidator.isNotValid</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">                </span><span class="NAME">_triggerEmailRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">                    </span><span class="NAME">error</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'InvalidUserInput'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">                    </span><span class="NAME">errors</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'Invalid email submited'</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1180</span> 
<span class='line'>1181</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1183</span> 
<span class='line'>1184</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">emailForManualSignIn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">                </span><span class="NAME">registration.email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">localStorage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">emailForManualSignIn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">localStorage.getItem</span><span class="PUNC">(</span><span class="STRN">'_cwic_cache_email'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'saving email to localStorage'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">                    </span><span class="NAME">localStorage.setItem</span><span class="PUNC">(</span><span class="STRN">'_cwic_cache_email'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'localStorage not available, check IE mode the app is running in ...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setUserProfileEmailAddress'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">email</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">        </span><span class="COMM">// if manual login, skip emailRequired callback calling and immediately set email with arbitrary value, it will be ignored anyway</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">        </span><span class="COMM">// if error is present, call error callback, defined in registerPhone args, and optionally stop lifecycle</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.manual</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">                </span><span class="NAME">stopSignInFromER</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">setEmailAddress</span><span class="PUNC">(</span><span class="NAME">emailForManualSignIn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.emailReguiredCalled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">                </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ServiceDiscoveryFailure'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stopSignInFromER</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.emailReguiredCalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">localStorage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">            </span><span class="NAME">emailFromLocalStorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">localStorage.getItem</span><span class="PUNC">(</span><span class="STRN">'_cwic_cache_email'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">emailFromLocalStorage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">                </span><span class="NAME">setEmailAddress</span><span class="PUNC">(</span><span class="NAME">emailFromLocalStorage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'localStorage not available, check IE mode the app is running in ...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">emailForManualSignIn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">            </span><span class="NAME">cachedEmail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.email</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">            </span><span class="NAME">cachedEmail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'@'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">            </span><span class="NAME">settings.emailRequired</span><span class="PUNC">(</span><span class="NAME">setEmailAddress</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cachedEmail</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">            </span><span class="COMM">// not implemented</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.ServiceDiscoveryMissingOrInvalidCallback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1249</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1250</span>      * Handler for credentialsrequired event (Service discovery found home cluster without SSO enabled). Only happens when:
<span class='line'>1251</span>      *        1. Non SSO sign out
<span class='line'>1252</span>      *        2. Non SSO credentials not already set
<span class='line'>1253</span>      *        3. Non SSO authentication error
<span class='line'>1254</span>      * @param   {Object}   content event arguments object
<span class='line'>1255</span>      * @param   {string[]}   content.errors List of status or error messages
<span class='line'>1256</span>      * @param   {errorMapEntry}   content.error First error from the list converted to errorMapEntry object
<span class='line'>1257</span>      * @param   {Number}   content.authenticatorId Authenticator ID for which credentials are required                          
<span class='line'>1258</span>      * @private
<span class='line'>1259</span>      */</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerCredentialsRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">regGlobals.registeringPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">            </span><span class="NAME">credentialsValidator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validators.get</span><span class="PUNC">(</span><span class="STRN">'credentials'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">            </span><span class="NAME">authId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.authenticatorId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">            </span><span class="NAME">cachedUser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">        </span><span class="COMM">// --------------------------------------------  </span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">provideManualCredentials</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">regGlobals.passphrase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">setCredentials</span><span class="PUNC">(</span><span class="NAME">regGlobals.user</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.passphrase</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">                </span><span class="COMM">// should never happened, because credentials are checked in the beginning of registerPhone API</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">                </span><span class="COMM">// ... actually it happens after sign out, if the following credentialsRequired event is not ignored.</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">                </span><span class="NAME">stopSignInFromCR</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getUserFromCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.user</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">regGlobals.user</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">regGlobals.email</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">regGlobals.email.split</span><span class="PUNC">(</span><span class="STRN">'@'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">callCredentialsRequiredCb</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">regGlobals.credentialsRequiredCalled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stopSignInFromCR</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.credentialsRequiredCalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">                </span><span class="NAME">settings.credentialsRequired</span><span class="PUNC">(</span><span class="NAME">setCredentials</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cachedUser</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">                </span><span class="COMM">// not implemented or exception occurred</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.ServiceDiscoveryMissingOrInvalidCallback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setCredentials</span><span class="PUNC">(</span><span class="NAME">username</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isEncrypted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'NativePluginError'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">                </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> 
<span class='line'>1316</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setUserProfileCredentials'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">                    </span><span class="NAME">username</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">username</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">                    </span><span class="NAME">password</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">                    </span><span class="NAME">authenticator</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">passphrase.encrypted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">                </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">passphrase.encrypted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">                </span><span class="NAME">isEncrypted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1327</span> 
<span class='line'>1328</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">credentialsValidator.isNotValid</span><span class="PUNC">(</span><span class="NAME">username</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerCredentialsRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">                    </span><span class="NAME">errors</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'InvalidCredentials'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">                    </span><span class="NAME">error</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'AuthenticationFailure'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">                    </span><span class="NAME">authenticatorId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">            </span><span class="NAME">registration.user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">username</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isEncrypted</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">                </span><span class="NAME">encrypt</span><span class="PUNC">(</span><span class="NAME">passphrase</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setUserProfileCredentials'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">                    </span><span class="NAME">username</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">username</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">                    </span><span class="NAME">password</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">                    </span><span class="NAME">authenticator</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">        </span><span class="COMM">//-------------------------------------------------------------</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">        </span><span class="COMM">// if manual login, skip credentialsRequired callback calling and immediately set credentials with user provided values</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">        </span><span class="COMM">// when logged in in manual mode, then signout, credentialsRequired event will be triggered, but we need to ignore it</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.manual</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from credentialsRequired in manual mode, because of error...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">                </span><span class="NAME">stopSignInFromCR</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">            </span><span class="NAME">provideManualCredentials</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">            </span><span class="NAME">cachedUser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getUserFromCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">            </span><span class="NAME">callCredentialsRequiredCb</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">    </span><span class="COMM">// CR for Credentials Required</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stopSignInFromCR</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.errorState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'credentialsRequired'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.lastAuthenticatorId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">authId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">        </span><span class="NAME">stopSignIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">    </span><span class="COMM">// ER for Email Required</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stopSignInFromER</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.errorState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'emailRequired'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">        </span><span class="NAME">localStorage</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">localStorage.removeItem</span><span class="PUNC">(</span><span class="STRN">'_cwic_cache_email'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">        </span><span class="NAME">stopSignIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1381</span> 
<span class='line'>1382</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stopSignIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.AuthenticationFailure</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">        </span><span class="NAME">resetGlobals</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// will delete errorCb, don't call it before</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerSSOSignInFailed</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">regGlobals.registeringPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals.inProgress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">        </span><span class="NAME">stopSignIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1399</span>      * Only happens when the app has successfully been authenticated with the primary authenticator. Calls signedIn callback.
<span class='line'>1400</span>      * SignedIn state means that Lifecycle state is changed to 'SIGNEDIN'. Device connection is performed after this event is triggered.
<span class='line'>1401</span>      * @param {JQuery} $this 
<span class='line'>1402</span>      * @private                             
<span class='line'>1403</span>      */</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerSignedIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals.inProgress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerSignedIn called'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerSignedIn: authenticatedCB present: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.authenticatedCallback</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerSignedIn: telephonyDevicesSet: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.telephonyDevicesSet</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> 
<span class='line'>1410</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.authenticatedCallback</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">regGlobals.telephonyDevicesSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">           </span><span class="COMM">// regGlobals.telephonyDevicesSet = false; // it will be reset on sign out</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Proceeding with device selection immediately after SignedIn event'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">            </span><span class="NAME">proceedWithDeviceSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">            </span><span class="COMM">// device selection will be done after devices are received... see _triggerTelephonyDevicesChange</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerSignedIn: Cannot proceed with device selection until devices are ready...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1418</span> 
<span class='line'>1419</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">            </span><span class="NAME">settings.signedIn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">            </span><span class="COMM">// signedIn callback is optional</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'No signedIn callback defined...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1428</span>      * Handler for telephonydeviceschange event. Triggered every time devices are changed.
<span class='line'>1429</span>      * When user is switched, this event will also triger with empty device list. That event should be filtered.
<span class='line'>1430</span>      * @param {Array}   content.devices array of available devices
<span class='line'>1431</span>      * @private
<span class='line'>1432</span>      */</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerTelephonyDevicesChange</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerTelephonyDevicesChange called with following data: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerTelephonyDevicesChange: regGlobals: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1436</span> 
<span class='line'>1437</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.devices</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.devices.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">regGlobals.registeringPhone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">            </span><span class="COMM">// TelephonyDevicesChange event is triggered for each device in the list. We don't know when the last device is discovered.</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">            </span><span class="COMM">// calling getAvailableDevices after first TelephonyDevicesChange event is received seems to be good enough.</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">            </span><span class="COMM">// additionally we debounced TelephonyDevicesChange event, so this callback will be called only after timeout of 20ms expires between successive events</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.telephonyDevicesSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> 
<span class='line'>1443</span> </span><span class="WHIT">            </span><span class="COMM">// We now want to call devices available cb for every change event during registration.</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Proceeding with device selection after waiting for TelephonyDevicesChange event.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">            </span><span class="NAME">proceedWithDeviceSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">    </span><span class="COMM">// debounce to reduce possibility for devicesAvailableCb to be called more then once ... but anyway it should not be a problem if it's called more then once.</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_triggerTelephonyDevicesChangeDebounced</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">debounce</span><span class="PUNC">(</span><span class="NAME">_triggerTelephonyDevicesChange</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">proceedWithDeviceSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'proceedWithDeviceSelection called'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">        </span><span class="NAME">_updateRegistration</span><span class="PUNC">(</span><span class="NAME">regGlobals.currState</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.authenticatedCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1458</span>      * Handler for invokeresetdata event. It should clear all cached information by browser.
<span class='line'>1459</span>      * In reality it can just clear/reset to default SSOGlobals object.
<span class='line'>1460</span>      * Candidate for removal.
<span class='line'>1461</span>      * @private
<span class='line'>1462</span>      */</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerInvokeResetData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'SSO: Invoke Reset Data Triggered.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1466</span> 
<span class='line'>1467</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1468</span>      * Handler for ssoshowwindow event. It signals when the popup/iframe for SSO login should be shown/hidden during the
<span class='line'>1469</span>      * login phase.
<span class='line'>1470</span>      * This is Jabber specific. Jabber SDK does not send URL for every page HTML page, but only when token is acquired.
<span class='line'>1471</span>      * Candidate for removal.
<span class='line'>1472</span>      * @private
<span class='line'>1473</span>      */</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerSSOShowWindow</span><span class="PUNC">(</span><span class="NAME">show</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'SSO: Show Window Triggered!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1479</span>      * Handler for lifecyclestatechanged event.
<span class='line'>1480</span>      * @param {string} content New lifecycle state (CSFUnified::LifeCycleStateEnum::LifeCycleState)
<span class='line'>1481</span>      * Candidate for removal.
<span class='line'>1482</span>      * @private                        
<span class='line'>1483</span>      */</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerLifecycleStateChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'System lifecycle state changed. New state: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1486</span> 
<span class='line'>1487</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.signingOut</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SIGNEDOUT'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.signingOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">            </span><span class="COMM">// emulating eIdle connection state to force calling of 'unregisterCb'</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">            </span><span class="COMM">// because SIGNEDOUT lifecycle state comes a lot earlier than connection state update.</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">            </span><span class="COMM">// Registered phone is unavailable in between anyway.</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">            </span><span class="NAME">_triggerProviderEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'eIdle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1493</span> 
<span class='line'>1494</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1495</span> 
<span class='line'>1496</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SIGNINGOUT'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.signingOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">        </span><span class="COMM">// calling reset in the middle of discovery sign in lifecycle, causes Authentication Failure, if emailrequired callback is already called</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">        </span><span class="COMM">// ...so during reset we reset emailReguiredCalled flag to handle this situation...</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'RESETTING'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.emailReguiredCalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1505</span> 
<span class='line'>1506</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1509</span>      * Handler for lifecyclessosessionchanged event. Used only for debugging.
<span class='line'>1510</span>      * @param {string} content New lifecycle session state
<span class='line'>1511</span>      * Candidate for removal.
<span class='line'>1512</span>      * @private                        
<span class='line'>1513</span>      */</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerLifecycleSSOSessionChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'SSO: Lifecycle session changed. New state: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1519</span>      * Handler for cancancelssochanged event. Signals if it is possible to cancel ongoing SSO login.
<span class='line'>1520</span>      * @param {Object}   content 
<span class='line'>1521</span>      * @param {Boolean}   content.cancancel  
<span class='line'>1522</span>      * @private                                      
<span class='line'>1523</span>      */</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerCanCancelSSOChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'SSO: CanCancel property changed. New state: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content.cancancel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">        </span><span class="NAME">SSOGlobals.canCancel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.cancancel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1530</span>      * internal function to release all SSO related resources on
<span class='line'>1531</span>      * (window.unload event) and on invokeResetData
<span class='line'>1532</span>      * To be implemented if needed
<span class='line'>1533</span>      * @private
<span class='line'>1534</span>      */</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_resetSSO</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1536</span> 
<span class='line'>1537</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">    </span><span class="COMM">// END SSO related work</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">    </span><span class="COMM">// Certificate validation</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">    </span><span class="COMM">// callback which submits user's choice to accept or reject the certificate</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">    </span><span class="COMM">// fp - string, accept - boolean</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">handleInvalidCert</span><span class="PUNC">(</span><span class="NAME">fp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fp</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">fp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'handleInvalidCertificate sending response: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' (for fingerprint - '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'handleInvalidCertificate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">certFingerprint</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">                                                           </span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">'handleInvalidCert: Wrong arguments!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">    </span><span class="COMM">// Inalid certificate event handler</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerInvalidCertificate</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">        </span><span class="COMM">/*
<span class='line'>1560</span>             content properties:
<span class='line'>1561</span>                 - certFingerprint
<span class='line'>1562</span>                 - identifierToDisplay
<span class='line'>1563</span>                 - certSubjectCN
<span class='line'>1564</span>                 - referenceId
<span class='line'>1565</span>                 - invalidReasons
<span class='line'>1566</span>                 - subjectCertificateData
<span class='line'>1567</span>                 - intermediateCACertificateData
<span class='line'>1568</span>                 - allowUserToAccept
<span class='line'>1569</span>                 - persistAcceptedDecision
<span class='line'>1570</span>         */</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">content.invalidReasons</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">            </span><span class="NAME">content.invalidReasons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.map</span><span class="PUNC">(</span><span class="NAME">content.invalidReasons</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elem.invalidReason</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">            </span><span class="NAME">content.invalidReasons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">        </span><span class="COMM">//Emit public event</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'invalidCertificate.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">        </span><span class="NAME">event.info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">        </span><span class="NAME">event.respond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">handleInvalidCert</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> 
<span class='line'>1583</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">    </span><span class="COMM">// END Certificate validation</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">    </span><span class="COMM">//******************************************</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">    </span><span class="COMM">// -------------------------------------------</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">    </span><span class="COMM">// BEGIN: Call transfer related event handling</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">    </span><span class="COMM">// -------------------------------------------</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1594</span>      * Completes ongoing call transfer
<span class='line'>1595</span>      * @param {Number} callId conversation id of active conversation
<span class='line'>1596</span>      * @private                       
<span class='line'>1597</span>      */</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">completeTransfer</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transferCallGlobals.inProgress</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'completeTransfer'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'completeTransfer'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">            </span><span class="NAME">transferCallGlobals.endTransfer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'completeTransfer: transfer not in progress, returning from function...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1614</span>      * Enables button wrapped in jQuery object
<span class='line'>1615</span>      * @param   {jQuery} $el selected button object
<span class='line'>1616</span>      * @returns {jQuery} button passed-in
<span class='line'>1617</span>      * @private                         
<span class='line'>1618</span>      */</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">enable</span><span class="PUNC">(</span><span class="NAME">$el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">$el</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">jQuery</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">'enable function accepts only jQuerys'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">        </span><span class="NAME">$el.attr</span><span class="PUNC">(</span><span class="STRN">'disabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1628</span>      * Disables button wrapped in jQuery object
<span class='line'>1629</span>      * @param   {jQuery} $el selected button object
<span class='line'>1630</span>      * @returns {jQuery} button passed-in
<span class='line'>1631</span>      * @private                         
<span class='line'>1632</span>      */</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">disable</span><span class="PUNC">(</span><span class="NAME">$el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">$el</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">jQuery</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">'disable function accepts only jQuery objects'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">        </span><span class="NAME">$el.attr</span><span class="PUNC">(</span><span class="STRN">'disabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>1641</span> 
<span class='line'>1642</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1643</span>      * Event handler for 'attendedtransferstatechange' event
<span class='line'>1644</span>      * @private
<span class='line'>1645</span>      */</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerAttendedTransferStateChange</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">        </span><span class="COMM">//Emit public event</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'callTransferInProgress.cwic'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">            </span><span class="NAME">callId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.callId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">            </span><span class="NAME">$completeBtn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">transferCallGlobals.completeBtn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">        </span><span class="NAME">transferCallGlobals.callId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">        </span><span class="COMM">// add wrapped function to event object</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">        </span><span class="NAME">event.completeTransfer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wrap</span><span class="PUNC">(</span><span class="NAME">completeTransfer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">        </span><span class="COMM">/**Helper function for completing call transfer. Calls passed-in function and disables complete and cancel buttons
<span class='line'>1658</span>          * @param   {Function} f function wrap and to call before disabling buttons 
<span class='line'>1659</span>          * @returns {Function} wrapped function, ready to be attached as event handler 
<span class='line'>1660</span>          * @private                    
<span class='line'>1661</span>          */</span><span class="WHIT">      </span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">finishCallTransfer</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">            </span><span class="NAME">completeTransfer</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$completeBtn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">                </span><span class="NAME">disable</span><span class="PUNC">(</span><span class="NAME">$completeBtn</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">unbind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1669</span> 
<span class='line'>1670</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_triggerAttendedTransferStateChange: No callId received from the plugin. Returning from the function...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_triggerAttendedTransferStateChange: Received callId: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">        </span><span class="COMM">// check if complete and cancel buttons are passed in</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">$completeBtn</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">            </span><span class="NAME">$completeBtn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">$completeBtn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">        </span><span class="COMM">// duck typing to check if passed-in buttons are jQuery objects that we need</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$completeBtn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">$completeBtn.one</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$completeBtn.attr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">            </span><span class="NAME">enable</span><span class="PUNC">(</span><span class="NAME">$completeBtn</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">unbind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">one</span><span class="PUNC">(</span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">finishCallTransfer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> 
<span class='line'>1685</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">            </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">    </span><span class="COMM">// ------------------------------------------</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">    </span><span class="COMM">// END: Call transfer related event handling</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">    </span><span class="COMM">// ------------------------------------------</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerCurrentRingtoneChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'ringtoneChange.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">        </span><span class="NAME">event.currentRingtone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.ringtone</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1701</span> 
<span class='line'>1702</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerMultimediaCapabilitiesStarted</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isMultimediaCapabilityStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">        </span><span class="NAME">isMultimediaStarted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isMultimediaCapabilityStarted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'multimediaCapabilities.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">        </span><span class="NAME">event.multimediaCapability</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isMultimediaCapabilityStarted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaCapabilityStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">            </span><span class="NAME">getAvailableRingtones</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">                </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1714</span> 
<span class='line'>1715</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">pendingConnect</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Sending delayed "connect" message'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">                </span><span class="NAME">pendingConnect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">                </span><span class="NAME">pendingConnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1722</span> 
<span class='line'>1723</span> 
<span class='line'>1724</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1725</span>     * an internal function to log messages
<span class='line'>1726</span>     * @param {Boolean} [isVerbose] indicates if msg should be logged in verbose mode only (configurable by the application). true - show this log only in verbose mode, false - always show this log  &lt;br>
<span class='line'>1727</span>     * @param {String} msg the message to be logged (to console.log by default, configurable by the application)  &lt;br>
<span class='line'>1728</span>     * @param {Object} [context] a context to be logged &lt;br>
<span class='line'>1729</span>     */</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isVerbose</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1734</span> 
<span class='line'>1735</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isVerbose</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isVerbose</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">settings.verbose</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">settings.log</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timelog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">                              </span><span class="PUNC">(</span><span class="STRN">'0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">                              </span><span class="NAME">current.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">                              </span><span class="PUNC">(</span><span class="STRN">'0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">current.getHours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">':'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">                              </span><span class="PUNC">(</span><span class="STRN">'0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">current.getMinutes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">':'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">                              </span><span class="PUNC">(</span><span class="STRN">'0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">current.getSeconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">                              </span><span class="PUNC">(</span><span class="STRN">'00'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">current.getMilliseconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">                </span><span class="NAME">settings.log</span><span class="PUNC">(</span><span class="STRN">'[cwic] '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">timelog</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">                </span><span class="COMM">// Exceptions in application-define log functions can't really be logged</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1751</span> 
<span class='line'>1752</span> </span><span class="WHIT">    </span><span class="COMM">// Helper function to check if plug-in is still available.</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">    </span><span class="COMM">// Related to DE3975. The CK advanced editor causes the overflow CSS attribute to change, which in turn</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">    </span><span class="COMM">// removes and replaces the plug-in during the reflow losing all state.</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_doesPluginExist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_plugin.api</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_doesPluginExist failed basic existence check'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">            </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">_plugin.api.sendRequest</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">_plugin.api.postMessage</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_doesPluginExist failed sendRequest/postMessage method check'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">            </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1764</span> 
<span class='line'>1765</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1767</span> 
<span class='line'>1768</span> </span><span class="WHIT">    </span><span class="COMM">// support unit tests for IE</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">    </span><span class="COMM">// should be more transparent than this, but tell that to internet explorer - you can't override attachEvent...</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_addListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">            </span><span class="COMM">// if the object has a method called _addListener, then we're running a unit test.</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj._addListener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">                </span><span class="NAME">obj._addListener</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj.attachEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">                </span><span class="NAME">obj.attachEvent</span><span class="PUNC">(</span><span class="STRN">'on'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">                </span><span class="NAME">obj.addEventListener</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_addListener error: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_removeListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">            </span><span class="COMM">// if the object has a method called _addListener, then we're running a unit test.</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj._addListener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">                </span><span class="COMM">//obj._removeListener(type,handler,false);</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj.attachEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">                </span><span class="NAME">obj.detachEvent</span><span class="PUNC">(</span><span class="STRN">'on'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">                </span><span class="NAME">obj.removeEventListener</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_removeListener error: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1799</span> 
<span class='line'>1800</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_handlePluginMessage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_handlePluginMessage</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_plugin.scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">            </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1803</span> 
<span class='line'>1804</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoChannelServerMessage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoChannelServerMessage.name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'ChannelDisconnect'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Extension channel disconnected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelServerMessage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">                </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">                </span><span class="NAME">clientRequestCallbacks.purge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.ExtensionNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Lost connection to browser extension'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoChannelServerMessage.name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'HostDisconnect'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Host application disconnected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelServerMessage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">                </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">                </span><span class="NAME">clientRequestCallbacks.purge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Lost connection to plugin'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'ciscoChannelServerMessage unknown name: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelServerMessage.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoSDKServerMessage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.ciscoSDKServerMessage.content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.ciscoSDKServerMessage.error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.ciscoSDKServerMessage.replyToMessageId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.ciscoSDKServerMessage.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1823</span> 
<span class='line'>1824</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_handlePluginMessage: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg.ciscoSDKServerMessage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> 
<span class='line'>1826</span> </span><span class="WHIT">            </span><span class="COMM">// *************************************************************</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">            </span><span class="COMM">// Lifecycle errors customizations BEGIN</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">            </span><span class="COMM">// *************************************************************</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">            </span><span class="COMM">// plugin sends an array of error codes. We never seen more then one error in that array,</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">            </span><span class="COMM">// so we will take only the first error and send it as a string to handlers instead of array.</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">            </span><span class="COMM">// We will log other errors if present</span><span class="WHIT">
<span class='line'>1832</span> 
<span class='line'>1833</span> </span><span class="WHIT">            </span><span class="COMM">// content.errors is like [{error: 'err1'}, {error:'err2'}]</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">            </span><span class="COMM">// simplify it to array of strings.</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.errors</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">                </span><span class="NAME">content.errors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.map</span><span class="PUNC">(</span><span class="NAME">content.errors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">errorObj.error</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">errorObj.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> 
<span class='line'>1840</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Lifecycle error list contains '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content.errors.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' errors'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">content.errors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Lifecycle error from the list'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content.errors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">                </span><span class="NAME">content.error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.errors.length</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">                        </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">content.errors</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">                        </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">            </span><span class="COMM">// empty string is passed when there is no error is JCF</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.errors</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Received empty string instead of lifecycle error list'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">                </span><span class="NAME">content.errors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">                </span><span class="NAME">content.error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1856</span> 
<span class='line'>1857</span> </span><span class="WHIT">            </span><span class="COMM">// *************************************************************</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">            </span><span class="COMM">// Lifecycle errors customizations END</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">            </span><span class="COMM">// *************************************************************</span><span class="WHIT">
<span class='line'>1860</span> 
<span class='line'>1861</span> 
<span class='line'>1862</span> </span><span class="WHIT">            </span><span class="COMM">// first check if we have a callback waiting</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msgId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">                </span><span class="NAME">clientRequestCallbacks.callCallback</span><span class="PUNC">(</span><span class="NAME">msgId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1866</span> 
<span class='line'>1867</span> </span><span class="WHIT">            </span><span class="COMM">// then trigger any other matching events</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'init'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">                </span><span class="NAME">_cwic_onInitReceived</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'userauthorized'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">                </span><span class="NAME">_cwic_userAuthHandler</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'connectionstatuschange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">                </span><span class="NAME">_triggerProviderEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'multimediacapabilitiesstarted'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">                </span><span class="NAME">_triggerMultimediaCapabilitiesStarted</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'multimediacapabilitiesstopped'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">                </span><span class="NAME">_triggerMultimediaCapabilitiesStarted</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ringtonechanged'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">                </span><span class="NAME">_triggerCurrentRingtoneChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'attendedtransferstatechange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">                </span><span class="NAME">_triggerAttendedTransferStateChange</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'multimediadevicechange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">                 </span><span class="COMM">//multimedia devices changed, now go get the new list</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">                    </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'connectionfailure'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">                </span><span class="COMM">// all errors should be handled through lifecycle states</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Connection Failure event received with reason: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'None'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Received "None", returning...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'ServerConnectionFailure'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'authenticationresult'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="WHIT">                </span><span class="NAME">_triggerAuthResultAndStatus</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'telephonydeviceschange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">                </span><span class="NAME">_triggerTelephonyDevicesChangeDebounced</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'callstatechange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">                </span><span class="NAME">_triggerConversationEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'externalwindowevent'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">                </span><span class="NAME">_triggerExternalWindowEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">                </span><span class="COMM">//for docking to work we need to know when video is being received</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">                </span><span class="NAME">dockGlobals.isVideoBeingReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.showing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'dockexternalwindowneeded'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">                </span><span class="NAME">_triggerDockExternalWindowNeeded</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'videoresolutionchange'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'video resolution change detected for call '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content.callId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">                     </span><span class="STRN">'. Height: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content.height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">                     </span><span class="STRN">', width: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">content.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">                </span><span class="COMM">// trigger a conversation event with a 'videoResolution' property</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">                </span><span class="NAME">_triggerConversationEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">                    </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content.callId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">                    </span><span class="NAME">videoResolution</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">                        </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">                        </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content.height</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'render'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ssonavigateto'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">                </span><span class="NAME">_triggerSSONavigateTo</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'userprofilecredentialsrequired'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">                </span><span class="COMM">// content.errors - [string], content.error - string, content.authenticatorId - number</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">                </span><span class="NAME">_triggerCredentialsRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ssosigninrequired'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="WHIT">                </span><span class="COMM">// content.errors - [string], content.error - string</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">                </span><span class="NAME">_triggerSSOSignInFailed</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'userprofileemailaddressrequired'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">                </span><span class="COMM">// content.errors - [string], content.error - string</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">                </span><span class="NAME">_triggerEmailRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'loggedin'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">                </span><span class="NAME">_triggerSignedIn</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'invokeresetdata'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="WHIT">                </span><span class="NAME">_triggerInvokeResetData</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ssoshowwindow'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">                </span><span class="NAME">_triggerSSOShowWindow</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ssosessionexpirypromptrequired'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">                </span><span class="NAME">_triggerSSOSessionExpiryPromptRequired</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'lifecyclestatechanged'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">                </span><span class="NAME">_triggerLifecycleStateChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'lifecyclessosessionchanged'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">                </span><span class="NAME">_triggerLifecycleSSOSessionChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'cancancelsinglesignonchanged'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">                </span><span class="NAME">_triggerCanCancelSSOChanged</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'invalidcertificate'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">                </span><span class="NAME">_triggerInvalidCertificate</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">               </span><span class="COMM">// _log(true, 'ciscoSDKServerMessage unknown name '+name, msg);</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Unknown msg from plugin: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1984</span> 
<span class='line'>1985</span> 
<span class='line'>1986</span> </span><span class="WHIT">    </span><span class="COMM">// Good-enough unique ID generation:</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">    </span><span class="COMM">// used for clienId (generated only once per cwic instance) and message ids (generated for each message)</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">    </span><span class="COMM">// Just needs to be unique for this channel across restarts of this client,</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">    </span><span class="COMM">// just in case there's an old server reply in the pipeline.</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateUniqueId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">valueOf</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">10000</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1993</span> 
<span class='line'>1994</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1995</span>     * sends clientRequest message to browser plugin/extension
<span class='line'>1996</span>     * @param {String} name
<span class='line'>1997</span>     * @param {Object|String} content Object or string to be passed as arguments for the named request
<span class='line'>1998</span>     * @param {Function} [successCb(result)] Function to be called upon recieving success reply to the request.
<span class='line'>1999</span>     *                    replyCb should take object as argument the return result from native function.
<span class='line'>2000</span>     * @param {Function} [errorCb(errorMapAlias)] Function to be called upon recieving error reply to the request.
<span class='line'>2001</span>     *                    errorCb should take object as argument an errorMapAlias string.  If no errorCb is provided
<span class='line'>2002</span>     *                    then a generic error.cwic event will be triggered instead.
<span class='line'>2003</span>     * @private
<span class='line'>2004</span>     */</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_plugin.api</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_sendClientRequest no plugin available'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2010</span> 
<span class='line'>2011</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_plugin.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2015</span> 
<span class='line'>2016</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">            </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">            </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2021</span> 
<span class='line'>2022</span> </span><span class="WHIT">        </span><span class="COMM">// create a default error callback</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorMapAlias</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">errorMapAlias</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">'nativeError'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorMapAlias</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'nativeRequest'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'nativeArgs'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'error returned from native plugin'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> 
<span class='line'>2027</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">                </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">                </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2034</span> 
<span class='line'>2035</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">            </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2038</span> 
<span class='line'>2039</span> </span><span class="WHIT">        </span><span class="COMM">// if nothing else, default to no-op</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">        </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2041</span> 
<span class='line'>2042</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maskContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'encryptCucmPassword'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'*****'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_sendClientRequest: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">'successCb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'errorCb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'content'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">maskContent</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2044</span> 
<span class='line'>2045</span> 
<span class='line'>2046</span> </span><span class="WHIT">        </span><span class="COMM">// Good-enough unique ID generation:</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">        </span><span class="COMM">// Just needs to be unique for this channel across restarts of this client,</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">        </span><span class="COMM">// just in case there's an old server reply in the pipeline.</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'init'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">generateUniqueId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2050</span> 
<span class='line'>2051</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientMsg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">            </span><span class="NAME">ciscoSDKClientMessage</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">                </span><span class="STRN">'messageId'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">                </span><span class="STRN">'name'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">                </span><span class="COMM">// if null, set content undefined so that it is omited from the JSON msg</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">                </span><span class="STRN">'content'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2059</span> 
<span class='line'>2060</span> </span><span class="WHIT">        </span><span class="COMM">// clone the msg object to allow masking of password for the log</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">logMsg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clientMsg.ciscoSDKClientMessage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">        </span><span class="NAME">logMsg.content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maskContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'send ciscoSDKClientMessage: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">logMsg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2064</span> 
<span class='line'>2065</span> </span><span class="WHIT">        </span><span class="COMM">//send message to Chrome</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.api.sendRequest</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.api.sendRequest</span><span class="PUNC">(</span><span class="NAME">clientMsg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.api.postMessage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">            </span><span class="NAME">clientId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clientId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">generateUniqueId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientInfoJSON</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">                    </span><span class="STRN">'id'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">                    </span><span class="STRN">'url'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">window.location.href</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">                    </span><span class="STRN">'hostname'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">window.location.hostname</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">                    </span><span class="STRN">'name'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">window.document.title</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">            </span><span class="COMM">//*****JSON message changed, so it fits NPAPI expectations</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">NPAPI_Msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">'ciscoChannelMessage'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">clientMsg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">'client'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientInfoJSON</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> 
<span class='line'>2079</span> </span><span class="WHIT">            </span><span class="COMM">//send message to browsers that support NPAPI</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.api.postMessage</span><span class="PUNC">(</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">NPAPI_Msg</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2082</span> 
<span class='line'>2083</span> </span><span class="WHIT">        </span><span class="COMM">// asynchronous back end so we store the callback</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">        </span><span class="NAME">clientRequestCallbacks.callbacks</span><span class="PUNC">[</span><span class="NAME">uid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">'successCb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'errorCb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2086</span> 
<span class='line'>2087</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientRequestCallbacks</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">        </span><span class="COMM">// callbacks[messageId] = { 'successCb' : successCb, 'errorCb' : errorCb }</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">        </span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2090</span> 
<span class='line'>2091</span> </span><span class="WHIT">        </span><span class="NAME">callCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">messageId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nativeResult</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">messageId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'eNoError'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">                </span><span class="NAME">callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">messageId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">errorCb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">                </span><span class="NAME">arg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">                </span><span class="NAME">callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">messageId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">successCb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="WHIT">                </span><span class="NAME">arg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nativeResult</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2103</span> 
<span class='line'>2104</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'clientRequestCallbacks calling result callback for msgId: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">messageId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">                    </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in clientRequestCallbacks callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">            </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">messageId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2114</span> 
<span class='line'>2115</span> </span><span class="WHIT">        </span><span class="NAME">purge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">            </span><span class="NAME">this.callbacks</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2119</span> 
<span class='line'>2120</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">rebootIfBroken</span><span class="PUNC">(</span><span class="NAME">rebootCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2121</span> 
<span class='line'>2122</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pluginExists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_doesPluginExist</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">pluginExists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Plugin does not exist. Restarting....'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">            </span><span class="NAME">rebootCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2127</span> 
<span class='line'>2128</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pluginExists</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2130</span> 
<span class='line'>2131</span> </span><span class="WHIT">    </span><span class="COMM">// Returns null if plugin is not installed, 0 if the plugin is installed, but</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">    </span><span class="COMM">// we can't tell what version it is, or the version of the plugin.</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_getNpapiPluginVersion</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">        </span><span class="COMM">// regexp to get the version of the plugin.</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/(\d+\.\d+\.\d+\.\d+)/</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">            </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.mimeTypes</span><span class="PUNC">[</span><span class="STRN">'application/x-ciscowebcommunicator'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cwcPlugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">pluginMimeType.enabledPlugin</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2140</span> 
<span class='line'>2141</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cwcPlugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">            </span><span class="COMM">// plugin is enabled</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">            </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cwcPlugin.version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">                </span><span class="COMM">// use explicit version if provided by browser</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">                </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwcPlugin.version</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2148</span> </span><span class="WHIT">                </span><span class="COMM">// extract version from description</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="WHIT">                </span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r2.exec</span><span class="PUNC">(</span><span class="NAME">cwcPlugin.description</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2150</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="WHIT">                    </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2152</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">version</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2157</span> 
<span class='line'>2158</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2159</span>     * Versions, states and capabilities.
<span class='line'>2160</span>     * @returns {aboutObject}
<span class='line'>2161</span>     */</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'about'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2164</span> 
<span class='line'>2165</span> </span><span class="WHIT">        </span><span class="COMM">/*
<span class='line'>2166</span>          * Versioning scheme: Release.Major.Minor.Revision
<span class='line'>2167</span>          * Release should be for major feature releases (such as video)
<span class='line'>2168</span>          * Major for an API-breaking ship within a release (or additional APIs that won't work without error checking on previous plug-ins).
<span class='line'>2169</span>          * Minor for non API-breaking builds, such as bug fix releases that strongly recommend updating the plug-in
<span class='line'>2170</span>          * Revision for unique build tracking.
<span class='line'>2171</span>         */</span><span class="WHIT">
<span class='line'>2172</span> 
<span class='line'>2173</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">            </span><span class="NAME">javascript</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">                </span><span class="NAME">version</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'11.0.1.102'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">                </span><span class="NAME">system_release</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Cisco Unified Communications System Release 11.0 MR1'</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">            </span><span class="NAME">jquery</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">                </span><span class="NAME">version</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.fn.jquery</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">            </span><span class="NAME">channel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">    </span><span class="COMM">// chrome extension, if any</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">            </span><span class="NAME">plugin</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">       </span><span class="COMM">// either NPAPI plugin or native host app</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">            </span><span class="NAME">states</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">                </span><span class="NAME">system</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'unknown'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">                </span><span class="NAME">device</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2186</span> </span><span class="WHIT">                    </span><span class="NAME">exists</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2187</span> </span><span class="WHIT">                    </span><span class="NAME">inService</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">                    </span><span class="NAME">lineDNs</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">                    </span><span class="NAME">modelDescription</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">                    </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">            </span><span class="NAME">capabilities</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">            </span><span class="NAME">upgrade</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2196</span> 
<span class='line'>2197</span> </span><span class="WHIT">        </span><span class="COMM">// get local cwic javascript version</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ab.javascript.version.match</span><span class="PUNC">(</span><span class="REGX">/(\d+)\.(\d+)\.(\d+)\.(\d+)/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">            </span><span class="NAME">ab.javascript.release</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">            </span><span class="NAME">ab.javascript.major</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2202</span> </span><span class="WHIT">            </span><span class="NAME">ab.javascript.minor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">            </span><span class="NAME">ab.javascript.revision</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2204</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2205</span> 
<span class='line'>2206</span> </span><span class="WHIT">        </span><span class="COMM">// get channel extension version, if any</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">cwic_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">            </span><span class="NAME">ab.channel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwic_plugin.about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">            </span><span class="COMM">// at some point, validation of compatibility of Chrome Extension might be needed, but not for now.</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2211</span> 
<span class='line'>2212</span> </span><span class="WHIT">        </span><span class="COMM">// get plugin (either NPAPI or native host) version and validate compatibility</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_plugin.version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">            </span><span class="NAME">ab.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">                </span><span class="NAME">version</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_plugin.version</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2217</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getNpapiPluginVersion</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">                </span><span class="COMM">// something is installed but we can't identify it</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="WHIT">                </span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mandatory'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">version</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">                </span><span class="COMM">// we extracted a version</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">                </span><span class="NAME">ab.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">version</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">plugin</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">version</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2227</span> 
<span class='line'>2228</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.plugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">            </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ab.plugin.version.plugin.match</span><span class="PUNC">(</span><span class="REGX">/(\d+)\.(\d+)\.(\d+)\.(\d+)/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">                </span><span class="NAME">ab.plugin.release</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">                </span><span class="NAME">ab.plugin.major</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">                </span><span class="NAME">ab.plugin.minor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">                </span><span class="NAME">ab.plugin.revision</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2236</span> 
<span class='line'>2237</span> </span><span class="WHIT">            </span><span class="COMM">// compare javascript and plugin versions to advise about upgrade</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.release</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">ab.plugin.release</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">                </span><span class="COMM">// release mismatch, upgrade plugin</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">                </span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mandatory'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.release</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ab.plugin.release</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">                </span><span class="COMM">// release mismatch, upgrade javascript</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">                </span><span class="NAME">ab.upgrade.javascript</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mandatory'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.release</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ab.plugin.release</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">                </span><span class="COMM">// same release, compare major</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.major</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">ab.plugin.major</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">                    </span><span class="COMM">// newer javascript should always require new plugin</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">                    </span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mandatory'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.major</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ab.plugin.major</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">                    </span><span class="COMM">// newer plugin should generally be backward compatible</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">                    </span><span class="NAME">ab.upgrade.javascript</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'recommended'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.major</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ab.plugin.major</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">                    </span><span class="COMM">// same release.major, compare minor</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.minor</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">ab.plugin.minor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">                        </span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'recommended'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.javascript.minor</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ab.plugin.minor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">                        </span><span class="NAME">ab.upgrade.javascript</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'recommended'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">            </span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unknown'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2264</span> 
<span class='line'>2265</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">            </span><span class="COMM">// _plugin.connectionStatus gets set/updated along the way.  If not, keep default from above.</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">            </span><span class="NAME">ab.states.system</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_plugin.connectionStatus</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ab.states.system</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">            </span><span class="COMM">// registration.device gets set in _updateRegistration and registerPhone.  If not, use default device from above.</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">            </span><span class="NAME">ab.states.device</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">registration.device</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ab.states.device</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">            </span><span class="COMM">// _plugin.capabilities gets set by _cwic_onFBPluginLoaded.  If not, keep default from above.</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">            </span><span class="NAME">ab.capabilities</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_plugin.capabilities</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ab.capabilities</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2273</span> 
<span class='line'>2274</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2276</span> 
<span class='line'>2277</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2278</span>     * predict a device based on username
<span class='line'>2279</span>     * @param {Object} options
<span class='line'>2280</span>     * @type {String}
<span class='line'>2281</span>     */</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_predictDevice</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">settings.predictDevice</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">settings.predictDevice</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">predictDeviceException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application predictDevice callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">predictDeviceException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">                    </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2292</span> 
<span class='line'>2293</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.username</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">settings.devicePrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">options.username</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">videowindowloadedcallbacks</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">        </span><span class="NAME">windowobjects</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">        </span><span class="NAME">getWindowId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">win</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.window</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.windowobjects.indexOf</span><span class="PUNC">(</span><span class="NAME">win</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">windowid</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">args.readOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">                </span><span class="NAME">this.windowobjects.push</span><span class="PUNC">(</span><span class="NAME">win</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">                </span><span class="NAME">windowid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.windowobjects.indexOf</span><span class="PUNC">(</span><span class="NAME">win</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">                </span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">windowid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">windowid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">        </span><span class="COMM">// callbacks[windowId] = {pluginId: {callback: &lt;function>, wascalled: &lt;bool> }}</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">        </span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2312</span> 
<span class='line'>2313</span> </span><span class="WHIT">        </span><span class="NAME">callCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">win</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pluginIdIn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">callbackInner</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">windowId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pluginId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$this.callbacks</span><span class="PUNC">[</span><span class="NAME">windowId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">pluginId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onloaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this.callbacks</span><span class="PUNC">[</span><span class="NAME">windowId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">pluginId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">onloaded.wascalled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">onloaded.callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">                        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">                            </span><span class="NAME">onloaded.callback</span><span class="PUNC">(</span><span class="NAME">pluginId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">videoLoadedException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">                            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application videoLoaded callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">videoLoadedException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">                                </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">                        </span><span class="NAME">onloaded.wascalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2331</span> 
<span class='line'>2332</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getWindowId</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">win</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">readOnly</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">                </span><span class="NAME">pluginId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2334</span> 
<span class='line'>2335</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pluginIdIn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">                </span><span class="COMM">// Correct plugin id provided by v3 MR2 or later plugin, just call the correct one.</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">                </span><span class="NAME">callbackInner</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">windowId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pluginIdIn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">                </span><span class="COMM">// Fallback to the old buggy way where thh id was not available in the onload callback.</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pluginId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">windowId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">windowId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">pluginId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">                        </span><span class="NAME">callbackInner</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">windowId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pluginId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2348</span> 
<span class='line'>2349</span> </span><span class="WHIT">    </span><span class="COMM">// we should call configure method only once, when first video object is created...</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">configureCalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2351</span> 
<span class='line'>2352</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateMessageParamsForIBVideo</span><span class="PUNC">(</span><span class="NAME">callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clientId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">generateUniqueId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">            </span><span class="NAME">mid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateUniqueId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.href</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">            </span><span class="NAME">hostname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.hostname</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.document.title</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">            </span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">            </span><span class="NAME">callIdInt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2360</span> 
<span class='line'>2361</span> </span><span class="WHIT">        </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hostname</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2362</span> 
<span class='line'>2363</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">                </span><span class="NAME">callIdInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">callId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'generateMessageParamsForIBVideo: invalid callId received...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">                </span><span class="NAME">callIdInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">            </span><span class="NAME">ret.unshift</span><span class="PUNC">(</span><span class="NAME">callIdInt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2372</span> 
<span class='line'>2373</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2374</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2375</span> 
<span class='line'>2376</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2377</span>      *
<span class='line'>2378</span>      * @param {Object} args
<span class='line'>2379</span>      * @param {Object|String} args.obj Video plugin object
<span class='line'>2380</span>      * @param {String} args.methodName Method name on video object
<span class='line'>2381</span>      * @param {Function} [args.error]
<span class='line'>2382</span>      * @param {Function} [args.success]
<span class='line'>2383</span>      * @param {String} [args.callId]
<span class='line'>2384</span>      * @private
<span class='line'>2385</span>      */</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">callMethodOnVideoObj</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.obj</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2388</span> </span><span class="WHIT">            </span><span class="NAME">methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.methodName</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2389</span> </span><span class="WHIT">            </span><span class="NAME">successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.success</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">            </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.error</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">            </span><span class="NAME">msgParams</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2392</span> 
<span class='line'>2393</span> </span><span class="WHIT">        </span><span class="NAME">msgParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateMessageParamsForIBVideo</span><span class="PUNC">(</span><span class="NAME">args.callId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2394</span> 
<span class='line'>2395</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">methodName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">methodName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// on IE, NPAPI function is type of 'object'!</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'preparing to call "'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">methodName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" method on video object, with parameters'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msgParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">            </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">methodName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msgParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">successCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="WHIT">                </span><span class="NAME">successCb</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2401</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2402</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'calling "'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">methodName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" method on video object failed!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">                </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'InvalidArguments'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2408</span> 
<span class='line'>2409</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2410</span>      * global(window) level function object to handle video plug-in object onLoad
<span class='line'>2411</span>      * @type function
<span class='line'>2412</span>      * @param  {Object} videopluginobject video plug-in object (DOM Element)
<span class='line'>2413</span>      * @param {Object} win Optional window object. Used only if it's called from _cwic_onPopupVideoPluginLoaded
<span class='line'>2414</span>      * @returns undefined
<span class='line'>2415</span>      */</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">    </span><span class="NAME">window._cwic_onVideoPluginLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">videopluginobject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">win</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_cwic_onVideoPluginLoaded called'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">winObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">win</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2419</span> 
<span class='line'>2420</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">configureCalled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="WHIT">            </span><span class="NAME">callMethodOnVideoObj</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="WHIT">                </span><span class="NAME">obj</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">videopluginobject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="WHIT">                </span><span class="NAME">methodName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'configure'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="WHIT">                </span><span class="NAME">success</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="WHIT">                    </span><span class="NAME">configureCalled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2429</span> 
<span class='line'>2430</span> </span><span class="WHIT">        </span><span class="COMM">// For backward compatibility with existing apps, call the createVideoWindow success callback</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">        </span><span class="NAME">videowindowloadedcallbacks.callCallback</span><span class="PUNC">(</span><span class="NAME">winObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">videopluginobject.loadid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2433</span> 
<span class='line'>2434</span> 
<span class='line'>2435</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2436</span>      * global(window) level function to handle video plug-ins loaded in iframe/popup window.
<span class='line'>2437</span>      * Should be called from video object onLoad handler {@link $.fn.cwic-createVideoWindow}.&lt;br>
<span class='line'>2438</span>      * Example onLoad function in iframe.html
<span class='line'>2439</span>      * @example
<span class='line'>2440</span>      * function onvideoPluginLoaded(obj) {
<span class='line'>2441</span>      *     window.parent._cwic_onPopupVideoPluginLoaded(obj, window);
<span class='line'>2442</span>      * }
<span class='line'>2443</span>      * @returns undefined
<span class='line'>2444</span>      * @param  {JSAPI} videopluginobject video plug-in object (DOM Element)
<span class='line'>2445</span>      * @param  {DOMWindow} win iframe or popup window
<span class='line'>2446</span>      * @public
<span class='line'>2447</span>      */</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="WHIT">    </span><span class="NAME">window._cwic_onPopupVideoPluginLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">videopluginobject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">win</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_cwic_onPopupVideoPluginLoaded called'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2450</span> 
<span class='line'>2451</span> </span><span class="WHIT">        </span><span class="NAME">_cwic_onVideoPluginLoaded</span><span class="PUNC">(</span><span class="NAME">videopluginobject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">win</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2455</span>     * global(window) level function object to handle SSO token receiving from child window (popup or iFrame).
<span class='line'>2456</span>     * Should be called after the token is returned in URL of the target HTML page configured via 'redirect_uri' parameter.
<span class='line'>2457</span>     * @type function
<span class='line'>2458</span>     * @param  {Object} msg     message received from popup/iFrame
<span class='line'>2459</span>     * @param {string} msg.url URL with parameters: &lt;ul>&lt;li>access_token - returned token&lt;/li>&lt;li>token_type - Always "Bearer"&lt;/li>&lt;li>expires_in - Number of seconds the returned token is valid&lt;/li>&lt;/ul>
<span class='line'>2460</span>     * @example
<span class='line'>2461</span>     * //As soon as the page loads, call SSO token handler on the parent window (parent page is a page with cwic.js loaded)
<span class='line'>2462</span>     * window.onload = function(e) {
<span class='line'>2463</span>     *     // The SSO token information is available in a URL fragment. Pass a whole URL string to SSO token handler
<span class='line'>2464</span>     *     window.opener._cwic_onSSOTokenReceived(location.hash);
<span class='line'>2465</span>     *     window.close() 
<span class='line'>2466</span>     * };
<span class='line'>2467</span>     * @public
<span class='line'>2468</span>     */</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">    </span><span class="NAME">window._cwic_onSSOTokenReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">onSSOTokenReceived</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.url</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">            </span><span class="NAME">ssoTokenValidator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validators.get</span><span class="PUNC">(</span><span class="STRN">'ssotoken'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2472</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ssoTokenValidator.isValid</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'ssoNavigationCompleted'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="NAME">errorMap.InvalidURLFragment.code</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2480</span> 
<span class='line'>2481</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2482</span>     * Update the global registration object with information from the native plug-in
<span class='line'>2483</span>     */</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_updateRegistration</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">updateRegCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getDevicesCb</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">devices</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2489</span> 
<span class='line'>2490</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res.devices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">                </span><span class="NAME">props.devices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">res.devices</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res.device</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">                </span><span class="NAME">props.device</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">res.device</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">                </span><span class="NAME">registration.device</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">res.device</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res.line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">                </span><span class="NAME">props.line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">res.line</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">                </span><span class="NAME">registration.line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">registration.line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">res.line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2501</span> 
<span class='line'>2502</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'eIdle'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">props.devices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">props.devices</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">props.device</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">props.line</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">                </span><span class="NAME">devices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.makeArray</span><span class="PUNC">(</span><span class="NAME">props.devices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">                </span><span class="COMM">// merge device information returned by the plug-in</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">                </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">devices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">device</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">device.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deviceName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.trim</span><span class="PUNC">(</span><span class="NAME">device.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">                        </span><span class="NAME">registration.devices</span><span class="PUNC">[</span><span class="NAME">deviceName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">registration.devices</span><span class="PUNC">[</span><span class="NAME">deviceName</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">device</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">updateRegCb</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">                    </span><span class="COMM">// devicesAvailableCb needs raw devices array, not what was put in registration.devices</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">                    </span><span class="COMM">/*
<span class='line'>2515</span>                      * name
<span class='line'>2516</span>                      * description
<span class='line'>2517</span>                      * model
<span class='line'>2518</span>                      * modelDescription
<span class='line'>2519</span>                      * isSoftPhone
<span class='line'>2520</span>                      * isDeskPhone
<span class='line'>2521</span>                      * lineDNs[]
<span class='line'>2522</span>                      * serviceState
<span class='line'>2523</span>                      */</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">                    </span><span class="NAME">updateRegCb</span><span class="PUNC">(</span><span class="NAME">devices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2525</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">        </span><span class="COMM">//--------------------------------------------</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">        </span><span class="COMM">// add device and line info except during logout</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'eIdle'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// state = connection status, not a call state!</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'device'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2534</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'line'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2536</span> 
<span class='line'>2537</span> </span><span class="WHIT">        </span><span class="NAME">getAvailableDevices</span><span class="PUNC">(</span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getAvailableDevices</span><span class="PUNC">(</span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getAvailableDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2543</span> 
<span class='line'>2544</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerProviderEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">        </span><span class="COMM">// state = connection status, not call state!</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'providerState '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2547</span> 
<span class='line'>2548</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'system.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">        </span><span class="NAME">event.phone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">status</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ready</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2550</span> 
<span class='line'>2551</span> </span><span class="WHIT">        </span><span class="COMM">// _updateRegistration provides a devices list to the callback but we don't use it here</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">updateRegCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2553</span> </span><span class="WHIT">            </span><span class="COMM">// add global registration to the system event</span><span class="WHIT">
<span class='line'>2554</span> </span><span class="WHIT">            </span><span class="NAME">event.phone.registration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2555</span> 
<span class='line'>2556</span> </span><span class="WHIT">            </span><span class="COMM">// otherwise, state is our connectionStatus</span><span class="WHIT">
<span class='line'>2557</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.connectionStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2558</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'eReady'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2559</span> </span><span class="WHIT">                </span><span class="COMM">// call success callback only if registering phone</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.registeringPhone</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">regGlobals.switchingMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2561</span> </span><span class="WHIT">                    </span><span class="NAME">regGlobals.registeringPhone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2562</span> </span><span class="WHIT">                    </span><span class="NAME">regGlobals.switchingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2563</span> 
<span class='line'>2564</span> </span><span class="WHIT">                    </span><span class="COMM">// finish registering</span><span class="WHIT">
<span class='line'>2565</span> 
<span class='line'>2566</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.successCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2567</span> </span><span class="WHIT">                        </span><span class="COMM">// extend a local copy of registration to be passed to client's callback</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">localRegistration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">                            </span><span class="NAME">cucm</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.makeArray</span><span class="PUNC">(</span><span class="NAME">regGlobals.CUCM</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">                            </span><span class="NAME">password</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">regGlobals.passphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">                            </span><span class="NAME">passphrase</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">regGlobals.passphrase</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">                            </span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getPropsCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">                            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getPropsCb res: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">                            </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">localRegistration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">res.mode</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2578</span> </span><span class="WHIT">             </span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">                            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">                                </span><span class="NAME">regGlobals.successCb</span><span class="PUNC">(</span><span class="NAME">localRegistration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">successException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2582</span> </span><span class="WHIT">                                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application success callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">successException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="WHIT">                                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="WHIT">                                    </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2586</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>2587</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">                        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'mode'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getPropsCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">                        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'warning: no registerPhone success callback'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2594</span> 
<span class='line'>2595</span> </span><span class="WHIT">                </span><span class="NAME">event.phone.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">                </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callsCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">                    </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">$.makeArray</span><span class="PUNC">(</span><span class="NAME">result.calls</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">call</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerConversationEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">call</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getCalls'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callsCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'eIdle'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// state = connection status, not a call state!</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">regGlobals.unregisterCb</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">                    </span><span class="NAME">regGlobals.unregisterCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2608</span> 
<span class='line'>2609</span> </span><span class="WHIT">                </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">                </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2614</span> </span><span class="WHIT">        </span><span class="COMM">// update global registration</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">        </span><span class="NAME">_updateRegistration</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">updateRegCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2617</span> 
<span class='line'>2618</span> </span><span class="WHIT">    </span><span class="COMM">// Called by _cwic_userAuthHandler when user authorization status is UserAuthorized.</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="WHIT">    </span><span class="COMM">// This occurs either directly from _cwic_onInitReceived in the whitelisted case,</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="WHIT">    </span><span class="COMM">// or when userauthorized event is received in showUserAuthorization case.</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_cwic_onPluginReady</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2625</span> </span><span class="WHIT">                </span><span class="NAME">phoneRegistered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2626</span> 
<span class='line'>2627</span> </span><span class="WHIT">            </span><span class="COMM">// current connectionStatus was cached in _plugin before calling _cwic_onPluginReady</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_plugin.connectionStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2629</span> 
<span class='line'>2630</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'eReady'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// state = connection status, not a call state!</span><span class="WHIT">
<span class='line'>2631</span> </span><span class="WHIT">                </span><span class="NAME">phoneRegistered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2632</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2633</span> 
<span class='line'>2634</span> </span><span class="WHIT">            </span><span class="COMM">// fire and forget requests</span><span class="WHIT">
<span class='line'>2635</span> 
<span class='line'>2636</span> </span><span class="WHIT">            </span><span class="COMM">// Get initial mm device list.  If web calls cwic getMultimediaDevices before this returns, they'll get no devices.</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">            </span><span class="COMM">// That's ok because the success callback here is _triggerMMDeviceEvent, which tells the webapp to refresh its list.</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">            </span><span class="COMM">// todo: mediadevices service: move after login and revert</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">            </span><span class="COMM">//_sendClientRequest('getMultimediaDevices', function mmDevicesCb(content) {</span><span class="WHIT">
<span class='line'>2640</span> </span><span class="WHIT">            </span><span class="COMM">//    _triggerMMDeviceEvent($this, content);</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">            </span><span class="COMM">//});</span><span class="WHIT">
<span class='line'>2642</span> 
<span class='line'>2643</span> </span><span class="WHIT">            </span><span class="COMM">// wait for reply</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modeCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">settings.ready</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">                    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">                        </span><span class="NAME">settings.ready</span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">phoneRegistered</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result.mode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">readyException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="WHIT">                        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application ready callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">readyException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">                            </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'mode'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">modeCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2657</span> 
<span class='line'>2658</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">phoneRegistered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callsCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">                    </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">$.makeArray</span><span class="PUNC">(</span><span class="NAME">result.calls</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">call</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerConversationEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">call</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2664</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getCalls'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callsCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="WHIT">                </span><span class="COMM">// CSCue51645 ensure app is in sync with initial plug-in state</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">                </span><span class="NAME">_triggerProviderEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">currState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2669</span> 
<span class='line'>2670</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2674</span> </span><span class="WHIT">                    </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2675</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.log</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Exception occured in _cwic_onPluginReady() '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">            </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">            </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Cannot Initialize Cisco Web Communicator'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2684</span> 
<span class='line'>2685</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2688</span>     * Wait for the document to be ready, and try to load the Cisco Web Communicator add-on.&lt;br>
<span class='line'>2689</span>     * If cwic was successfully initialized, call the options.ready handler, &lt;br>
<span class='line'>2690</span>     * passing some stored properties (possibly empty), &lt;br>
<span class='line'>2691</span>     * otherwise call the options.error handler&lt;br>
<span class='line'>2692</span>     * @param {Object} options Is a set of key/value pairs to configure the phone registration.  See {@link $.fn.cwic-settings} for options.
<span class='line'>2693</span>     * @example
<span class='line'>2694</span>     * jQuery('#phone').cwic('init', {
<span class='line'>2695</span>     *   ready: function(defaults) {
<span class='line'>2696</span>     *     console.log('sdk is ready');
<span class='line'>2697</span>     *   },
<span class='line'>2698</span>     *   error: function(error) {
<span class='line'>2699</span>     *     console.log('sdk cannot be initialized : ' + error.message);
<span class='line'>2700</span>     *   },
<span class='line'>2701</span>     *   log: function(msg, exception) {
<span class='line'>2702</span>     *     console.log(msg); if (exception) { console.log(exception); }
<span class='line'>2703</span>     *   },
<span class='line'>2704</span>     *   errorMap: {
<span class='line'>2705</span>     *     // localized message for error code 'AuthenticationFailure'
<span class='line'>2706</span>     *     AuthenticationFailure : { message: 'Nom d'utilisateur ou mot de passe incorrect' }
<span class='line'>2707</span>     *   },
<span class='line'>2708</span>     *   predictDevice: function(args) {
<span class='line'>2709</span>     *       return settings.devicePrefix + args.username;
<span class='line'>2710</span>     *   }
<span class='line'>2711</span>     *});
<span class='line'>2712</span>     */</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">init</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2715</span> </span><span class="WHIT">            </span><span class="NAME">paramsCheck</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2717</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'init'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2718</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2719</span> </span><span class="WHIT">        </span><span class="NAME">extendDefaultSettingsObject</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">        </span><span class="COMM">// check sd params after extending settings object because user defined error callback should be copied to settings object first</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">        </span><span class="NAME">paramsCheck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validateDiscoveryParams</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">paramsCheck.result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">paramsCheck.reason.join</span><span class="PUNC">(</span><span class="STRN">', '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">        </span><span class="NAME">registerGlobalInitHandlers</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">             </span><span class="WHIT">
<span class='line'>2729</span> </span><span class="WHIT">        </span><span class="NAME">initAddonOnDocumentReady</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="WHIT">         </span><span class="WHIT">
<span class='line'>2731</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2732</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2733</span> 
<span class='line'>2734</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">extendDefaultSettingsObject</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2735</span> </span><span class="WHIT">        </span><span class="COMM">// replace or extend the default error map</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options.errorMap</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="WHIT">            </span><span class="COMM">// extend the default errorMap</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">            </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">options.errorMap</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">                    </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">                    </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'ignoring invalid custom error [key='</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">']'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2747</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2748</span> 
<span class='line'>2749</span> </span><span class="WHIT">        </span><span class="COMM">// extend the default settings</span><span class="WHIT">
<span class='line'>2750</span> </span><span class="WHIT">        </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">settings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2751</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2752</span> 
<span class='line'>2753</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">validateDiscoveryParams</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reason</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">        </span><span class="COMM">// check service discovery related properties if necessary</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">settings.serviceDiscovery</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options.credentialsRequired</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">                </span><span class="NAME">ret.reason.push</span><span class="PUNC">(</span><span class="STRN">'No credentialRequired callback provided'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">                </span><span class="NAME">ret.result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options.emailRequired</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">                </span><span class="NAME">ret.reason.push</span><span class="PUNC">(</span><span class="STRN">'No emailRequired callback provided'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">                </span><span class="NAME">ret.result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options.redirectUri</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options.redirectUri</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">                </span><span class="NAME">ret.reason.push</span><span class="PUNC">(</span><span class="STRN">'No redirectUri parameter provided'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">                </span><span class="NAME">ret.result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2774</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">registerGlobalInitHandlers</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">        </span><span class="NAME">window._cwic_userAuthHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'UserAuthorized'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UserDenied'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'_cwic_userAuthHandler result: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_plugin.userAuthStatus</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2780</span> 
<span class='line'>2781</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">                </span><span class="COMM">//_getAvailableRingtones($this); // todo: mediadevices service: move after login and revert when JCF fix is ready</span><span class="WHIT">
<span class='line'>2783</span> 
<span class='line'>2784</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'connectionStatus'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2785</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.connectionStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.connectionStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">                    </span><span class="NAME">_cwic_onPluginReady</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Cannot Initialize Cisco Web Communicator'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.NotUserAuthorized</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2790</span> 
<span class='line'>2791</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.deniedCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.deniedCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.deniedCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2799</span>         * Called by _handlePluginMessage after the init reply is received.
<span class='line'>2800</span>         * @param {object} [content] Data payload of the init reply message when called by _handlePluginMessage.
<span class='line'>2801</span>         * @param {object} content.version Version details for the loaded plug-in.
<span class='line'>2802</span>         * @param {object} content.instanceId
<span class='line'>2803</span>         * @param {object} content.userauthstatus
<span class='line'>2804</span>         * @param {object} content.capabilities
<span class='line'>2805</span>         * @returns undefined
<span class='line'>2806</span>         * @private
<span class='line'>2807</span>         */</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">        </span><span class="NAME">window._cwic_onInitReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2810</span> 
<span class='line'>2811</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">cwic_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">                </span><span class="COMM">// what to do if _cwic_onPluginLoaded called twice without first unloading?</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'plugin is already loaded.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2815</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2816</span> 
<span class='line'>2817</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">cwic_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">                    </span><span class="COMM">//for Chrome</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">                    </span><span class="COMM">// plug-in is available, update global reference</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.api</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwic_plugin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2824</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2825</span> 
<span class='line'>2826</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.api</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.instanceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.instanceId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2828</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.version</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.userauthstatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.capabilities</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.capabilities</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'PluginNotAvailable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2834</span> 
<span class='line'>2835</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'initialized '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' plugin'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_plugin.version</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2836</span> 
<span class='line'>2837</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2838</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.upgrade.plugin</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'mandatory'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2839</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Cisco Web Communicator cannot be used when plugin upgrade is "mandatory"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2842</span> 
<span class='line'>2843</span> </span><span class="WHIT">                </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">unload</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2844</span> </span><span class="WHIT">                    </span><span class="NAME">shutdown.call</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2845</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2846</span> 
<span class='line'>2847</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'MustShowAuth'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">                    </span><span class="COMM">//  MustShowAuth implies we either do delayed Auth or we pop the dialog now</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">settings.delayedUserAuth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">                        </span><span class="NAME">settings.delayedUserAuth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">                        </span><span class="COMM">// No additional deniedCb is needed.  _cwic_userAuthHandler will trigger NotUserAuthorized error.</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">                        </span><span class="NAME">showUserAuthorization</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">denied</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'UserAuthorized'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">                    </span><span class="COMM">// domain whitelisting can give us immediate authorization</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">                    </span><span class="NAME">_cwic_userAuthHandler</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2859</span> 
<span class='line'>2860</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2864</span> </span><span class="WHIT">                        </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2865</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.log</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">                        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Exception occured in _cwic_onInitReceived() '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2870</span> 
<span class='line'>2871</span> </span><span class="WHIT">                </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="WHIT">                </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2873</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2874</span> 
<span class='line'>2875</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Cannot Initialize Cisco Web Communicator'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2877</span> 
<span class='line'>2878</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>2879</span>         * Phone Object onLoad handler. This function is called as the onload callback for the NPAPI plugin.
<span class='line'>2880</span>         * @returns undefined
<span class='line'>2881</span>         * @private
<span class='line'>2882</span>         */</span><span class="WHIT">
<span class='line'>2883</span> </span><span class="WHIT">        </span><span class="NAME">window._cwic_onFBPluginLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2884</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2885</span> 
<span class='line'>2886</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2887</span> </span><span class="WHIT">                </span><span class="COMM">// what to do if _cwic_onFBPluginLoaded called twice without first unloading?</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'plugin is already loaded.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2889</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2890</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2891</span> 
<span class='line'>2892</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2893</span> </span><span class="WHIT">                </span><span class="COMM">// plug-in is available, update global reference</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="WHIT">                </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2895</span> </span><span class="WHIT">                </span><span class="NAME">_plugin.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2896</span> 
<span class='line'>2897</span> </span><span class="WHIT">                </span><span class="COMM">// look for npapi object</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cwcObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">'cwc-plugin'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// don't use jQuery to get NPAPI objects, it doesn't work for jQuery 1.5+</span><span class="WHIT">
<span class='line'>2899</span> 
<span class='line'>2900</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cwcObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.api</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwcObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">                    </span><span class="NAME">_registerNpapiCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">                    </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'init'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'PluginNotAvailable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2907</span> 
<span class='line'>2908</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2910</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">                        </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2913</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.log</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2915</span> </span><span class="WHIT">                        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Exception occured in _cwic_onFBPluginLoaded() '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2918</span> 
<span class='line'>2919</span> </span><span class="WHIT">                </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">                </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2922</span> 
<span class='line'>2923</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Cannot Initialize Cisco Web Communicator'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2925</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initAddonOnDocumentReady</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">        </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">document.body</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">ready</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">            </span><span class="NAME">initAddon</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2932</span> 
<span class='line'>2933</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initAddon</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2936</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">            </span><span class="NAME">discoverPluginTypeAndInit</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">            </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2945</span> 
<span class='line'>2946</span> </span><span class="WHIT">    </span><span class="COMM">// discover addon type: FB plugin(NPAPI/ActiveX) or Chrome Native Host</span><span class="WHIT">
<span class='line'>2947</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">discoverPluginTypeAndInit</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">is_chrome</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">'chrome'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">is_chrome</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2950</span> </span><span class="WHIT">            </span><span class="COMM">// try release extId first</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extSettings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2952</span> </span><span class="WHIT">                </span><span class="NAME">cwicExtId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ppbllmlcmhfnfflbkbinnhacecaankdh'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">                </span><span class="NAME">verbose</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">settings.verbose</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2955</span> 
<span class='line'>2956</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">createScript</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extSettings</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'script'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">                </span><span class="NAME">s.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extSettings.cwicExtId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">                </span><span class="NAME">s.onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">                    </span><span class="NAME">cwic_plugin.init</span><span class="PUNC">(</span><span class="NAME">_handlePluginMessage</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extSettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">                </span><span class="NAME">s.onerror</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">settings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.ExtensionNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Chrome requires Cisco Web Communicator extension'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2964</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="WHIT">                </span><span class="NAME">s.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'chrome-extension://'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'/cwic_plugin.js'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2968</span> 
<span class='line'>2969</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">cwic_plugin</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">script</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createScript</span><span class="PUNC">(</span><span class="NAME">extSettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">                </span><span class="NAME">script.onerror</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">                    </span><span class="COMM">// remove our first attempt</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">                    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">                        </span><span class="NAME">document.head.removeChild</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">extSettings.cwicExtId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">                    </span><span class="COMM">// try or dev extId second</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Failed loading release version of Chrome extension.  Attempting to load dev version next.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">                    </span><span class="NAME">extSettings.cwicExtId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'kekllijkldgcokjdjphahkijinjhlapf'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">                    </span><span class="NAME">script</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createScript</span><span class="PUNC">(</span><span class="NAME">extSettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">                    </span><span class="NAME">document.head.appendChild</span><span class="PUNC">(</span><span class="NAME">script</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="WHIT">                </span><span class="NAME">document.head.appendChild</span><span class="PUNC">(</span><span class="NAME">script</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'calling init on previously loaded cwic_plugin script'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2986</span> </span><span class="WHIT">                </span><span class="NAME">extSettings.cwicExtId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwic_plugin.about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cwicExtId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">                </span><span class="NAME">cwic_plugin.init</span><span class="PUNC">(</span><span class="NAME">_handlePluginMessage</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extSettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2991</span> 
<span class='line'>2992</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">npapiPlugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2993</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.mimeTypes</span><span class="PUNC">[</span><span class="STRN">'application/x-ciscowebcommunicator'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2994</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'ActiveXObject'</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">            </span><span class="COMM">// IE - try to load the ActiveX/NPAPI plug-in, throw an error if it fails</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dummyAXObj1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">'CiscoSystems.CWCVideoCall'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">                </span><span class="COMM">// no exception, plug-in is available</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">                </span><span class="COMM">// how to check plug-in is enabled in IE ?</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">                </span><span class="NAME">npapiPlugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'ActiveXObject("CiscoSystems.CWCVideoCall") exception: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">                </span><span class="COMM">// check if previous release is installed</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dummyAXObj2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">'ActivexPlugin.WebPhonePlugin.1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">                    </span><span class="COMM">// no exception. previous plug-in is available</span><span class="WHIT">
<span class='line'>3007</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'ReleaseMismatch'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3008</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3009</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'ActiveXObject("ActivexPlugin.WebPhonePlugin.1") exception: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3010</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'PluginNotAvailable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3011</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3012</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="WHIT">            </span><span class="COMM">// Firefox or Safari with our plugin</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">            </span><span class="NAME">npapiPlugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">            </span><span class="COMM">// plug-in not available, check if any previous release is installed</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">            </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.mimeTypes</span><span class="PUNC">[</span><span class="STRN">'application/x-ciscowebphone'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3019</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">pluginMimeType</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3020</span> </span><span class="WHIT">                </span><span class="COMM">// previous plug-in is available</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'ReleaseMismatch'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3024</span> 
<span class='line'>3025</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">npapiPlugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">            </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">document.body</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">'&lt;object id="cwc-plugin" width="1" height="1" type="application/x-ciscowebcommunicator">&lt;param name="onload" value="_cwic_onFBPluginLoaded">&lt;/param>&lt;/object>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'PluginNotAvailable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">videopluginid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3033</span> 
<span class='line'>3034</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3035</span>     * Creates an object that can be passed to startConversation, addPreviewWindow, or updateConversation('addRemoteVideoWindow').
<span class='line'>3036</span>     * The object is inserted into the element defined by the jQuery context - e.g. jQuery('#placeholder').cwic('createVideoWindow')
<span class='line'>3037</span>     * inserts the videowindow under jQuery('#placeholder')
<span class='line'>3038</span>     * &lt;br>
<span class='line'>3039</span>     * &lt;br>NOTE: This function will just 'do nothing' and the success() callback will never be called if either of the following are true:
<span class='line'>3040</span>     * &lt;ul>
<span class='line'>3041</span>     * &lt;li>video is not supported on the platform, see {@link aboutObject#capabilities:video}&lt;/li>
<span class='line'>3042</span>     * &lt;li>video plugin objects are not supported in the browser, see {@link aboutObject#capabilities:videoPluginObject}&lt;/li>
<span class='line'>3043</span>     * &lt;/ul>
<span class='line'>3044</span>     * NOTE: System resources used when video windows are created cannot be reliably released on all platforms.  The application should reuse the
<span class='line'>3045</span>     * video objects returned by createVideoWindow, rather than creating new windows for each call to avoid performance problems on some client platforms.
<span class='line'>3046</span>     * @example $('#videocontainer').cwic('createVideoWindow', {
<span class='line'>3047</span>     *      id: 'videoplugin',
<span class='line'>3048</span>     *      success: function(pluginid) {$('#conversation').cwic('updateConversation',{'addRemoteVideoWindow': pluginid});}
<span class='line'>3049</span>     * });
<span class='line'>3050</span>     * @param {Object} [settings] Settings to use when creating the video render object
<span class='line'>3051</span>     * @param {String} [settings.id = generated] The DOM ID of the element to be created
<span class='line'>3052</span>     * @param {Function} [settings.success] Called when the object is loaded and ready for use plug-in ID is passed as a parameter
<span class='line'>3053</span>     * @param {String} [settings.onload] Not recommended for video windows created in the same window as the main phone plug-in.
<span class='line'>3054</span>     * &lt;br>Mandatory in popup windows or iframes. The string must be the name of a function in the global scope, and the function
<span class='line'>3055</span>     * must call parent or opener {@link window._cwic_onPopupVideoPluginLoaded}.  This function will be called in the onload handler
<span class='line'>3056</span>     * of the video object.
<span class='line'>3057</span>     * &lt;br>Single parameter is the videoplugin object that must be passed to the parent handler.
<span class='line'>3058</span>     */</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createVideoWindow</span><span class="PUNC">(</span><span class="NAME">settings</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3062</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.capabilities.video</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ab.capabilities.videoPluginObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3063</span> </span><span class="WHIT">            </span><span class="NAME">settings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3064</span> </span><span class="WHIT">            </span><span class="NAME">settings.window</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings.window</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3065</span> 
<span class='line'>3066</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mimetype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'application/x-cisco-cwc-videocall'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3067</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings.onload</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'_cwic_onVideoPluginLoaded'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3068</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings.success</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">settings.id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'_cwic_vw'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">videopluginid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3070</span> </span><span class="WHIT">            </span><span class="NAME">videopluginid</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3071</span> 
<span class='line'>3072</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">videowindowloadedcallbacks.getWindowId</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">settings.window</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">            </span><span class="NAME">videowindowloadedcallbacks.callbacks</span><span class="PUNC">[</span><span class="NAME">windowid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wascalled</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3074</span> 
<span class='line'>3075</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elemtext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;object type="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mimetype</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" id="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'">&lt;param name="loadid" value="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'">&lt;/param>&lt;param name="onload" value="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'">&lt;/param>&lt;/object>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">            </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="NAME">elemtext</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3078</span> 
<span class='line'>3079</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3080</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3081</span> 
<span class='line'>3082</span> </span><span class="WHIT">    </span><span class="COMM">// generalization for executing video object operations.</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="WHIT">    </span><span class="COMM">// Validates window object passed in</span><span class="WHIT">
<span class='line'>3084</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">execVideoObjectOperation</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3085</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">'execVideoObjectOperation called with arguments'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3086</span> 
<span class='line'>3087</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">winObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.window</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">            </span><span class="NAME">videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.videoObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="WHIT">            </span><span class="NAME">methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.methodName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3090</span> 
<span class='line'>3091</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">videoObject</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">                </span><span class="NAME">videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">winObj.document.getElementById</span><span class="PUNC">(</span><span class="NAME">videoObject</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">'execVideoObjectOperation: invalid window object'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">                </span><span class="COMM">// handle wrong window object</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">                    </span><span class="NAME">args.error</span><span class="PUNC">(</span><span class="NAME">getError</span><span class="PUNC">(</span><span class="STRN">'InvalidArguments'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3103</span> 
<span class='line'>3104</span> </span><span class="WHIT">        </span><span class="COMM">// validates video object and calls methodName on that object</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">        </span><span class="NAME">callMethodOnVideoObj</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">            </span><span class="NAME">obj</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">videoObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="WHIT">            </span><span class="NAME">methodName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">methodName</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3108</span> </span><span class="WHIT">            </span><span class="NAME">error</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.error</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3109</span> </span><span class="WHIT">            </span><span class="NAME">success</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.success</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3110</span> </span><span class="WHIT">            </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.callId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>3111</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3112</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3113</span> 
<span class='line'>3114</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3115</span>      * Assign a video window object to preview (self-view).
<span class='line'>3116</span>      * @example
<span class='line'>3117</span>      * $('#phone').cwic('addPreviewWindow',{previewWindow: 'previewVideoObjectID'});
<span class='line'>3118</span>      * $('#phone').cwic('addPreviewWindow',{previewWindow: previewVideoObject, window: iFramePinPWindow});
<span class='line'>3119</span>      * $('#phone').cwic('addPreviewWindow',{previewWindow: 'previewVideoObjectID', error: function(err){console.log(err)}});
<span class='line'>3120</span>      * @param {Object} args arguments object
<span class='line'>3121</span>      * @param {DOMWindow} [args.window] DOM Window that contains the plug-in Object defaults to current window
<span class='line'>3122</span>      * @param {String|Object} args.previewWindow ID or DOM element of preview window
<span class='line'>3123</span>      * @param {Function} [args.error] Called when arguments object is malformed, i.e. args.previewWindow ID or DOM element is non-existent or malformed
<span class='line'>3124</span>      */</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">addPreviewWindow</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">            </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>3129</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.capabilities.videoPluginObject</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addPreviewWindow called from unsupported browser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3133</span> 
<span class='line'>3134</span> </span><span class="WHIT">        </span><span class="NAME">args.methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'addPreviewWindow'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3135</span> </span><span class="WHIT">        </span><span class="NAME">args.videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.previewWindow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3136</span> 
<span class='line'>3137</span> </span><span class="WHIT">        </span><span class="NAME">execVideoObjectOperation</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3138</span> 
<span class='line'>3139</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3142</span>      * Remove a video window object from preview (self-view)
<span class='line'>3143</span>      * @example
<span class='line'>3144</span>      * $('#phone').cwic('removePreviewWindow', {
<span class='line'>3145</span>      *   previewWindow: 'previewVideoObjectID'
<span class='line'>3146</span>      * });
<span class='line'>3147</span>      * 
<span class='line'>3148</span>      * $('#phone').cwic('removePreviewWindow', {
<span class='line'>3149</span>      *   previewWindow: previewVideoObject, 
<span class='line'>3150</span>      *   window: iFramePinPWindow
<span class='line'>3151</span>      * });
<span class='line'>3152</span>      * 
<span class='line'>3153</span>      * $('#phone').cwic('removePreviewWindow', {
<span class='line'>3154</span>      *   previewWindow: 'previewVideoObjectID', 
<span class='line'>3155</span>      *   error: function (err) {
<span class='line'>3156</span>      *     console.log(err)
<span class='line'>3157</span>      *   }
<span class='line'>3158</span>      * });
<span class='line'>3159</span>      * @param {Object} args arguments object
<span class='line'>3160</span>      * @param {DOMWindow} [args.window] DOM Window that contains the plug-in Object defaults to current window
<span class='line'>3161</span>      * @param {String|Object} args.previewWindow id or DOM element of preview window
<span class='line'>3162</span>      * @param {Function} [args.error] Called when arguments object is malformed, i.e. args.previewWindow ID or DOM element is non-existent or malformed
<span class='line'>3163</span>      */</span><span class="WHIT">
<span class='line'>3164</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">removePreviewWindow</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">            </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3167</span> </span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>3168</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.capabilities.videoPluginObject</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removePreviewWindow called from unsupported browser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">      </span><span class="WHIT">
<span class='line'>3172</span> 
<span class='line'>3173</span> </span><span class="WHIT">        </span><span class="NAME">args.methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'removePreviewWindow'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3174</span> </span><span class="WHIT">        </span><span class="NAME">args.videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.previewWindow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3175</span> 
<span class='line'>3176</span> </span><span class="WHIT">        </span><span class="NAME">execVideoObjectOperation</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3177</span> 
<span class='line'>3178</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3180</span> 
<span class='line'>3181</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3182</span>      * Called from "startConversation" or "updateConversation"
<span class='line'>3183</span>      * @param {Object} args
<span class='line'>3184</span>      * @param {String} args.callId
<span class='line'>3185</span>      * @param {DOMWindow} args.window
<span class='line'>3186</span>      * @param {String|Object} args.remoteVideoWindow
<span class='line'>3187</span>      * @private
<span class='line'>3188</span>      */</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">addWindowToCall</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">            </span><span class="NAME">scb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.success</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">        </span><span class="COMM">// flag to distinguish between cases when "startRemoteVideo" or "addWindowToCall" methods should be called</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">        </span><span class="COMM">// We should call startRemoteVideo when:</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">        </span><span class="COMM">//     - new conversation is started (from startConversation API)</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">        </span><span class="COMM">//     - conversation is started without video and later video window is added through updateConversation</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">        </span><span class="COMM">//     - when swithing between 2 conversations (hold/resume)</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">        </span><span class="COMM">// We should call addWindowToCall when:</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">        </span><span class="COMM">//     - new video window is added (updateConversation.addWindowToCall) for the current conversation which already have at least 1 video window</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">        </span><span class="COMM">// All those calles are covered with activeConversation.lastId flag.</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">        </span><span class="COMM">// This flag is set when new video window is added (not when new conversation is started!) keeping the last callId value when video window was added last time</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">            </span><span class="NAME">newCall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">            </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.capabilities.videoPluginObject</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall called from unsupported browser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>3208</span> 
<span class='line'>3209</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">activeConversation.lastId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">args.callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">            </span><span class="NAME">newCall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3212</span> 
<span class='line'>3213</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall() called with arguments: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall(): activeConversation object: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">activeConversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3215</span> 
<span class='line'>3216</span> </span><span class="WHIT">        </span><span class="NAME">args.methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newCall</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'startRemoteVideo'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall() calling '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">args.methodName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3218</span> 
<span class='line'>3219</span> </span><span class="WHIT">        </span><span class="NAME">args.videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.remoteVideoWindow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3220</span> 
<span class='line'>3221</span> </span><span class="WHIT">        </span><span class="NAME">args.success</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">videoObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3222</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newCall</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'addWindowToCall(): setting activeConversation object'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3224</span> </span><span class="WHIT">                </span><span class="NAME">activeConversation.videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">videoObj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3225</span> </span><span class="WHIT">                </span><span class="NAME">activeConversation.window</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.window</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="WHIT">                </span><span class="NAME">activeConversation.lastId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.callId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3227</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3228</span> 
<span class='line'>3229</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">scb</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// if successCb was set, call it</span><span class="WHIT">
<span class='line'>3230</span> </span><span class="WHIT">                </span><span class="NAME">scb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3231</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3232</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3233</span> 
<span class='line'>3234</span> </span><span class="WHIT">        </span><span class="NAME">execVideoObjectOperation</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3235</span> 
<span class='line'>3236</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3238</span> 
<span class='line'>3239</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3240</span>      * Called from "updateConversation"
<span class='line'>3241</span>      * @param {Object} args
<span class='line'>3242</span>      * @param {String} args.callId
<span class='line'>3243</span>      * @param {DOMWindow} args.window
<span class='line'>3244</span>      * @param {String|Object} args.remoteVideoWindow
<span class='line'>3245</span>      * @param {Boolean} args.endCall
<span class='line'>3246</span>      * @private
<span class='line'>3247</span>      */</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">removeWindowFromCall</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">            </span><span class="NAME">endCall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.endCall</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// flag to distinguish between conversation end and updateConv.removeWindowFromCall</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">            </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ab.capabilities.videoPluginObject</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removeWindowFromCall called from unsupported browser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3255</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">activeConversation.lastId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">args.callId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'cannot call removeWindowFromCall for callId '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">args.callId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'. Last call id was: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">activeConversation.lastId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3262</span> 
<span class='line'>3263</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removeWindowFromCall() called with arguments: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removeWindowFromCall(): activeConversation object: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">activeConversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3265</span> 
<span class='line'>3266</span> </span><span class="WHIT">        </span><span class="NAME">args.methodName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endCall</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'stopRemoteVideo'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'removeWindowFromCall'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removeWindowFromCall() calling method '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">args.methodName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="WHIT">        </span><span class="NAME">args.videoObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.remoteVideoWindow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3269</span> 
<span class='line'>3270</span> </span><span class="WHIT">        </span><span class="NAME">execVideoObjectOperation</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3271</span> 
<span class='line'>3272</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3273</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3274</span> 
<span class='line'>3275</span> 
<span class='line'>3276</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3277</span>     * Shuts down the API&lt;br>
<span class='line'>3278</span>     * &lt;ul>&lt;li>Unregisters the phone&lt;/li>
<span class='line'>3279</span>     * &lt;li>Unbinds all cwic events handlers&lt;/li>
<span class='line'>3280</span>     * &lt;li>Clears all cwic data&lt;/li>
<span class='line'>3281</span>     * &lt;li>Releases the Cisco Web Communicator add-on instance&lt;/li>&lt;/ul>
<span class='line'>3282</span>     * @example
<span class='line'>3283</span>     *  jQuery(window).unload(function() { &lt;br>
<span class='line'>3284</span>     *      // not necessary, it is already done in cwic.js by default
<span class='line'>3285</span>     *      // jQuery('#phone').cwic('shutdown'); &lt;br>
<span class='line'>3286</span>     *  }); &lt;br>
<span class='line'>3287</span>      * @example
<span class='line'>3288</span>      * jQuery('#shutdown').click(function() { &lt;br>
<span class='line'>3289</span>     *      jQuery('#phone').cwic('shutdown'); &lt;br>
<span class='line'>3290</span>     *  }); &lt;br>
<span class='line'>3291</span>     */</span><span class="WHIT">
<span class='line'>3292</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">shutdown</span><span class="PUNC">(</span><span class="NAME">auto</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3293</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3294</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'shutdown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3295</span> 
<span class='line'>3296</span> </span><span class="WHIT">        </span><span class="NAME">resetInitSettings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3297</span> 
<span class='line'>3298</span> </span><span class="WHIT">        </span><span class="COMM">// auto means that shutdown is called from onunload event and not by calling API</span><span class="WHIT">
<span class='line'>3299</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">auto</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">            </span><span class="COMM">// _sendClientRequest('autologout'); TODO: implement</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">            </span><span class="NAME">signOut</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3305</span> </span><span class="WHIT">        </span><span class="NAME">_resetSSO</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3306</span> 
<span class='line'>3307</span> </span><span class="WHIT">        </span><span class="COMM">// unbind all cwic events handlers</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">        </span><span class="NAME">$this.unbind</span><span class="PUNC">(</span><span class="STRN">'.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3309</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3310</span> </span><span class="WHIT">        </span><span class="COMM">// unbind NPAPI events handlers</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">        </span><span class="NAME">_unregisterNpapiCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3312</span> 
<span class='line'>3313</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'releaseInstance'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">        </span><span class="NAME">clientRequestCallbacks.purge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3315</span> 
<span class='line'>3316</span> </span><span class="WHIT">        </span><span class="NAME">_plugin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3318</span> 
<span class='line'>3319</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3320</span>     * Authentication result handler. Only logs received event. Sign in logic is moved to lifecycle event handlers.
<span class='line'>3321</span>     * @private
<span class='line'>3322</span>     */</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerAuthResultAndStatus</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resultAndStatus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3324</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resultAndStatus.result</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3325</span> </span><span class="WHIT">            </span><span class="NAME">status</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resultAndStatus.status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3326</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'authentication result: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'authentication status: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">status</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.lastAuthStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3334</span>     * @private
<span class='line'>3335</span>     */</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'mmDeviceChange'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">            </span><span class="COMM">// store the updated device list and notify the web app</span><span class="WHIT">
<span class='line'>3340</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.multimediadevices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.multimediadevices</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'mmDeviceChange.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3344</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3345</span> 
<span class='line'>3346</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3347</span>     * @private
<span class='line'>3348</span>     */</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerExternalWindowEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'externalWindowEvent'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3351</span> 
<span class='line'>3352</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'externalWindowEvent.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3353</span> </span><span class="WHIT">        </span><span class="NAME">event.externalWindowState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3354</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3355</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3356</span> 
<span class='line'>3357</span> </span><span class="WHIT">    </span><span class="COMM">// translate NPAPI events into ciscoSDKServerMessages</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_registerNpapiCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fbMessageCbName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'addonmessage'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3360</span> 
<span class='line'>3361</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">msgHandler</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3364</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">                </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3367</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Invalid JSON message from plugin'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3368</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="NAME">errorMap.NativePluginError.code</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3370</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3371</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoChannelMessage</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelMessage.ciscoSDKServerMessage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg.ciscoChannelMessage.client</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelMessage.client.id</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelMessage.client.id</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">clientId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3373</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3374</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3375</span> </span><span class="WHIT">                </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.ciscoChannelMessage</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3376</span> 
<span class='line'>3377</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3378</span> </span><span class="WHIT">            </span><span class="NAME">_handlePluginMessage</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3379</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3380</span> 
<span class='line'>3381</span> </span><span class="WHIT">        </span><span class="COMM">// add property to '_registerNpapiCallbacks' function which holds the list of registered handlers. Used as a helper to unregister those handlers later.</span><span class="WHIT">
<span class='line'>3382</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handlers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_registerNpapiCallbacks.handlersList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3383</span> 
<span class='line'>3384</span> </span><span class="WHIT">        </span><span class="NAME">handlers.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fbMessageCbName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">msgHandler</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3385</span> 
<span class='line'>3386</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'adding npapi listener for '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fbMessageCbName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3387</span> </span><span class="WHIT">        </span><span class="NAME">_addListener</span><span class="PUNC">(</span><span class="NAME">_plugin.api</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fbMessageCbName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msgHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3389</span> 
<span class='line'>3390</span> </span><span class="WHIT">    </span><span class="COMM">// remove registered NPAPI event handlers. Called in 'shutdown' to prevent multiplication of registered events in case when 'init' API function is called multiple times during one session.</span><span class="WHIT">
<span class='line'>3391</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_unregisterNpapiCallbacks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3392</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handlers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_registerNpapiCallbacks.handlersList</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3393</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3394</span> 
<span class='line'>3395</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">handlers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3396</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">handlers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3397</span> </span><span class="WHIT">                </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3398</span> </span><span class="WHIT">                </span><span class="NAME">handler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">handlers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">handler</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3399</span> 
<span class='line'>3400</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removing npapi listener for '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' event.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">                    </span><span class="NAME">_removeListener</span><span class="PUNC">(</span><span class="NAME">_plugin.api</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3403</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3404</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3407</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'trying to remove npapi listeners, but no "_registerNpapiCallbacks.handlersList" found.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3408</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3410</span> 
<span class='line'>3411</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3412</span>     * Switch mode on a session that is already authorized. Can also be used for switching to different device in the same mode&lt;br>
<span class='line'>3413</span>     * @example
<span class='line'>3414</span>     * $('#phone').cwic('switchPhoneMode',{
<span class='line'>3415</span>     *     success: function(registration) { console.log('Phone is in '+registration.mode+' mode'); },
<span class='line'>3416</span>     *     error: function(err) { console.log('Error: '+error.message+' while switching mode'); },
<span class='line'>3417</span>     *     mode: 'DeskPhone',
<span class='line'>3418</span>     *     device: 'SEP01234567'
<span class='line'>3419</span>     * });
<span class='line'>3420</span>     * @param options
<span class='line'>3421</span>     * @param {Function} [options.progress] A handler called when the mode switch has passed pre-conditions.&lt;br>If specified, the handler is called when the switchMode operation starts.
<span class='line'>3422</span>     * @param {Function} [options.success(registration)] A handler called when mode switch complete with registration as a parameter
<span class='line'>3423</span>     * @param {Function} [options.error(err)] A handler called when the mode switch fails on pre-conditions.  {@link $.fn.cwic-errorMapEntry} is passed as parameter.
<span class='line'>3424</span>     * @param {string} [options.mode] The new mode 'SoftPhone'/'DeskPhone'.  Defaults to SoftPhone.  If you want to change a property on a desk phone, such as the line, you must explicitly set this parameter to 'DeskPhone'.
<span class='line'>3425</span>     * @param {string} [options.device] Name of the device (e.g. SEP012345678, ECPUSER) to control. If not specified and switching from SoftPhone to DeskPhone mode, it defaults to picking first available. If not specified and switching from DeskPhone to SoftPhone mode, it defaults to output of predictDevice function (see {@link $.fn.cwic-settings.predictDevice}). If 'first available' is desired result in this case, output of custom predictDevice function should be empty string (''). If device name is invalid, it fallbacks to default device selection algorithm. 
<span class='line'>3426</span>     * @param {string} [options.line] Phone number of a line valid for the specified device (e.g. '0000'). defaults to picking first available
<span class='line'>3427</span>     * @param {Boolean} [options.forceRegistration] Specifies whether to forcibly unregister other softphone instances with CUCM. Default is false. See GracefulRegistration doc for more info.
<span class='line'>3428</span>     */</span><span class="WHIT">
<span class='line'>3429</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">switchPhoneMode</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode started with arguments: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: no arguments provided, stoping execution!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3439</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">options.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">options.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3440</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">options.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">options.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3441</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.switchingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3442</span> 
<span class='line'>3443</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">switchModeArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3444</span> </span><span class="WHIT">            </span><span class="NAME">phoneMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options.mode</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="WHIT">            </span><span class="NAME">deviceName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options.device</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_predictDevice</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">username</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration.user</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3446</span> </span><span class="WHIT">            </span><span class="NAME">lineDN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options.line</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3447</span> </span><span class="WHIT">            </span><span class="NAME">forceRegistration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options.forceRegistration</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getDevicesCb</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">devices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">res.devices</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">                </span><span class="NAME">chooseDefault</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">                </span><span class="NAME">filteredDevices</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">                </span><span class="NAME">filteredDevicesNames</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">                </span><span class="NAME">selectedDeviceName</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">                </span><span class="NAME">isDeviceNameValid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3457</span> </span><span class="WHIT">                </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">switchModeArgs.phoneMode</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3458</span> </span><span class="WHIT">                </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">switchModeArgs.deviceName</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">                </span><span class="NAME">lineDN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">switchModeArgs.lineDN</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">                </span><span class="NAME">force</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">switchModeArgs.forceRegistration</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3461</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3462</span> </span><span class="WHIT">            </span><span class="NAME">filteredDevices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.grep</span><span class="PUNC">(</span><span class="NAME">devices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3463</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elem.isDeskPhone</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'DeskPhone'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3464</span> </span><span class="WHIT">                        </span><span class="NAME">elem.isSoftPhone</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3466</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3467</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filteredDevices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: filtered device list is empty!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3469</span> 
<span class='line'>3470</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">options.error</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'no device found for mode: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>3474</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3476</span> 
<span class='line'>3477</span> </span><span class="WHIT">            </span><span class="NAME">filteredDevicesNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.map</span><span class="PUNC">(</span><span class="NAME">filteredDevices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">device</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3478</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">device.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3479</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3480</span> 
<span class='line'>3481</span> </span><span class="WHIT">            </span><span class="NAME">isDeviceNameValid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$.inArray</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filteredDevicesNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3482</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3483</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isDeviceNameValid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">                </span><span class="NAME">chooseDefault</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3485</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3486</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3487</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isDeviceNameValid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: Device name not set or invalid, proceeding with default device selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chooseDefault</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">                </span><span class="NAME">lineDN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// ignore line if device name not given or not valid</span><span class="WHIT">
<span class='line'>3493</span> </span><span class="WHIT">                </span><span class="NAME">selectedDeviceName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filteredDevices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">filteredDevices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3494</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3495</span> </span><span class="WHIT">                </span><span class="NAME">selectedDeviceName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3497</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3498</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: selected device: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selectedDeviceName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3499</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: switching to mode: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3500</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'switchPhoneMode: switching to line: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3501</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3502</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'connect'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3503</span> </span><span class="WHIT">                    </span><span class="NAME">phoneMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="WHIT">                    </span><span class="NAME">deviceName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">selectedDeviceName</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">                    </span><span class="NAME">lineDN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lineDN</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3506</span> </span><span class="WHIT">                    </span><span class="NAME">forceRegistration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">force</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">successCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="WHIT">                    </span><span class="NAME">onProgress</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Switch mode operation started'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">options.error</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3518</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">        </span><span class="NAME">getAvailableDevices</span><span class="PUNC">(</span><span class="NAME">getDevicesCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3521</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">onProgress</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">options.progress</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3524</span> </span><span class="WHIT">                    </span><span class="NAME">options.progress</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3525</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">progressException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application switchPhoneMode progress callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">progressException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">                        </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3536</span> 
<span class='line'>3537</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3538</span>     * Register phone to CUCM (SIP register). Used for manual type of registration, in which connection parameters are manually configured (tftp, ccmcip, cti).
<span class='line'>3539</span>     * @param args A map with:
<span class='line'>3540</span>     * @param {String} args.user The CUCM end user name (required)
<span class='line'>3541</span>     * @param {String|Object} args.password String - clear password. Object - {encrypted: encoded password, cipher:'cucm'}
<span class='line'>3542</span>     * @param {String|Object|Array} args.cucm The list of CUCM(s) to attempt to register with (required).&lt;br>
<span class='line'>3543</span>     * If String, it will be used as a TFTP, CCMCIP and CTI address.&lt;br>
<span class='line'>3544</span>     * If Array, a list of String or Object as described above.
<span class='line'>3545</span>     * Three is the maximum number of addresses per server (TFTP, CCMCIP, CTI).
<span class='line'>3546</span>     * @param {String[]} [args.cucm.tftp] TFTP addresses. Maximum three values.
<span class='line'>3547</span>     * @param {String[]} [args.cucm.ccmcip] CCMCIP addresses (will use tftp values if not present). Maximum three values.
<span class='line'>3548</span>     * @param {String[]} [args.cucm.cti]  Since: 2.1.1 &lt;br>
<span class='line'>3549</span>     * CTI addresses (will use tftp values if not present). Maximum three values.
<span class='line'>3550</span>     * @param {String} [args.mode]  Register the phone in this mode. Available modes are "SoftPhone" or "DeskPhone". Default of intelligent guess is applied after a device is selected.&lt;br>
<span class='line'>3551</span>     * @param {Function} [args.devicesAvailable(devices, phoneMode, callback)] Callback called after successful authentication. Might be called multiple times.
<span class='line'>3552</span>     * If this callback is not specified, cwic applies the default device selection algorithm.  An array of {@link device} objects is passed so the application can select the device.&lt;br>
<span class='line'>3553</span>     * To complete the device registration, call the callback function that is passed in to devicesAvailable as the third parameter.
<span class='line'>3554</span>     * The callback function is defined in the API, but it must be called by the function that is specified as the devicesAvailable parameter.
<span class='line'>3555</span>     * @param {Function} [args.error(err)] Callback called if the registration fails.  {@link $.fn.cwic-errorMapEntry} is passed as parameter.
<span class='line'>3556</span>     * @param {Boolean} [args.forceRegistration] Specifies whether to forcibly unregister other softphone instances with CUCM. Default is false. See GracefulRegistration doc for more info.
<span class='line'>3557</span>     * @param {Function} [args.success(registration)] Callback called when registration succeeds. A {@link registration} object is passed to the callback:
<span class='line'>3558</span>     * registerPhone examples &lt;br>
<span class='line'>3559</span>     * @example
<span class='line'>3560</span>     * // *************************************
<span class='line'>3561</span>     * // register with lab CUCM in default mode (SoftPhone)
<span class='line'>3562</span>     * jQuery('#phone').cwic('registerPhone', {
<span class='line'>3563</span>     *     user: 'fbar',
<span class='line'>3564</span>     *     password: 'secret', // clear password
<span class='line'>3565</span>     *     cucm: '1.2.3.4',
<span class='line'>3566</span>     *     success: function (registration) {
<span class='line'>3567</span>     *         console.log('registered in mode ' + registration.mode);
<span class='line'>3568</span>     *         console.log('registered with device ' + registration.device.name);
<span class='line'>3569</span>     *     }
<span class='line'>3570</span>     * });
<span class='line'>3571</span>     * @example
<span class='line'>3572</span>     * // *************************************
<span class='line'>3573</span>     * // register with Alpha CUCM in DeskPhone mode with encrypted password
<span class='line'>3574</span>     * jQuery('#phone').cwic('registerPhone', {
<span class='line'>3575</span>     *     user: 'fbar',
<span class='line'>3576</span>     *     password: {
<span class='line'>3577</span>     *         encoded: 'GJH$&*"@$%$^BLKJ==',
<span class='line'>3578</span>     *         cipher: 'cucm'
<span class='line'>3579</span>     *     },
<span class='line'>3580</span>     *     mode: 'DeskPhone',
<span class='line'>3581</span>     *     cucm: '1.2.3.4',
<span class='line'>3582</span>     *     success: function (registration) {
<span class='line'>3583</span>     *         console.log('registered in mode ' + registration.mode);
<span class='line'>3584</span>     *         console.log('registered with device ' + registration.device.name);
<span class='line'>3585</span>     *     }
<span class='line'>3586</span>     * );
<span class='line'>3587</span>     * @example
<span class='line'>3588</span>     * // *************************************
<span class='line'>3589</span>     * // register with Alpha CUCM in SoftPhone mode, select ECP{user} device
<span class='line'>3590</span>     * jQuery('#phone').cwic('registerPhone', {
<span class='line'>3591</span>     *     user: 'fbar',
<span class='line'>3592</span>     *     password: {
<span class='line'>3593</span>     *         encoded: 'GJH$&*"@$%$^BLKJ==',
<span class='line'>3594</span>     *         cipher: 'cucm'
<span class='line'>3595</span>     *     },
<span class='line'>3596</span>     *     mode: 'SoftPhone',
<span class='line'>3597</span>     *     cucm: {
<span class='line'>3598</span>     *         ccmcip: ['1.2.3.4'],
<span class='line'>3599</span>     *         tftp: ['1.2.3.5']
<span class='line'>3600</span>     *     },
<span class='line'>3601</span>     *     devicesAvailable: function (devices, phoneMode, callback) {
<span class='line'>3602</span>     *         for (var i = 0; i &lt; devices.length; i++) {
<span class='line'>3603</span>     *             var device = devices[i];
<span class='line'>3604</span>     *             if (device.name.match(/^ECP/i)) {
<span class='line'>3605</span>     *                 callback(phoneMode, device);
<span class='line'>3606</span>     *             } // starts with 'ECP'
<span class='line'>3607</span>     *         }
<span class='line'>3608</span>     *         return; // stop registration if no ECP{user} device found
<span class='line'>3609</span>     *     },
<span class='line'>3610</span>     *     success: function (registration) {
<span class='line'>3611</span>     *         console.log('registered in mode ' + registration.mode);
<span class='line'>3612</span>     *         console.log('registered with device ' + registration.device.name);
<span class='line'>3613</span>     *     },
<span class='line'>3614</span>     *     error: function (err) {
<span class='line'>3615</span>     *         console.log('cannot register phone: ' + err.message);
<span class='line'>3616</span>     *     }
<span class='line'>3617</span>     * );
<span class='line'>3618</span>     */</span><span class="WHIT">
<span class='line'>3619</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">registerPhone</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">            </span><span class="NAME">devicesAvailableCb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="WHIT">            </span><span class="NAME">tftp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3623</span> </span><span class="WHIT">            </span><span class="NAME">ccmcip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3624</span> </span><span class="WHIT">            </span><span class="NAME">cti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">            </span><span class="NAME">result</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">            </span><span class="NAME">props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">            </span><span class="NAME">passphrase</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3628</span> 
<span class='line'>3629</span> </span><span class="WHIT">        </span><span class="COMM">// function definitions (callbacks)</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>3631</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">                </span><span class="COMM">// update passphrase with encrypted result</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">                </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">                    </span><span class="NAME">cipher</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'cucm'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">                    </span><span class="NAME">encrypted</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">res</span><span class="WHIT">
<span class='line'>3637</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3638</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="WHIT">            </span><span class="COMM">// continue with get and set for various props...</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="WHIT">                </span><span class="STRN">'TftpAddressList'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tftp</span><span class="WHIT">
<span class='line'>3642</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createCb</span><span class="PUNC">(</span><span class="STRN">'TftpAddressList'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3643</span> 
<span class='line'>3644</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">                </span><span class="STRN">'CtiAddressList'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">cti</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createCb</span><span class="PUNC">(</span><span class="STRN">'CtiAddressList'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3647</span> 
<span class='line'>3648</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">                </span><span class="STRN">'CcmcipAddressList'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ccmcip</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createCb</span><span class="PUNC">(</span><span class="STRN">'CcmcipAddressList'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3651</span> 
<span class='line'>3652</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'connectionStatus'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">createCb</span><span class="PUNC">(</span><span class="STRN">'connectionStatus'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3653</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3654</span> 
<span class='line'>3655</span> </span><span class="WHIT">        </span><span class="COMM">// first need to set/get a bunch of props before moving on to authenticateAndConnect</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createCb</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3657</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' callback received'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">                </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">props.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'TftpAddressList'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3661</span> </span><span class="WHIT">                    </span><span class="NAME">props.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'CtiAddressList'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3662</span> </span><span class="WHIT">                    </span><span class="NAME">props.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'CcmcipAddressList'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">                    </span><span class="NAME">props.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'connectionStatus'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">                    </span><span class="COMM">// all callbacks returned</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'All prop callbacks received.  Continuing toward authenticateAndConnect'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3667</span> 
<span class='line'>3668</span> </span><span class="WHIT">                    </span><span class="NAME">_plugin.connectionStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">props.connectionStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3669</span> 
<span class='line'>3670</span> </span><span class="WHIT">                    </span><span class="COMM">// now move on to authenticateAndConnect</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">                    </span><span class="NAME">authenticateAndConnect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3672</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3674</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3675</span> 
<span class='line'>3676</span> </span><span class="WHIT">        </span><span class="COMM">// authenticateAndConnect gets called after all the property set and get callbacks return</span><span class="WHIT">
<span class='line'>3677</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">authenticateAndConnect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3678</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_plugin.connectionStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3679</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">            </span><span class="COMM">// is the plugin already ready ?</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'eReady'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// state = connection status, not a call state!</span><span class="WHIT">
<span class='line'>3682</span> </span><span class="WHIT">                </span><span class="NAME">_triggerProviderEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">currState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3683</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3684</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3685</span> 
<span class='line'>3686</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currState</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'eReady'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// state = connection status, not a call state!    </span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">                </span><span class="NAME">regGlobals.currState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currState</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>3689</span> </span><span class="WHIT">                </span><span class="COMM">// authenticatedCallback is called affter receiving authenticationresult event with positive outcome</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">                </span><span class="NAME">regGlobals.authenticatedCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getAuthenticatedCb</span><span class="PUNC">(</span><span class="NAME">devicesAvailableCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">                </span><span class="COMM">// in this step, passphrase must be in encrypted format</span><span class="WHIT">
<span class='line'>3693</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">passphrase.encrypted</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">passphrase.cipher</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'cucm'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'authenticateAndConnect: invalid passphrase (type '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">                        </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">                </span><span class="COMM">// plugin is saving credentials, so, after first login attempt with wrong credentials, credentialsRequired is triggered with "wrongCredentials" error. </span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">                </span><span class="COMM">// When next time lifecycle is started, the same message will be again attached to credentialsRequired event, which will cause _triggerError call... </span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">                </span><span class="COMM">// So, instead of starting lifecycle every time registerPhone is called, only encrypt new credentials and submit.</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">regGlobals.errorState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'credentialsRequired'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerCredentialsRequired</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">                        </span><span class="NAME">errors</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">                        </span><span class="NAME">error</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">                        </span><span class="NAME">authenticatorId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">regGlobals.lastAuthenticatorId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">                    </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'startSignIn'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">                            </span><span class="NAME">manualSettings</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">                        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">                            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">                                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3714</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3719</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">       </span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">        </span><span class="COMM">////////////////////////////////</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">        </span><span class="COMM">// registerPhone main logic     </span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">        </span><span class="NAME">logArgsWithMaskedPassphrase</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3724</span> 
<span class='line'>3725</span> </span><span class="WHIT">        </span><span class="COMM">// M for manual</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">        </span><span class="NAME">setRegGlobalsM</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3727</span> 
<span class='line'>3728</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">            </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseAndCheckArgs</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3730</span> </span><span class="WHIT">            </span><span class="NAME">devicesAvailableCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.devicesAvailableCb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">            </span><span class="NAME">tftp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.tftp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">            </span><span class="NAME">ccmcip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.ccmcip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">            </span><span class="NAME">cti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.cti</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3734</span> </span><span class="WHIT">            </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.passphrase</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3735</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">            </span><span class="COMM">// parseAndCheckArgs triggers error callback</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3739</span> 
<span class='line'>3740</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3741</span> </span><span class="WHIT">            </span><span class="COMM">// clear passphrase, encrypt it</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'encryptCucmPassword'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">passphrase</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">encryptCb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">            </span><span class="COMM">// passphrase valid and already encrypted</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">            </span><span class="NAME">encryptCb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3746</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3747</span> 
<span class='line'>3748</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3749</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3750</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3751</span> </span><span class="WHIT">    </span><span class="COMM">// for registerPhone</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">logArgsWithMaskedPassphrase</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argsForLog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3754</span> 
<span class='line'>3755</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">argsForLog.passphrase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3756</span> </span><span class="WHIT">            </span><span class="NAME">argsForLog.passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'*****'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3757</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3758</span> 
<span class='line'>3759</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">argsForLog.password</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3760</span> </span><span class="WHIT">            </span><span class="NAME">argsForLog.password</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'*****'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3761</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3762</span> 
<span class='line'>3763</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'manualSignIn'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">argsForLog</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3764</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3765</span> 
<span class='line'>3766</span> </span><span class="WHIT">    </span><span class="COMM">// for registerPhone</span><span class="WHIT">
<span class='line'>3767</span> </span><span class="WHIT">    </span><span class="COMM">// M for Manual</span><span class="WHIT">
<span class='line'>3768</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRegGlobalsM</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3769</span> </span><span class="WHIT">        </span><span class="COMM">// flag to indicate cwic is in the process of registering a phone in manual mode</span><span class="WHIT">
<span class='line'>3770</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.registeringPhone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.manual</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3772</span> 
<span class='line'>3773</span> </span><span class="WHIT">        </span><span class="COMM">// reset global registration object</span><span class="WHIT">
<span class='line'>3774</span> </span><span class="WHIT">        </span><span class="NAME">registration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">            </span><span class="NAME">user</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.user</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">            </span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.mode</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'SoftPhone'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">            </span><span class="NAME">devices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">            </span><span class="NAME">forceRegistration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">args.forceRegistration</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3780</span> 
<span class='line'>3781</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.successCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.CUCM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.cucm</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">        </span><span class="NAME">regGlobals.user</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.user</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3785</span> 
<span class='line'>3786</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRegGlobalsM: regGlobals set: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRegGlobalsM: registration set: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3789</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3790</span> </span><span class="WHIT">    </span><span class="COMM">// for registerPhone</span><span class="WHIT">
<span class='line'>3791</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">parseAndCheckArgs</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3792</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">passphraseValidator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validators.get</span><span class="PUNC">(</span><span class="STRN">'passphrase'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3793</span> </span><span class="WHIT">            </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3794</span> </span><span class="WHIT">                </span><span class="NAME">devicesAvailableCb</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3795</span> </span><span class="WHIT">                </span><span class="NAME">tftp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">                </span><span class="NAME">ccmcip</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">                </span><span class="NAME">cti</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">                </span><span class="NAME">passphrase</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3800</span> 
<span class='line'>3801</span> </span><span class="WHIT">        </span><span class="NAME">result.devicesAvailableCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.devicesAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.devicesAvailable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3802</span> 
<span class='line'>3803</span> </span><span class="WHIT">        </span><span class="COMM">// check plugin state also!</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_plugin</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.PluginNotAvailable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Plug-in is not available or has not been initialized'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3808</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3809</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3810</span> 
<span class='line'>3811</span> </span><span class="WHIT">        </span><span class="COMM">// parse CUCM argument into tftp, ccmcip and cti arrays (list of String addresses)</span><span class="WHIT">
<span class='line'>3812</span> </span><span class="WHIT">        </span><span class="COMM">// from the 11.0 release and on, tftp, ccmcip and cti are limited to 3 addresses only</span><span class="WHIT">
<span class='line'>3813</span> 
<span class='line'>3814</span> </span><span class="WHIT">        </span><span class="COMM">// args.cucm can be a String, an Object or an Array of both</span><span class="WHIT">
<span class='line'>3815</span> </span><span class="WHIT">        </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">$.makeArray</span><span class="PUNC">(</span><span class="NAME">args.cucm</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3816</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3817</span> </span><span class="WHIT">                </span><span class="COMM">// cucm string can be 'lab call manager 1.2.3.4'</span><span class="WHIT">
<span class='line'>3818</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem.split</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3819</span> </span><span class="WHIT">                </span><span class="NAME">result.tftp.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3820</span> </span><span class="WHIT">                </span><span class="NAME">result.ccmcip.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">                </span><span class="NAME">result.cti.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3823</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tftpElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// the tftp array of the current elem</span><span class="WHIT">
<span class='line'>3824</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasOneProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// just to log a warning</span><span class="WHIT">
<span class='line'>3825</span> 
<span class='line'>3826</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">elem.tftp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3827</span> </span><span class="WHIT">                    </span><span class="NAME">result.tftp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.tftp.concat</span><span class="PUNC">(</span><span class="NAME">elem.tftp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">                    </span><span class="NAME">tftpElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem.tftp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">                    </span><span class="NAME">hasOneProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3831</span> 
<span class='line'>3832</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">elem.ccmcip</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">                    </span><span class="NAME">result.ccmcip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.ccmcip.concat</span><span class="PUNC">(</span><span class="NAME">elem.ccmcip</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3834</span> </span><span class="WHIT">                    </span><span class="NAME">hasOneProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3835</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3836</span> </span><span class="WHIT">                    </span><span class="COMM">// ccmcip defaults to tftp (backward compatibility)</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">                    </span><span class="NAME">result.ccmcip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.ccmcip.concat</span><span class="PUNC">(</span><span class="NAME">tftpElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3838</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3839</span> 
<span class='line'>3840</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">elem.cti</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">                    </span><span class="NAME">result.cti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.cti.concat</span><span class="PUNC">(</span><span class="NAME">elem.cti</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3842</span> </span><span class="WHIT">                    </span><span class="NAME">hasOneProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3843</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">                    </span><span class="COMM">// cti defaults to tftp (backward compatibility)</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="WHIT">                    </span><span class="NAME">result.cti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.cti.concat</span><span class="PUNC">(</span><span class="NAME">tftpElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3847</span> 
<span class='line'>3848</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">hasOneProperty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: no ccmcip/tftp/cti properties for cucm element'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: ignoring cucm argument of type '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3856</span> 
<span class='line'>3857</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">result.tftp.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' cucm TFTP address(es)'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result.tftp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">result.ccmcip.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' cucm CCMCIP address(es)'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result.ccmcip</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">result.cti.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' cucm CTI address(es)'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result.cti</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3863</span> 
<span class='line'>3864</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result.tftp.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">result.ccmcip.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">result.cti.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone: Server address(es) are limited to 3 values. Only first 3 values will be kept.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">            </span><span class="NAME">result.tftp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.tftp.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">            </span><span class="NAME">result.ccmcip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.ccmcip.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">            </span><span class="NAME">result.cti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result.cti.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3870</span> 
<span class='line'>3871</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'registerPhone of user='</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">registration.user</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' in mode="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">registration.mode</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3872</span> 
<span class='line'>3873</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">registration.user</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Missing user name'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3878</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3879</span> 
<span class='line'>3880</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">result.tftp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">result.tftp.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.NoCallManagerConfigured</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Missing CUCM address'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3886</span> 
<span class='line'>3887</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">registration.mode.match</span><span class="PUNC">(</span><span class="REGX">/^(SoftPhone|DeskPhone)$/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Invalid phone mode "'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">registration.mode</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3893</span> 
<span class='line'>3894</span> </span><span class="WHIT">        </span><span class="COMM">// validate password</span><span class="WHIT">
<span class='line'>3895</span> </span><span class="WHIT">        </span><span class="NAME">result.passphrase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.passphrase</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">args.password</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3896</span> 
<span class='line'>3897</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">result.passphrase</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">passphraseValidator.isNotValid</span><span class="PUNC">(</span><span class="NAME">result.passphrase</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'invalid passphrase'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="WHIT">                    </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3901</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3904</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">result.passphrase</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result.passphrase.cipher</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'cucm'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3905</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'invalid passphrase (type '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">result.passphrase</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3906</span> </span><span class="WHIT">                </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3907</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3908</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3909</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">passphraseValidator.isNotValid</span><span class="PUNC">(</span><span class="NAME">result.passphrase.encrypted</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regGlobals.errorCb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'invalid passphrase'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3912</span> </span><span class="WHIT">                    </span><span class="NAME">registration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registration</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Break manual login'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3915</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3916</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3917</span> 
<span class='line'>3918</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3919</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3920</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3921</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3922</span>      * Alias for {@link $.fn.cwic-registerPhone}
<span class='line'>3923</span>      */</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">manualSignIn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3926</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">    </span><span class="COMM">/** &lt;br>
<span class='line'>3929</span>     * Unregisters a phone from CUCM:&lt;ul>
<span class='line'>3930</span>     * &lt;li>Ends any active call if this is the last instance or forceLogout is set to true.&lt;/li>
<span class='line'>3931</span>     * &lt;li>In softphone mode, SIP unregisters, in deskphone mode, closes the CTI connection.&lt;/li>
<span class='line'>3932</span>     * &lt;li>Calls the optional complete handler (always called).&lt;/li>&lt;/ul>
<span class='line'>3933</span>     * @param args Is a set of key/value pairs to configure the phone unregistration.
<span class='line'>3934</span>     * @param {Function} [args.complete] Callback called when unregistration is successfully completed.&lt;br>
<span class='line'>3935</span>     * If specified, the handler is called only in the case where the phone was already registered.
<span class='line'>3936</span>     * @param {Boolean} args.forceLogout: If true, end the phone session even if registered in other instances.
<span class='line'>3937</span>     * unregisterPhone examples
<span class='line'>3938</span>     * @example
<span class='line'>3939</span>     * // *************************************
<span class='line'>3940</span>     * // unregister phone
<span class='line'>3941</span>     * jQuery('#phone')
<span class='line'>3942</span>     *     .unbind('.cwic')             // optionally unbind cwic events (it's done in shutdown API automatically)
<span class='line'>3943</span>     *     .cwic('unregisterPhone', {
<span class='line'>3944</span>     *         forceLogout: true,   
<span class='line'>3945</span>     *         complete: function() {
<span class='line'>3946</span>     *             console.log('phone is unregistered');
<span class='line'>3947</span>     *         }
<span class='line'>3948</span>     * });
<span class='line'>3949</span>     */</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">unregisterPhone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'unregisterPhone'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3952</span> 
<span class='line'>3953</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">        </span><span class="COMM">// have to close it here because of ECC bug, which cause plugin to crash during signing out while call in progress (preview + remote video)</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">        </span><span class="NAME">hideExternalWindow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3957</span> 
<span class='line'>3958</span> </span><span class="WHIT">        </span><span class="COMM">// should we remove forceLogout parameter at all? What is the purpose of it? If it is false, nothing happens</span><span class="WHIT">
<span class='line'>3959</span> </span><span class="WHIT">        </span><span class="COMM">// leave it only for backward compatibility</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">forceLogout</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3961</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'logout'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3962</span> 
<span class='line'>3963</span> </span><span class="WHIT">            </span><span class="COMM">// reset global registration object</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">            </span><span class="NAME">registration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3965</span> </span><span class="WHIT">                </span><span class="NAME">devices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3966</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3968</span> 
<span class='line'>3969</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">complete</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">            </span><span class="COMM">// call complete callback</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">complete</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.unregisterCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Calling unregisterCb...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3974</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3975</span> </span><span class="WHIT">                    </span><span class="NAME">complete</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3976</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">completeException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3977</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application unregister complete callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">completeException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3979</span> </span><span class="WHIT">                        </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3980</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3981</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3982</span> 
<span class='line'>3983</span> </span><span class="WHIT">                </span><span class="NAME">regGlobals.unregisterCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3986</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">        </span><span class="NAME">_reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3989</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3992</span> </span><span class="WHIT">     </span><span class="COMM">/** &lt;br>
<span class='line'>3993</span>     * Signs out a registered device from CUCM:&lt;ul> 
<span class='line'>3994</span>     * &lt;li>Ends any active call.&lt;/li>
<span class='line'>3995</span>     * &lt;li>In softphone mode, SIP unregisters, in deskphone mode, closes the CTI connection.&lt;/li>
<span class='line'>3996</span>     * &lt;li>Calls the optional complete callback&lt;/li>&lt;/ul>
<span class='line'>3997</span>     * If specified, the function is called only in the case where the phone was already registered. &lt;br>
<span class='line'>3998</span>     * &lt;b>Note:&lt;/b> This API is a preferred alternative to unregisterPhone API.&lt;br>
<span class='line'>3999</span>     * &lt;br>
<span class='line'>4000</span>     * signOut examples: &lt;br>
<span class='line'>4001</span>     * @example
<span class='line'>4002</span>     * // *************************************
<span class='line'>4003</span>     * // signOut device
<span class='line'>4004</span>     * jQuery('#phone')
<span class='line'>4005</span>     *     .cwic('signOut', {
<span class='line'>4006</span>     *         complete: function() {
<span class='line'>4007</span>     *             console.log('device is signed out');
<span class='line'>4008</span>     *         }
<span class='line'>4009</span>     * });
<span class='line'>4010</span>     * 
<span class='line'>4011</span>     * @param [args] Is a set of key/value pairs to configure the phone signOut.
<span class='line'>4012</span>     * @param {Function} [args.complete] Callback called when sign out is successfully completed.&lt;br>
<span class='line'>4013</span>     */</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">signOut</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4015</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">completeCb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4016</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'signOut'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">complete</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4019</span> </span><span class="WHIT">            </span><span class="COMM">// call complete callback</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">            </span><span class="NAME">completeCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">complete</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4023</span> </span><span class="WHIT">        </span><span class="NAME">unregisterPhone</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">forceLogout</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">completeCb</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4024</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4025</span> 
<span class='line'>4026</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4027</span>      * Should clear all resources occupied during the signIn/registerPhone process and during regular usage of registered device.
<span class='line'>4028</span>      * @private
<span class='line'>4029</span>      */</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'_reset: reseting regGlobals...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">        </span><span class="COMM">// clear all cwic data - data attached with $('.cwic-data').data('cwic', somedata);</span><span class="WHIT">
<span class='line'>4033</span> </span><span class="WHIT">        </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.cwic-data'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeData</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="WHIT">        </span><span class="NAME">resetGlobals</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4036</span> 
<span class='line'>4037</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">objEqual</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4039</span> 
<span class='line'>4040</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4043</span> 
<span class='line'>4044</span> </span><span class="WHIT">        </span><span class="NAME">$.each</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">o2</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">equal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4047</span> 
<span class='line'>4048</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4050</span> 
<span class='line'>4051</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>4052</span>    * IMPORTANT: if new property is added to call object, this function must be updated !!!!
<span class='line'>4053</span>    * @param c1
<span class='line'>4054</span>    * @param c2
<span class='line'>4055</span>    * @returns {boolean}
<span class='line'>4056</span>    */</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">compareConversationObjects</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4058</span> 
<span class='line'>4059</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">            </span><span class="NAME">c1.audioMuted</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.audioMuted</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">            </span><span class="NAME">c1.callType</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.callType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4062</span> </span><span class="WHIT">            </span><span class="NAME">c1.isConference</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.isConference</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="WHIT">            </span><span class="NAME">c1.exists</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.exists</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">            </span><span class="NAME">c1.videoDirection</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.videoDirection</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4065</span> </span><span class="WHIT">            </span><span class="NAME">c1.videoMuted</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.videoMuted</span><span class="WHIT">
<span class='line'>4066</span> 
<span class='line'>4067</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4070</span> 
<span class='line'>4071</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4072</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">objEqual</span><span class="PUNC">(</span><span class="NAME">c1.capabilities</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c2.capabilities</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">objEqual</span><span class="PUNC">(</span><span class="NAME">c1.localParticipant</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c2.localParticipant</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">objEqual</span><span class="PUNC">(</span><span class="NAME">c1.participant</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c2.participant</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">            </span><span class="NAME">c1.participants.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">c2.participants.length</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">objEqual</span><span class="PUNC">(</span><span class="NAME">c1.videoResolution</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c2.videoResolution</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4077</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4080</span> 
<span class='line'>4081</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4083</span> 
<span class='line'>4084</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerConversationEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">topic</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.callId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.callState</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4087</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastConversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lastConversationMap</span><span class="PUNC">[</span><span class="NAME">conversationId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4088</span> 
<span class='line'>4089</span> </span><span class="WHIT">        </span><span class="COMM">// bypass JCF bug that emits "Connected" state after conversation is ended - this can cause various bugs, i.e. calling showCallInExternalWindow after conversation is destroyed</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">        </span><span class="COMM">// it works for locally ended calls, but not for calls ended by the other side</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">regGlobals.endingCallForId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conversationState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Connected'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Ignoring "connect" state [ending call]!'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4093</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4094</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4095</span> 
<span class='line'>4096</span> </span><span class="WHIT">        </span><span class="COMM">// ... so, additionally filter all duplicated 'Connect' state notifications</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="WHIT">        </span><span class="NAME">lastConversationMap</span><span class="PUNC">[</span><span class="NAME">conversationId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">            </span><span class="NAME">lastConversation</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">lastConversation.callState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Connected'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conversationState</span><span class="WHIT">  </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Connected'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>4100</span> </span><span class="WHIT">            </span><span class="NAME">compareConversationObjects</span><span class="PUNC">(</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastConversation</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Ignoring "connect" state!'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4105</span> 
<span class='line'>4106</span> </span><span class="WHIT">        </span><span class="COMM">// prevent call transfer while another one is in progress</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transferCallGlobals.inProgress</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">            </span><span class="NAME">conversation.capabilities.canDirectTransfer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4109</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4110</span> 
<span class='line'>4111</span> </span><span class="WHIT">        </span><span class="COMM">// determine first participant name and number (remote participant)</span><span class="WHIT">
<span class='line'>4112</span> </span><span class="WHIT">        </span><span class="COMM">// CSCug19119: we no longer use conversation.calledPartyName and conversation.calledPartyNumber since those are depreciated from ECC</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">        </span><span class="COMM">// instead, just grab the first entry from participants list, if available</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conversation.participants</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conversation.participants.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">conversation.participants</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">participant.directoryNumber</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">participant.directoryNumber</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">participant.directoryNumber</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">participant.number</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">        </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">recipient</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">number</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4117</span> 
<span class='line'>4118</span> </span><span class="WHIT">        </span><span class="COMM">// select the conversation container with class cwic-conversation-{conversationId}</span><span class="WHIT">
<span class='line'>4119</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4120</span> 
<span class='line'>4121</span> </span><span class="WHIT">        </span><span class="COMM">// if no container, select the outgoing conversation (see startConversation)</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">            </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.cwic-conversation-outgoing'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4124</span> 
<span class='line'>4125</span> </span><span class="WHIT">            </span><span class="COMM">// in deskphone mode, container may not exist yet if conversation was initiated from deskphone</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">            </span><span class="COMM">//if (container.length == 0 && conversation.callType == 'Outgoing') {</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">            </span><span class="COMM">//container = $('&lt;div>').addClass('cwic-conversation-outgoing');</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">            </span><span class="COMM">//}</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4130</span> 
<span class='line'>4131</span> </span><span class="WHIT">        </span><span class="COMM">// at this point container may be empty, which means the conversation is incoming</span><span class="WHIT">
<span class='line'>4132</span> 
<span class='line'>4133</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">container.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4134</span> 
<span class='line'>4135</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'conversation id='</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' state='</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversation.callState</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">data.state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4136</span> 
<span class='line'>4137</span> </span><span class="WHIT">        </span><span class="COMM">// extend conversation</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">        </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">            </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">            </span><span class="NAME">state</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationState</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">data.state</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4141</span> </span><span class="WHIT">            </span><span class="NAME">participant</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">data.participant</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4142</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4143</span> 
<span class='line'>4144</span> </span><span class="WHIT">        </span><span class="COMM">/* ECC call states and old skittles/webphone states
<span class='line'>4145</span>         OnHook : Disconnected
<span class='line'>4146</span>         OffHook : Created
<span class='line'>4147</span>         Ringout : RemotePartyAlerting
<span class='line'>4148</span>         Ringin : Alerting
<span class='line'>4149</span>         Proceed : Ringin on Deskphone while on a call amongst others
<span class='line'>4150</span>         Connected : Connected
<span class='line'>4151</span>         Hold : Held
<span class='line'>4152</span>         RemHold : "Passive Held"
<span class='line'>4153</span>         Resume : ?
<span class='line'>4154</span>         Busy : n/a (connected)
<span class='line'>4155</span>         Reorder : Failed
<span class='line'>4156</span>         Conference : n/a
<span class='line'>4157</span>         Dialing : Dialing
<span class='line'>4158</span>         RemInUse : "Passive not held" ("RemInUse" should indicate 'Remote In-Use' state, i.e. the line is a shared-line, and another device is actively using the shared line.)
<span class='line'>4159</span>         HoldRevert : n/a
<span class='line'>4160</span>         Whisper : n/a
<span class='line'>4161</span>         Parked : n/a
<span class='line'>4162</span>         ParkRevert : n/a
<span class='line'>4163</span>         ParkRetrieved : n/a
<span class='line'>4164</span>         Preservation : n/a
<span class='line'>4165</span>         WaitingForDigits : na/ ? Overlapdial capability ?
<span class='line'>4166</span>         Spoof_Ringout : n/a
<span class='line'>4167</span>         */</span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">        </span><span class="COMM">// check for an incoming call - based on condition:</span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">        </span><span class="COMM">// * Empty container and conversation state 'Ringin'</span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conversation.state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Ringin'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">            </span><span class="COMM">// new container for incoming call, application is supposed to attach it to the DOM</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">            </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'&lt;div>'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-data cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">            </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationIncoming.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">conversation.state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'OnHook'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">conversation.capabilities.canOriginateCall</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">conversation.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">            </span><span class="COMM">// If we can originate a call, onHook does not mean the call has ended - it means it's just about to start</span><span class="WHIT">
<span class='line'>4177</span> 
<span class='line'>4178</span> </span><span class="WHIT">            </span><span class="NAME">removeWindowFromCall</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">                </span><span class="NAME">remoteVideoWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">activeConversation.videoObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">                </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">activeConversation.window</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">                </span><span class="NAME">endCall</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4184</span> 
<span class='line'>4185</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'warning: no container for ended conversation '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">                </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationEnd.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4190</span> 
<span class='line'>4191</span> </span><span class="WHIT">            </span><span class="NAME">container.removeData</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'cwic-data cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">trigger</span><span class="PUNC">(</span><span class="STRN">'conversationEnd.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4194</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conversation.state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'OffHook'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">conversation.state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Connected'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4198</span> 
<span class='line'>4199</span> </span><span class="WHIT">                </span><span class="COMM">// store media connection time</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">conversation.connect</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conversation.state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'Connected'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">                        </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'&lt;div>'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">                    </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">connect</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">                    </span><span class="NAME">container.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4207</span> 
<span class='line'>4208</span> </span><span class="WHIT">                </span><span class="COMM">// store start time and trigger start event only once</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">conversation.start</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">                        </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'&lt;div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">                    </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">                    </span><span class="NAME">container.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4215</span> 
<span class='line'>4216</span> </span><span class="WHIT">                    </span><span class="NAME">container</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'cwic-conversation-outgoing'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4218</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4220</span> 
<span class='line'>4221</span> </span><span class="WHIT">                    </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationStart.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4222</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4225</span> 
<span class='line'>4226</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">                </span><span class="COMM">// if we've just switched to deskphone mode and there's already a call, create a container div</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">                </span><span class="COMM">// or if we've just opened a new tab, we also need to trigger a conversation start for an ongoing call</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">                </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'&lt;div>'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'warning: no container for updated conversation '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conversation.exists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4232</span> </span><span class="WHIT">                    </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationStart.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">                    </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationUpdate.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// trigger update event</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4238</span> 
<span class='line'>4239</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4240</span> </span><span class="WHIT">                </span><span class="NAME">container.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4241</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4242</span> 
<span class='line'>4243</span> </span><span class="WHIT">            </span><span class="NAME">container.trigger</span><span class="PUNC">(</span><span class="STRN">'conversationUpdate.cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">conversation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// trigger update event</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4245</span> 
<span class='line'>4246</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// function _triggerConversationEvent</span><span class="WHIT">
<span class='line'>4247</span> 
<span class='line'>4248</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4249</span>     * _triggerError(target, [callback], [code], [data]) &lt;br>
<span class='line'>4250</span>     * &lt;br>
<span class='line'>4251</span>     * - target (Object): a jQuery selection where to trigger the event error from &lt;br>
<span class='line'>4252</span>     * - callback (Function): an optional callback to be called call with the error. if specifed, prevents the generic error event to be triggered &lt;br>
<span class='line'>4253</span>     * - code (Number): an optional cwic error code (defaults to 0 - Unknown) &lt;br>
<span class='line'>4254</span>     * - data (String, Object): some optional error data, if String, used as error message. if Object, used to extend the error. &lt;br>
<span class='line'>4255</span>     * &lt;br>
<span class='line'>4256</span>     * cwic builds an error object with the following properties: &lt;br>
<span class='line'>4257</span>     *  code: a pre-defined error code &lt;br>
<span class='line'>4258</span>     *  message: the error message (optional) &lt;br>
<span class='line'>4259</span>     *  any other data passed to _triggerError or set to errorMap (see the init function) &lt;br>
<span class='line'>4260</span>     *  &lt;br>
<span class='line'>4261</span>     * When an error event is triggered, the event object is extended with the error properties. &lt;br>
<span class='line'>4262</span>     * &lt;br>
<span class='line'>4263</span>     */</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4265</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// target (first mandatory argument)</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4267</span> 
<span class='line'>4268</span> </span><span class="WHIT">        </span><span class="COMM">// the default error</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.Unknown</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4270</span> 
<span class='line'>4271</span> </span><span class="WHIT">        </span><span class="COMM">// extend error from arguments</span><span class="WHIT">
<span class='line'>4272</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4274</span> 
<span class='line'>4275</span> </span><span class="WHIT">            </span><span class="COMM">// is the argument a specific error callback ?</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4277</span> 
<span class='line'>4278</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">error.details.push</span><span class="PUNC">(</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4279</span> 
<span class='line'>4280</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4281</span> 
<span class='line'>4282</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4283</span> 
<span class='line'>4284</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">error.message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4285</span> 
<span class='line'>4286</span> </span><span class="WHIT">        </span><span class="COMM">// if specific error callback, call it</span><span class="WHIT">
<span class='line'>4287</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorCb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4288</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="WHIT">                </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4290</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorException</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'Exception occurred in application error callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorException</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">                    </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4296</span> 
<span class='line'>4297</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="WHIT">            </span><span class="COMM">// if no specific error callback, raise generic error event</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'error.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4300</span> </span><span class="WHIT">            </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4301</span> </span><span class="WHIT">            </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4303</span> 
<span class='line'>4304</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4306</span> 
<span class='line'>4307</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4308</span>     * @param {Object|call} conversation Can be a new object to start a new conversation or an existing {@link call} which you wish to answer.
<span class='line'>4309</span>     * @param {Number} conversation.id Unique identifier of the conversation.  Required when referencing an exising call.
<span class='line'>4310</span>     * @param {participant} conversation.participant First remote participant of the call.
<span class='line'>4311</span>     * @param {String} conversation.participant.recipient The phone number of the participant.  Required when placing a new outbound call.  This will be the dialed number for the call.
<span class='line'>4312</span>     * @param {String} [conversation.participant.name] The participant name.
<span class='line'>4313</span>     * @param {String} [conversation.participant.photosrc] A suitable value for the src attribute of an &lt;img&gt; element.
<span class='line'>4314</span>     * @param {String} [conversation.state] Current state of the conversation. Can be OffHook, Ringing, Connected, OnHook, Reorder.
<span class='line'>4315</span>     * @param {Date} [conversation.start] Start time. Defined on resolution update only.
<span class='line'>4316</span>     * @param {Date} [conversation.connect] Media connection time. Defined on resolution update only.
<span class='line'>4317</span>     * @param {Object} [conversation.videoResolution] Resolution of the video conversation, contains width and height properties. Defined on resolution update only.
<span class='line'>4318</span>     * @param {String|Object} [conversation.container] The HTML element which contains the conversation. Conversation events are triggered on this element.
<span class='line'>4319</span>     * If String, specifies a jQuery selector If Object, specifies a jQuery wrapper of matched elements(s).
<span class='line'>4320</span>     * By default container is $(this), that is the first element of the matched set startConversation is called on.
<span class='line'>4321</span>     * @param {String} [conversation.subject] The subject of the conversation to start.
<span class='line'>4322</span>     * @param {Function} [conversation.error(err)] A function to be called if the conversation cannot be started.  {@link $.fn.cwic-errorMapEntry} is passed as parameter.
<span class='line'>4323</span>     * @param {String} [conversation.videoDirection] The video media direction: 'Inactive' or undefined (audio only by default), 'SendOnly', 'RecvOnly' or 'SendRecv'.
<span class='line'>4324</span>     * @param {Object} [conversation.remoteVideoWindow] The video object (must be of mime type application/x-cisco-cwc-videocall).
<span class='line'>4325</span>     * @param {DOMWindow} [conversation.window] DOM window that contains the remoteVideoWindow (default to this DOM window) required if specifying a video object on another window (popup/iframe).
<span class='line'>4326</span>     * @description Start a conversation with a participant.
<span class='line'>4327</span>     * &lt;br>If conversation contain both an ID and a state property, cwic assumes you want to answer that incoming conversation, in this case starting the passed conversation means accepting(answering) it.
<span class='line'>4328</span>     * @example
<span class='line'>4329</span>     * // start an audio conversation with element #foo as container
<span class='line'>4330</span>     * jQuery('#phone').cwic('startConversation', {
<span class='line'>4331</span>     *   participant: {
<span class='line'>4332</span>     *     recipient: '1234'
<span class='line'>4333</span>     *   },
<span class='line'>4334</span>     *   container: '#foo'
<span class='line'>4335</span>     * });
<span class='line'>4336</span>     * // start an audio conversation with a contact (call work phone number)
<span class='line'>4337</span>     * jQuery('#conversation').cwic('startConversation', {
<span class='line'>4338</span>     *   participant: {
<span class='line'>4339</span>     *     recipient: '1234',
<span class='line'>4340</span>     *     displayName: 'Foo Bar',
<span class='line'>4341</span>     *     screenName: ' fbar',
<span class='line'>4342</span>     *     phoneNumbers: {
<span class='line'>4343</span>     *       work: '1234',
<span class='line'>4344</span>     *       mobile: '5678'
<span class='line'>4345</span>     *     }
<span class='line'>4346</span>     *   }
<span class='line'>4347</span>     * });
<span class='line'>4348</span>     * // answer an incoming conversation (input has an id property)
<span class='line'>4349</span>     * // see another example about the conversationIncoming event
<span class='line'>4350</span>     * jQuery('#conversation').cwic('startConversation', {
<span class='line'>4351</span>     *   participant: {
<span class='line'>4352</span>     *     recipient: '1234'
<span class='line'>4353</span>     *   },
<span class='line'>4354</span>     *   id: '612',
<span class='line'>4355</span>     *   state: 'Ringin'
<span class='line'>4356</span>     * });
<span class='line'>4357</span>     * // answer an incoming conversation with video
<span class='line'>4358</span>     * jQuery('#conversation').cwic('startConversation',
<span class='line'>4359</span>     *   jQuery.extend(conversation,{
<span class='line'>4360</span>     *   videoDirection: (sendingVideo ? 'SendRecv':''),
<span class='line'>4361</span>     *   remoteVideoWindow: 'remoteVideoWindow',  // pass id
<span class='line'>4362</span>     *   id: callId
<span class='line'>4363</span>     * }));
<span class='line'>4364</span>     * // answer an incoming conversation with video object hosted in popoutwindow
<span class='line'>4365</span>     * jQuery('#conversation').cwic('startConversation',
<span class='line'>4366</span>     *   jQuery.extend(conversation,{
<span class='line'>4367</span>     *   videoDirection: (sendingVideo ? 'SendRecv':''),
<span class='line'>4368</span>     *   remoteVideoWindow: $('#remoteVideoWindow', popoutwindow.document)[0] // pass object setting jQuery context to popoutwindow document
<span class='line'>4369</span>     *   window: popoutwindow,
<span class='line'>4370</span>     *   id: callId
<span class='line'>4371</span>     * }));
<span class='line'>4372</span>     * // answer an incoming conversation without video
<span class='line'>4373</span>     * jQuery('#callcontainer').cwic('startConversation', conversation);
<span class='line'>4374</span>     */</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">startConversation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4376</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'startConversation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4377</span> 
<span class='line'>4378</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> 
<span class='line'>4380</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callsettings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowhandle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">videoDirection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4382</span> 
<span class='line'>4383</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$this.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4384</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callsettings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot start conversation with empty selection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4386</span> 
<span class='line'>4387</span> </span><span class="WHIT">        </span><span class="COMM">// container is the jQuery wrapper of the video container</span><span class="WHIT">
<span class='line'>4388</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4389</span> 
<span class='line'>4390</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">callsettings.container</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4391</span> </span><span class="WHIT">            </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">callsettings.container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">callsettings.container</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">            </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4394</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4395</span> 
<span class='line'>4396</span> </span><span class="WHIT">        </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">container.first</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4397</span> 
<span class='line'>4398</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">callsettings.id</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4399</span> </span><span class="WHIT">            </span><span class="COMM">// start an incoming conversation</span><span class="WHIT">
<span class='line'>4400</span> </span><span class="WHIT">            </span><span class="NAME">container.addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-data cwic-conversation cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callsettings.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callsettings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4401</span> 
<span class='line'>4402</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">                </span><span class="NAME">videoDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.videoDirection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">callsettings.remoteVideoWindow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4405</span> </span><span class="WHIT">                    </span><span class="NAME">addWindowToCall</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4406</span> </span><span class="WHIT">                        </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">                        </span><span class="NAME">remoteVideoWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.remoteVideoWindow</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4409</span> 
<span class='line'>4410</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">callsettings.remoteVideoWindow.windowhandle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">                        </span><span class="NAME">windowhandle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.remoteVideoWindow.windowhandle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4415</span> </span><span class="WHIT">                </span><span class="NAME">videoDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4416</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4417</span> 
<span class='line'>4418</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">answerObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">                </span><span class="NAME">videoDirection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">videoDirection</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4422</span> 
<span class='line'>4423</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">windowhandle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">                </span><span class="NAME">answerObject.windowhandle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">windowhandle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4426</span> 
<span class='line'>4427</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'answer'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">answerObject</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4428</span> 
<span class='line'>4429</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">            </span><span class="COMM">// start an outgoing conversation</span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.participant</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4432</span> 
<span class='line'>4433</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">                </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">recipient</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4436</span> 
<span class='line'>4437</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">participant.recipient</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callsettings.error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot start conversation: undefined or empty recipient'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4439</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4440</span> 
<span class='line'>4441</span> </span><span class="WHIT">            </span><span class="NAME">container.addClass</span><span class="PUNC">(</span><span class="STRN">'cwic-data cwic-conversation cwic-conversation-outgoing'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">participant</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4442</span> 
<span class='line'>4443</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.is</span><span class="PUNC">(</span><span class="STRN">':hidden'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4444</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'startConversation - warning: container is hidden'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4445</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4446</span> 
<span class='line'>4447</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originateObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4448</span> </span><span class="WHIT">                </span><span class="NAME">recipient</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">participant.recipient</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4449</span> </span><span class="WHIT">                </span><span class="NAME">videoDirection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.videoDirection</span><span class="WHIT">
<span class='line'>4450</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4451</span> 
<span class='line'>4452</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">callsettings.remoteVideoWindow</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">callsettings.remoteVideoWindow.windowhandle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">                </span><span class="NAME">originateObject.windowhandle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.remoteVideoWindow.windowhandle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4455</span> 
<span class='line'>4456</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'originate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originateObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4457</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">originateCb</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">res.callId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">res.callId</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">callsettings.remoteVideoWindow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">                            </span><span class="NAME">callsettings.window</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">callsettings.window</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4461</span> 
<span class='line'>4462</span> </span><span class="WHIT">                            </span><span class="NAME">addWindowToCall</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4463</span> </span><span class="WHIT">                                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">res.callId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">                                </span><span class="NAME">remoteVideoWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.remoteVideoWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">                                </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">callsettings.window</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4467</span> 
<span class='line'>4468</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4470</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4471</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4472</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">                        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'originate error'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot start conversation'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4479</span> 
<span class='line'>4480</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4482</span> 
<span class='line'>4483</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4484</span>     * @description Ends a conversation. Triggers a conversationEnd event.
<span class='line'>4485</span>     * @param {boolean} iDivert If true, redirects the call to voice mail. See UCM documentation on the Immediate Divert (iDivert) feature for details. The call can be iDiverted only if {@link call#capabilities} contains 'canImmediateDivert',
<span class='line'>4486</span>     * @param {String|Object} id A conversation identifier (String) or an Object containing an id property.
<span class='line'>4487</span>     * @example
<span class='line'>4488</span>     *  // typeof input is string
<span class='line'>4489</span>     * jQuery('#phone').cwic('endConversation', '1234');
<span class='line'>4490</span>     *  // or
<span class='line'>4491</span>     * jQuery('#phone').cwic('endConversation', conversation.id);
<span class='line'>4492</span>     *  // typeof input is object
<span class='line'>4493</span>     * jQuery('#phone').cwic('endConversation', conversation);
<span class='line'>4494</span>     *  // let cwic find the conversation data attached to #conversation
<span class='line'>4495</span>     * jQuery('#conversation').cwic('endConversation');
<span class='line'>4496</span>     *  // iDivert the conversation
<span class='line'>4497</span>     * jQuery('#myconversation').cwic('endConversation', true);
<span class='line'>4498</span>     *  // iDivert and specify conversation id as a string
<span class='line'>4499</span>     * jQuery('#phone').cwic('endConversation', true, '1234');
<span class='line'>4500</span>     *
<span class='line'>4501</span>     *
<span class='line'>4502</span>     */</span><span class="WHIT">
<span class='line'>4503</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">endConversation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4504</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'endConversation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4505</span> 
<span class='line'>4506</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4507</span> 
<span class='line'>4508</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$this.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4509</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4510</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4511</span> 
<span class='line'>4512</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iDivert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4515</span> 
<span class='line'>4516</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4517</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4518</span> 
<span class='line'>4519</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4520</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot end conversation: no conversation exists for this element'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4522</span> 
<span class='line'>4523</span> </span><span class="WHIT">            </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4524</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4525</span> </span><span class="WHIT">            </span><span class="NAME">iDivert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">            </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4528</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">            </span><span class="NAME">iDivert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4531</span> </span><span class="WHIT">            </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4532</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4533</span> 
<span class='line'>4534</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4535</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot end conversation: undefined or empty conversation id'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4538</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transferCallGlobals.callId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">            </span><span class="NAME">transferCallGlobals.endTransfer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4541</span> 
<span class='line'>4542</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">iDivert</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">            </span><span class="COMM">// need to check capabilities first</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4545</span> 
<span class='line'>4546</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4547</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot iDivert - undefined conversation'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4548</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4549</span> 
<span class='line'>4550</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversation.capabilities</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">conversation.capabilities.canImmediateDivert</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.CapabilityMissing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot iDivert - missing capability'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4553</span> 
<span class='line'>4554</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'iDivert conversation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'iDivert'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT">
<span class='line'>4558</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4560</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'end conversation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4561</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4562</span> </span><span class="WHIT">            </span><span class="NAME">regGlobals.endingCallForId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4563</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4564</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'endCall'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4565</span> </span><span class="WHIT">                </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT">
<span class='line'>4566</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4567</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4568</span> 
<span class='line'>4569</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4571</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4572</span>     * @description Updates an existing conversation.&lt;br>
<span class='line'>4573</span>     * This function controls the call allowing the following operations&lt;ul>
<span class='line'>4574</span>     * &lt;li>hold call&lt;/li>
<span class='line'>4575</span>     * &lt;li>resume call&lt;/li>
<span class='line'>4576</span>     * &lt;li>mute call&lt;/li>
<span class='line'>4577</span>     * &lt;li>unmute call&lt;/li>
<span class='line'>4578</span>     * &lt;li>mute audio only&lt;/li>
<span class='line'>4579</span>     * &lt;li>mute video only&lt;/li>
<span class='line'>4580</span>     * &lt;li>unmute audio only&lt;/li>
<span class='line'>4581</span>     * &lt;li>unmute video only&lt;/li>
<span class='line'>4582</span>     * &lt;li>add video window for remote sender&lt;/li>
<span class='line'>4583</span>     * &lt;li>remove video window for remote sender&lt;/li>
<span class='line'>4584</span>     * &lt;li>update video preference on a call video escalate/de-escalate&lt;/li>
<span class='line'>4585</span>     * &lt;li>conference two calls together&lt;/li>
<span class='line'>4586</span>     * &lt;li>transfer a call&lt;/li>
<span class='line'>4587</span>     * &lt;/ul>
<span class='line'>4588</span>     * Transfer call flow:
<span class='line'>4589</span>     * &lt;ol>
<span class='line'>4590</span>     * &lt;li>establish a conversation between clients A and B.&lt;/li>
<span class='line'>4591</span>     * &lt;li>call "transferCall" API to transfer a conversation to the number of client C. A conversation between clients A and C is established.
<span class='line'>4592</span>     * &lt;li>Now, client A have an option to complete an ongoing call transfer. If the call transfer is completed, 
<span class='line'>4593</span>     * conversation between clients B and C is established and client A is put out from both conversations. To cancel call transfer, endConversation should be called.&lt;/li>
<span class='line'>4594</span>     * &lt;/ol>
<span class='line'>4595</span>     * There are two ways to implement the final step of call transfer flow. The first one is to pass a "complete" button, 
<span class='line'>4596</span>     * either its id or jQuery object, to the "transferCall" API and library will automatically attach/detach handler and enable/disable the button when it's appropriate.
<span class='line'>4597</span>     * If more specific behavior is desired comparing to this higher level API, then 'callTransferInProgress.cwic' event could be implemented, see {@link $.fn.cwic#event:callTransferInProgress}
<span class='line'>4598</span>     * @param {String|Object} update Update a started conversation. update can be: &lt;br>
<span class='line'>4599</span>     * A String: hold, resume, mute, unmute, muteAudio, muteVideo, unmuteAudio, unmuteVideo.&lt;br>
<span class='line'>4600</span>     * An Object: contains one or more writable conversation properties to update e.g. videoDirection.&lt;br>
<span class='line'>4601</span>     * Triggers a conversationUpdate event.
<span class='line'>4602</span>     * @param {String|Object} id A conversation identifier (String) or Object containing an id property &lt;br>
<span class='line'>4603</span>     * @example
<span class='line'>4604</span>     * // typeof input is string HOLD/RESUME
<span class='line'>4605</span>     * jQuery('#phone').cwic('updateConversation', 'hold', '1234')
<span class='line'>4606</span>     * jQuery('body').cwic('updateConversation', 'hold', conversation.id);
<span class='line'>4607</span>     * jQuery('#myid').cwic('updateConversation', 'hold', conversation);
<span class='line'>4608</span>     *   // typeof input is object
<span class='line'>4609</span>     * jQuery('#conversation').cwic('updateConversation', 'hold');
<span class='line'>4610</span>     *   // resume the same conversation,
<span class='line'>4611</span>     *   // let cwic find the conversation data attached to #conversation
<span class='line'>4612</span>     * jQuery('#conversation').cwic('updateConversation', 'resume');
<span class='line'>4613</span>     *   // MUTE/UNMUTE
<span class='line'>4614</span>     *   // typeof input is string
<span class='line'>4615</span>     * jQuery('#phone').cwic('updateConversation', 'mute', '1234');
<span class='line'>4616</span>     * jQuery('body').cwic('updateConversation', 'mute', conversation.id);
<span class='line'>4617</span>     * jQuery('#myid').cwic('updateConversation', 'mute', conversation);
<span class='line'>4618</span>     *   // typeof input is object &lt;br>
<span class='line'>4619</span>     * jQuery('#conversation').cwic('updateConversation', 'mute');
<span class='line'>4620</span>     *   // unmute the same conversation,
<span class='line'>4621</span>     *   // let cwic find the conversation data attached to #conversation
<span class='line'>4622</span>     * jQuery('#conversation').cwic('updateConversation', 'unmute');
<span class='line'>4623</span>     *
<span class='line'>4624</span>     *  // add/remove video object in this (default) DOMWindow
<span class='line'>4625</span>     * jQuery('#conversation').cwic('updateConversation',
<span class='line'>4626</span>     *               { 'addRemoteVideoWindow':videoObject });
<span class='line'>4627</span>     * jQuery('#conversation').cwic('updateConversation',
<span class='line'>4628</span>     *               { 'removeRemoteVideoWindow':videoObject });
<span class='line'>4629</span>     * // add/remove video object from another DOMWindow
<span class='line'>4630</span>     * jQuery('#conversation').cwic('updateConversation',
<span class='line'>4631</span>     *               { 'addRemoteVideoWindow':videoObject, window:popupWindow });
<span class='line'>4632</span>     * jQuery('#conversation').cwic('updateConversation',
<span class='line'>4633</span>     *               { 'removeRemoteVideoWindow':videoObject, window:popupWindow });
<span class='line'>4634</span>     *
<span class='line'>4635</span>     * // Escalate to video
<span class='line'>4636</span>     * jQuery('#conversation').cwic('updateConversation', {'videoDirection': 'SendRecv'}); // implied source call is call associated with conversation div
<span class='line'>4637</span>     * jQuery('#phone').cwic('updateConversation', {'videoDirection': 'SendRecv'}, conversation.id}); // source call id passed
<span class='line'>4638</span>     * jQuery('#phone').cwic('updateConversation', {'videoDirection': 'SendRecv'}, conversation}); // source call passed
<span class='line'>4639</span>     * // De-escalate from video
<span class='line'>4640</span>     * jQuery('#conversation').cwic('updateConversation', {'videoDirection': 'Inactive'}); // implied source call is call associated with conversation div
<span class='line'>4641</span>     * jQuery('#phone').cwic('updateConversation', {'videoDirection': 'Inactive'}, conversation.id}); // source call id passed
<span class='line'>4642</span>     * jQuery('#phone').cwic('updateConversation', {'videoDirection': 'Inactive'}, conversation}); // source call passed
<span class='line'>4643</span>     *
<span class='line'>4644</span>     * // Transfer call to target number
<span class='line'>4645</span>     * jQuery('#conversation').cwic('updateConversation', {'transferCall': number, completeButton: 'completebtn'}); // implied source call is call associated with conversation div
<span class='line'>4646</span>     * jQuery('#phone').cwic('updateConversation', {'transferCall': number}, conversation.id}); // source call id passed. Bind to {@link $.fn.cwic#event:callTransferInProgress} to handle transfer complete
<span class='line'>4647</span>     * jQuery('#phone').cwic('updateConversation', {'transferCall': number}, conversation}); // source call passed
<span class='line'>4648</span>     *
<span class='line'>4649</span>     * // Join target callId to source call
<span class='line'>4650</span>     * jQuery('#conversation').cwic('updateConversation', {'joinCall':callId}); // implied source call is call associated with conversation div
<span class='line'>4651</span>     * jQuery('#phone').cwic('updateConversation', {'joinCall':callId}, conversation.id}); // source call id passed
<span class='line'>4652</span>     * jQuery('#phone').cwic('updateConversation', {'joinCall':callId}, conversation}); // source call passed
<span class='line'>4653</span>     */</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">updateConversation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'updateConversation'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4656</span> 
<span class='line'>4657</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4658</span> 
<span class='line'>4659</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$this.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4660</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4662</span> 
<span class='line'>4663</span> </span><span class="WHIT">        </span><span class="COMM">// mandatory first argument</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4665</span> 
<span class='line'>4666</span> </span><span class="WHIT">        </span><span class="COMM">// find conversation information</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4669</span> 
<span class='line'>4670</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">            </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4674</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// attached conversation object</span><span class="WHIT">
<span class='line'>4675</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4676</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4677</span> </span><span class="WHIT">            </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4678</span> </span><span class="WHIT">            </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.cwic-conversation-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4679</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4680</span> 
<span class='line'>4681</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">conversation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4682</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cannot update conversation: undefined or empty conversation id'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4683</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4684</span> 
<span class='line'>4685</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4686</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4687</span> 
<span class='line'>4688</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^hold$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'hold'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^resume$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'resume'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4693</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^mute$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4695</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4696</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^unmute$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4698</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unmute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4699</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4700</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^muteAudio$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4701</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4702</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">muteAudio</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4703</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^muteVideo$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4704</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4705</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">muteVideo</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4706</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^unmuteAudio$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unmute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4708</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unmuteAudio</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4709</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.match</span><span class="PUNC">(</span><span class="REGX">/^unmuteVideo$/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4710</span> </span><span class="WHIT">                </span><span class="NAME">request</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'unmute'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4711</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unmuteVideo</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4712</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4713</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (update conversation) - '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4714</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4715</span> 
<span class='line'>4716</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">                </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">                    </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4722</span> 
<span class='line'>4723</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4725</span> 
<span class='line'>4726</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.transferCall</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transferCallGlobals.inProgress</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Call transfer already in progress, canceling...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">                </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">                </span><span class="NAME">transferCallGlobals.completeBtn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">update.completeButton</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4735</span> </span><span class="WHIT">                </span><span class="NAME">transferCallGlobals.inProgress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'transferCall'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="WHIT">                    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4739</span> </span><span class="WHIT">                        </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4740</span> </span><span class="WHIT">                        </span><span class="NAME">transferToNumber</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.transferCall</span><span class="WHIT">
<span class='line'>4741</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4742</span> </span><span class="WHIT">                    </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4743</span> </span><span class="WHIT">                    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'transferCall'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4748</span> 
<span class='line'>4749</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.joinCall</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4750</span> </span><span class="WHIT">                </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4751</span> 
<span class='line'>4752</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'joinCalls'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4753</span> </span><span class="WHIT">                    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="WHIT">                        </span><span class="NAME">joinCallId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="WHIT">                        </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.joinCall</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">                    </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">                    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'joinCall'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4763</span> 
<span class='line'>4764</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.videoDirection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4765</span> </span><span class="WHIT">                </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setVideoDirection'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">                    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4768</span> </span><span class="WHIT">                        </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4769</span> </span><span class="WHIT">                        </span><span class="NAME">videoDirection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.videoDirection</span><span class="WHIT">
<span class='line'>4770</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4771</span> </span><span class="WHIT">                    </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">                    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">errorCb</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">                        </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getError</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'NativePluginError'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'videoDirection'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4775</span> </span><span class="WHIT">                </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4777</span> 
<span class='line'>4778</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.addRemoteVideoWindow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">                </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4780</span> 
<span class='line'>4781</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'updateConversation() calling addWindowToCall() for conversationId: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4782</span> 
<span class='line'>4783</span> </span><span class="WHIT">                </span><span class="NAME">addWindowToCall</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4784</span> </span><span class="WHIT">                    </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4785</span> </span><span class="WHIT">                    </span><span class="NAME">remoteVideoWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.addRemoteVideoWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4786</span> </span><span class="WHIT">                    </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.window</span><span class="WHIT">
<span class='line'>4787</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4789</span> 
<span class='line'>4790</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">update.removeRemoteVideoWindow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4791</span> </span><span class="WHIT">                </span><span class="NAME">foundWritable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4792</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'updateConversation() calling removeWindowFromCall() for conversationId: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4793</span> 
<span class='line'>4794</span> </span><span class="WHIT">                </span><span class="NAME">removeWindowFromCall</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">                    </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">                    </span><span class="NAME">remoteVideoWindow</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">update.removeRemoteVideoWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">                    </span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">update.window</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">                    </span><span class="NAME">endCall</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4801</span> 
<span class='line'>4802</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">foundWritable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">                </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (update conversation)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4804</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4805</span> 
<span class='line'>4806</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4807</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (update conversation)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4809</span> 
<span class='line'>4810</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4811</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4812</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4814</span>     * Sends digit (String) as Dual-Tone Multi-Frequency (DTMF)
<span class='line'>4815</span>     * @example
<span class='line'>4816</span>     *  // SEND DTMF EXAMPLE
<span class='line'>4817</span>     * jQuery('#phone').cwic('sendDTMF', '5', '1234');
<span class='line'>4818</span>     * jQuery('#mydiv').cwic('sendDTMF', '3', conversation.id);
<span class='line'>4819</span>     * jQuery('body').cwic('sendDTMF', '7', conversation);
<span class='line'>4820</span>     * jQuery('#conversation').cwic('sendDTMF', '1');
<span class='line'>4821</span>     * @param {String} digit Dual-Tone Multi-Frequency (DTMF) digit to send.  Does not trigger any event.
<span class='line'>4822</span>     * @param {String|Object} [id] a {String} conversation identifier or an {Object} containing an id property
<span class='line'>4823</span>     */</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">sendDTMF</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sendDTMF'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// don't send dtmf digits to logger</span><span class="WHIT">
<span class='line'>4826</span> 
<span class='line'>4827</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4830</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allowedDigits</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'1'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'2'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'3'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'4'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'5'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'6'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'7'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'8'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'9'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'A'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'B'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'D'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'a'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'b'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'c'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'d'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4832</span> 
<span class='line'>4833</span> </span><span class="WHIT">        </span><span class="COMM">// inspect arguments</span><span class="WHIT">
<span class='line'>4834</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4835</span> </span><span class="WHIT">            </span><span class="NAME">digit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4836</span> 
<span class='line'>4837</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">                    </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">                    </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">                    </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4847</span> 
<span class='line'>4848</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">digit</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (sendDTMF)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4851</span> 
<span class='line'>4852</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">allowedDigits.indexOf</span><span class="PUNC">(</span><span class="NAME">digit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'invalid DTMF digit (sendDTMF)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4855</span> 
<span class='line'>4856</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'sendDTMF'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">            </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">            </span><span class="NAME">digit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">digit</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4860</span> 
<span class='line'>4861</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4863</span> 
<span class='line'>4864</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getInstanceId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getInstanceId'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_plugin.instanceId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4868</span> 
<span class='line'>4869</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4870</span>     * Gets a list of objects describing the multimedia devices installed on a system.
<span class='line'>4871</span>     * @since 3.0.0
<span class='line'>4872</span>     * @returns
<span class='line'>4873</span>     * a list of objects describing the multimedia devices with the following properties:&lt;ul>
<span class='line'>4874</span>     *   &lt;li>deviceID: unique device ID&lt;/li>
<span class='line'>4875</span>     *   &lt;li>deviceName: {string} human readable device name&lt;/li>
<span class='line'>4876</span>     *   &lt;li>vendorID: {string} unique vendor ID&lt;/li>
<span class='line'>4877</span>     *   &lt;li>productID: {string} vendor product ID&lt;/li>
<span class='line'>4878</span>     *   &lt;li>hardwareID: {string} hardware dependent ID&lt;/li>
<span class='line'>4879</span>     *   &lt;li>canRecord: {boolean} indicates whether this object can be used as an audio recording device&lt;/li>
<span class='line'>4880</span>     *   &lt;li>canPlayout: {boolean} indicates whether this object can be used as an audio playout device&lt;/li>
<span class='line'>4881</span>     *   &lt;li>canCapture: {boolean} indicates whether this object can be used as a video capture device&lt;/li>
<span class='line'>4882</span>     *   &lt;li>canRing: {boolean} indicates whether this object can be used as a ringer device&lt;/li>
<span class='line'>4883</span>     *   &lt;li>isDefault:  {boolean} indicates whether this object represents the default device of the type indicated by the canRecord, canPlayout, and canCapture flags&lt;/li>
<span class='line'>4884</span>     *   &lt;li>recordingName: {string} human readable name for the audio recording function of this device&lt;/li>
<span class='line'>4885</span>     *   &lt;li>playoutName: {string} human readable name for the audio playout function of this device&lt;/li>
<span class='line'>4886</span>     *   &lt;li>captureName: {string} human readable name for the video capture function of this device&lt;/li>
<span class='line'>4887</span>     *   &lt;li>recordingID: {string} ID for the audio recording function of this device&lt;/li>
<span class='line'>4888</span>     *   &lt;li>playoutID: {string} ID for the audio playout function of this device&lt;/li>
<span class='line'>4889</span>     *   &lt;li>captureID: {string} ID for the video capture function of this device&lt;/li>
<span class='line'>4890</span>     *   &lt;li>clientRecordingID: {string} the ID to pass to setRecordingDevice to select this device as the audio recording device&lt;/li>
<span class='line'>4891</span>     *   &lt;li>clientPlayoutID: {string} the ID to pass to setPlayoutDevice to select this device as the audio playout device&lt;/li>
<span class='line'>4892</span>     *   &lt;li>clientCaptureID: {string} the ID to pass to setCaptureDevice to select this device as the video capture device&lt;/li>
<span class='line'>4893</span>     *   &lt;li>isSelectedRecordingDevice: {boolean} indicates whether this is the currently selected audio recording device&lt;/li>
<span class='line'>4894</span>     *   &lt;li>isSelectedPlayoutDevice: {boolean} indicates whether this is the currently selected audio playout device&lt;/li>
<span class='line'>4895</span>     *   &lt;li>isSelectedCaptureDevice: {boolean} indicates whether this is the currently selected video capture device&lt;/li>
<span class='line'>4896</span>     *   &lt;/ul>
<span class='line'>4897</span>     *   In order to use the list, the client should check the canXXXX fields to determine if a device can be passed as a particular function, then pass the clientXXXID
<span class='line'>4898</span>     *   to the correct setXXXXDevice function.
<span class='line'>4899</span>     *
<span class='line'>4900</span>     *   Depending on the platform, devices with multiple functions may show up as a single entry with multiple IDs, or multiple times with similar or different IDs.
<span class='line'>4901</span>     *
<span class='line'>4902</span>     * @example
<span class='line'>4903</span>     *  see sample.html
<span class='line'>4904</span>     */</span><span class="WHIT">
<span class='line'>4905</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getMultimediaDevices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">        </span><span class="COMM">// new messaging interface passes mmDevices list in the change event</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">        </span><span class="COMM">// so we just return the data from the most recent event</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">devices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">'multimediadevices'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_plugin.multimediadevices</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4909</span> 
<span class='line'>4910</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getMultimediaDevices returning:'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">devices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">devices</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4912</span> 
<span class='line'>4913</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4914</span> 
<span class='line'>4915</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getAvailableRingtones</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4917</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4918</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getAvailableRingtones'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringtones</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">            </span><span class="NAME">handleRingtonesAvailable</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringtones</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4924</span> 
<span class='line'>4925</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">handleRingtonesAvailable</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringtonesList</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.Event</span><span class="PUNC">(</span><span class="STRN">'ringtonesListAvailable.cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">        </span><span class="NAME">event.ringtones</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringtonesList.ringtones</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4928</span> </span><span class="WHIT">        </span><span class="NAME">$this.trigger</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4932</span>     * Sets the audio recording device used by the Cisco Web Communicator.  To set a device, pass the clientRecordingID from a device with the canRecord flag set to true.
<span class='line'>4933</span>     * @since 3.0.0
<span class='line'>4934</span>     * @param {String} clientRecordingID: clientRecordingID retrieved from getMultimediaDevices()
<span class='line'>4935</span>     */</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRecordingDevice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRecordingDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4939</span> 
<span class='line'>4940</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientRecordingIDIn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4941</span> 
<span class='line'>4942</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">clientRecordingIDIn</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">clientRecordingIDIn.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (setRecordingDevice)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4945</span> 
<span class='line'>4946</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setRecordingDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">            </span><span class="STRN">'clientRecordingID'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientRecordingIDIn</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4949</span> 
<span class='line'>4950</span> </span><span class="WHIT">        </span><span class="COMM">// after setting device, we need to refresh our cache</span><span class="WHIT">
<span class='line'>4951</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4952</span> </span><span class="WHIT">            </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4953</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4956</span>      * Sets the ringer device used by the Cisco Web Communicator. To set a device, pass the clientRingerID from a device with the canRing flag set to true.
<span class='line'>4957</span>      * @since 4.0.0
<span class='line'>4958</span>      * @param {String} clientRingerID: clientRingerID retrieved from getMultimediaDevices()
<span class='line'>4959</span>      */</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRingerDevice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4961</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRingerDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4963</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4964</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientRingerIDIn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4965</span> 
<span class='line'>4966</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">clientRingerIDIn</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">clientRingerIDIn.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (setRingerDevice)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4968</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4969</span> 
<span class='line'>4970</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setRingerDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">            </span><span class="STRN">'clientRingerID'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientRingerIDIn</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4973</span> 
<span class='line'>4974</span> </span><span class="WHIT">        </span><span class="COMM">// after setting device, we need to refresh our cache</span><span class="WHIT">
<span class='line'>4975</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">            </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4979</span> 
<span class='line'>4980</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4981</span>      * Sets speaker volume. Works on Windows platform only.
<span class='line'>4982</span>      * @since 4.0.0
<span class='line'>4983</span>      * @param {String|Number} args.volume Volume to set (0 to 100)
<span class='line'>4984</span>      * @param {Function} args.success Success callback
<span class='line'>4985</span>      * @param {Function} args.error Error callback
<span class='line'>4986</span>      */</span><span class="WHIT">
<span class='line'>4987</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setSpeakerVolume</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4988</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4989</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setPlayRingerOnAllDevices works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4990</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4991</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4992</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>4993</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">content.speakerVolume</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4994</span> </span><span class="WHIT">            </span><span class="NAME">success</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="WHIT">            </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4996</span> 
<span class='line'>4997</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setCurrentSpeakerVolume'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4998</span> </span><span class="WHIT">            </span><span class="NAME">volume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">success</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5000</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5001</span> 
<span class='line'>5002</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5003</span>      * Sets ringer volume. Works on Windows platform only.
<span class='line'>5004</span>      * @since 4.0.0
<span class='line'>5005</span>      * @param {String|Number} args.volume Volume to set (0 to 100)
<span class='line'>5006</span>      * @param {Function} args.success Success callback
<span class='line'>5007</span>      * @param {Function} args.error Error callback
<span class='line'>5008</span>      */</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRingerVolume</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRingerVolume works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5012</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">content.ringerVolume</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">            </span><span class="NAME">success</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="WHIT">            </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setCurrentRingerVolume'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="WHIT">            </span><span class="NAME">volume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">success</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5024</span>      * Sets microphone volume. Works on Windows platform only.
<span class='line'>5025</span>      * @since 4.0.0
<span class='line'>5026</span>      * @param {String|Number} args.volume Volume to set (0 to 100)
<span class='line'>5027</span>      * @param {Function} args.success Success callback
<span class='line'>5028</span>      * @param {Function} args.error Error callback
<span class='line'>5029</span>      */</span><span class="WHIT">
<span class='line'>5030</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setMicrophoneVolume</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setMicrophoneVolume works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">content.microphoneVolume</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">            </span><span class="NAME">success</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.success</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.success</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">            </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">content.error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.error</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$.noop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setCurrentMicrophoneVolume'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5040</span> </span><span class="WHIT">            </span><span class="NAME">volume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">volume</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">success</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5042</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5044</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5045</span>      * Sets ringtone. Will trigger ringtoneChange.cwic event. Works on Windows platform only.
<span class='line'>5046</span>      * @since 4.0.0
<span class='line'>5047</span>      * @param {String} ringtone ringtone name
<span class='line'>5048</span>      */</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setRingtone</span><span class="PUNC">(</span><span class="NAME">ringtone</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setRingtone works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setCurrentRingtone'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">            </span><span class="NAME">ringtone</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ringtone</span><span class="WHIT">
<span class='line'>5057</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5059</span> 
<span class='line'>5060</span> </span><span class="WHIT">     </span><span class="COMM">/**
<span class='line'>5061</span>      * Sets all capable devices as ringers. Works on Windows platform only.
<span class='line'>5062</span>      * @since 4.0.0
<span class='line'>5063</span>      */</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setPlayRingerOnAllDevices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setPlayRingerOnAllDevices works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setPlayRingerOnAllDevices'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5072</span> 
<span class='line'>5073</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">     </span><span class="COMM">/**
<span class='line'>5075</span>      * Gets the current volume value for particular device. Async function.
<span class='line'>5076</span>      * Works on Windows platform only.
<span class='line'>5077</span>      * @since 4.0.0
<span class='line'>5078</span>      * @param {String} device Type of device. One of: "Speaker", "Microphone", "Ringer"
<span class='line'>5079</span>      * @param {Function} callback(volume) Callback to be called with volume value
<span class='line'>5080</span>      */</span><span class="WHIT">
<span class='line'>5081</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getMultimediaDeviceVolume</span><span class="PUNC">(</span><span class="NAME">device</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handleVolumeChangeCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5082</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMac</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5083</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getMultimediaDeviceVolume works only on Windows platform for now...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5084</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5087</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">device</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'Speaker'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">            </span><span class="NAME">device</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'Microphone'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5089</span> </span><span class="WHIT">            </span><span class="NAME">device</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'Ringer'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5090</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getMultimediaDeviceVolume received wrong "device" parameter. Must be one of ("Speaker", "Microphone", "Ringer") and received: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">device</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5091</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5092</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5093</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDeviceVolume'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">                </span><span class="NAME">device</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">device</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handleVolumeChangeCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getMultimediaDeviceVolume: Mutimedia services not started, returning...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5104</span>     * Sets the audio playout device used by the Cisco Web Communicator.  To set a device, pass the clientPlayoutID from a device with the canPlayout flag set to true.
<span class='line'>5105</span>     * @since 3.0.0
<span class='line'>5106</span>     * @param {String} clientPlayoutID: clientPlayoutID retrieved from getMultimediaDevices()
<span class='line'>5107</span>     */</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setPlayoutDevice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setPlayoutDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5110</span> 
<span class='line'>5111</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientPlayoutIDIn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5113</span> 
<span class='line'>5114</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">clientPlayoutIDIn</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">clientPlayoutIDIn.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5115</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (setPlayoutDevice)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5117</span> 
<span class='line'>5118</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setPlayoutDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="WHIT">            </span><span class="STRN">'clientPlayoutID'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientPlayoutIDIn</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5121</span> 
<span class='line'>5122</span> </span><span class="WHIT">        </span><span class="COMM">// after setting device, we need to refresh our cache</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">            </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5127</span> 
<span class='line'>5128</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5129</span>     * Sets the video capture device used by the Cisco Web Communicator.  To set a device, pass the clientCaptureID from a device with the canCapture flag set to true.
<span class='line'>5130</span>     * @since 3.0.0
<span class='line'>5131</span>     * @param {String} clientCaptureID: clientCaptureID retrieved from getMultimediaDevices()
<span class='line'>5132</span>     */</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setCaptureDevice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setCaptureDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5135</span> 
<span class='line'>5136</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clientCaptureIDIn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5138</span> 
<span class='line'>5139</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">clientCaptureIDIn</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">clientCaptureIDIn.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (setCaptureDevice)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5142</span> 
<span class='line'>5143</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setCaptureDevice'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">            </span><span class="STRN">'clientCaptureID'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">clientCaptureIDIn</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5146</span> 
<span class='line'>5147</span> </span><span class="WHIT">        </span><span class="COMM">// after setting device, we need to refresh our cache</span><span class="WHIT">
<span class='line'>5148</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getMultimediaDevices'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mmDevicesCb</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5149</span> </span><span class="WHIT">            </span><span class="NAME">_triggerMMDeviceEvent</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5150</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5152</span> 
<span class='line'>5153</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5154</span>     * Shows the call in an external video window.  If an external video window already exists,
<span class='line'>5155</span>     * the current contents will be replaced by the video stream for the selected call.  Otherwise, a new external window will be created.
<span class='line'>5156</span>     * To detect changes in the window state, for example the user closes the window, use {@link $.fn.cwic#event:externalWindowEvent}.
<span class='line'>5157</span>     * &lt;br>
<span class='line'>5158</span>     * By default the external video window will have always on top property and will include a picture-in-picture preview (self-view).
<span class='line'>5159</span>     * This can be changed using {@link $.fn.cwic-setExternalWindowAlwaysOnTop} and {@link $.fn.cwic-setExternalWindowShowSelfViewPip}, respectively.
<span class='line'>5160</span>     * &lt;br>
<span class='line'>5161</span>     * If the user closes an external video window that contains a video call, the call will be ended.
<span class='line'>5162</span>     * Use {@link $.fn.cwic-hideExternalWindow} to remove the window without interupting the call.
<span class='line'>5163</span>     * @since 3.1.0
<span class='line'>5164</span>     * @param {String|Object} [id] A {String} conversation identifier or an {Object} containing an id property.
<span class='line'>5165</span>     */</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showCallInExternalWindow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'showCallInExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5168</span> 
<span class='line'>5169</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$this.data</span><span class="PUNC">(</span><span class="STRN">'cwic'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5172</span> 
<span class='line'>5173</span> </span><span class="WHIT">        </span><span class="COMM">// inspect arguments</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">                </span><span class="NAME">conversation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">                </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conversation.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">                </span><span class="NAME">conversationId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5183</span> 
<span class='line'>5184</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">conversationId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'wrong arguments (showCallInExternalWindow)'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5187</span> 
<span class='line'>5188</span> </span><span class="WHIT">        </span><span class="NAME">dockGlobals.isVideoBeingReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'showCallInExternalWindow'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="WHIT">            </span><span class="NAME">callId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conversationId</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5192</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5193</span> 
<span class='line'>5194</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5195</span>     * Shows preview (self-view) in an external video window.  If an external video window already exists,
<span class='line'>5196</span>     * the current contents will be replaced by the preview.  Otherwise, a new external window will be created.
<span class='line'>5197</span>     * To detect changes in the window state, for example the user closes the window, use {@link $.fn.cwic#event:externalWindowEvent}.
<span class='line'>5198</span>     * &lt;br>
<span class='line'>5199</span>     * By default the external video window will have always on top property.  This can be changed using {@link $.fn.cwic-setExternalWindowAlwaysOnTop}.
<span class='line'>5200</span>     * &lt;br>
<span class='line'>5201</span>     * If preview in picture-in-picture is enabled (see {@link $.fn.cwic-setExternalWindowShowSelfViewPip})
<span class='line'>5202</span>     * it will not be visible while the preview is in the full window.
<span class='line'>5203</span>     * &lt;br>
<span class='line'>5204</span>     * Use {@link $.fn.cwic-hideExternalWindow} to remove the window.
<span class='line'>5205</span>     * @since 3.1.0
<span class='line'>5206</span>     */</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showPreviewInExternalWindow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'showPreviewInExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5210</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.isVideoBeingReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5211</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'showPreviewInExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5212</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5213</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from showPreviewInExternalWindow ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5214</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5215</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5216</span> 
<span class='line'>5217</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5218</span>     * Triggers an {@link $.fn.cwic#event:externalWindowEvent} to be sent to the application with the current state of the external window.
<span class='line'>5219</span>     * @since 3.1.0
<span class='line'>5220</span>     */</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getExternalWindowState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getExternalWindowState'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'getExternalWindowState'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from getExternalWindowState ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5229</span> 
<span class='line'>5230</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5231</span>     * Hides an external video window created by {@link $.fn.cwic-showPreviewInExternalWindow} or {@link $.fn.cwic-showCallInExternalWindow}.
<span class='line'>5232</span>     * @since 3.1.0
<span class='line'>5233</span>     */</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">hideExternalWindow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5236</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'hideExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.isVideoBeingReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'hideExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from hideExternalWindow ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5242</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5243</span> 
<span class='line'>5244</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5245</span>     * Controls whether external video windows created by {@link $.fn.cwic-showPreviewInExternalWindow} or
<span class='line'>5246</span>     * {@link $.fn.cwic-showCallInExternalWindow} are shown always on top (default) or not.
<span class='line'>5247</span>     * @since 3.1.0
<span class='line'>5248</span>     * @param {Boolean} isAlwaysOnTop Set to false to remove the always on top property.  Set to true to restore default behavior.
<span class='line'>5249</span>     */</span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowAlwaysOnTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5251</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5252</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowAlwaysOnTop'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowAlwaysOnTop'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">alwaysOnTop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5255</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5256</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5257</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowAlwaysOnTop ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5260</span> 
<span class='line'>5261</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5262</span>     * Controls whether a picture-in-picture preview (self-view) is shown when {@link $.fn.cwic-showCallInExternalWindow} is used to put a call in external video window.
<span class='line'>5263</span>     * @since 3.1.0
<span class='line'>5264</span>     * @param {Boolean} showPipSelfView Set to false to turn off the picture-in-picture.  Set to true to restore default behavior.
<span class='line'>5265</span>     */</span><span class="WHIT">
<span class='line'>5266</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowSelfViewPip</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5267</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowShowSelfViewPip'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5269</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5270</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowShowSelfViewPip'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">showSelfViewPip</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowShowSelfViewPip ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5274</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5275</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5276</span> 
<span class='line'>5277</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5278</span>     * Controls whether a overlaid controls are shown in external video window created by {@link $.fn.cwic-showCallInExternalWindow} or {@link $.fn.cwic-showPreviewInExternalWindow}.
<span class='line'>5279</span>     * @since 4.0.0
<span class='line'>5280</span>     * @param {Boolean} showControls Set to false to turn off the overlaid call controls. Set to true to restore default behavior.
<span class='line'>5281</span>     */</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowControls</span><span class="PUNC">(</span><span class="NAME">showControls</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowShowControls'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">showControls</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowShowControls'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">showControls</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showControls</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5289</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowShowControls ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5290</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5291</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5292</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5293</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">sendSelfViewCoordinates</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isObject</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5296</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowSelfViewPipPosition expects object as an argument'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5297</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5298</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5300</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage.topLeftX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5301</span> </span><span class="WHIT">            </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage.topLeftY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5302</span> </span><span class="WHIT">            </span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage.bottomRightX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5303</span> </span><span class="WHIT">            </span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage.bottomRightY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5304</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5305</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5306</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5307</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">isNumeric</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5308</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">isNumeric</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5309</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">isNumeric</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5310</span> </span><span class="WHIT">            </span><span class="PUNC">!</span><span class="NAME">isNumeric</span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5312</span> </span><span class="WHIT">                </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowSelfViewPipPosition invalid arguments ... expecting numbers from 0 to 100'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5313</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5315</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5316</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowSelfViewPipPosition'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">pipLeft</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pipTop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pipRight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pipBottom</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">         </span><span class="WHIT">
<span class='line'>5317</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5319</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5320</span>     * Sets the position of self view window relative to parent external video window created by {@link $.fn.cwic-showCallInExternalWindow}.
<span class='line'>5321</span>     * @since 4.0.0
<span class='line'>5322</span>     * @param {Object} coordinatesInPercentage
<span class='line'>5323</span>     * @param {Number|String} coordinatesInPercentage.topLeftX Distance of top-left corner of self view window from the left edge of parent window (in percentage - 0 to 100).
<span class='line'>5324</span>     * @param {Number|String} coordinatesInPercentage.topLeftY Distance of top-left corner of self view window from the top edge of parent window (in percentage - 0 to 100).
<span class='line'>5325</span>     * @param {Number|String} coordinatesInPercentage.bottomRightX Distance of bottom-right corner of self view window from the left edge of parent window (in percentage - 0 to 100).
<span class='line'>5326</span>     * @param {Number|String} coordinatesInPercentage.bottomRightY Distance of bottom-right corner of self view window from the top edge of parent window (in percentage - 0 to 100).
<span class='line'>5327</span>     */</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowSelfViewPipPosition</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5330</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowSelfViewPipPosition'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5331</span> </span><span class="WHIT">            </span><span class="NAME">sendSelfViewCoordinates</span><span class="PUNC">(</span><span class="NAME">coordinatesInPercentage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5332</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5333</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5334</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowShowControls ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5336</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5339</span>      * Show/hide the border of self view in external video window created by {@link $.fn.cwic-showCallInExternalWindow}.
<span class='line'>5340</span>      * @since 11.0.1
<span class='line'>5341</span>      * @param {Boolean} showSelfViewPipBorder
<span class='line'>5342</span>      */</span><span class="WHIT">
<span class='line'>5343</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowSelfViewPipBorder</span><span class="PUNC">(</span><span class="NAME">showSelfViewPipBorder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5344</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5345</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowShowSelfViewPipBorder'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5346</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5347</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">showSelfViewPipBorder</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowShowSelfViewPipBorder'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">showSelfViewPipBorder</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showSelfViewPipBorder</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5349</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5350</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5351</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5352</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowShowSelfViewPipBorder ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5354</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5357</span>     * Sets the window title used in external video windows created by {@link $.fn.cwic-showPreviewInExternalWindow} or {@link $.fn.cwic-showCallInExternalWindow}.
<span class='line'>5358</span>     * @since 3.1.0
<span class='line'>5359</span>     * @param {String} title A string value to be used as the window title for the exernal video window.
<span class='line'>5360</span>     */</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setExternalWindowTitle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isMultimediaStarted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setExternalWindowTitle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">                </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'setExternalWindowTitle'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">title</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'returning from setExternalWindowTitle ... not supported in the current state'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5371</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5372</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dockGlobals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5373</span> </span><span class="WHIT">        </span><span class="NAME">_about</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5374</span> </span><span class="WHIT">        </span><span class="NAME">hasDockingCapabilities</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5375</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dockGlobals._about.capabilities.externalWindowDocking</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5376</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5377</span> </span><span class="WHIT">        </span><span class="NAME">isVideoBeingReceived</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5378</span> </span><span class="WHIT">        </span><span class="NAME">isDocked</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5379</span> </span><span class="WHIT">        </span><span class="NAME">timeOfPreviousDocking</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5380</span> </span><span class="WHIT">        </span><span class="NAME">minimalTimeBeforeChangingPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="COMM">/* TODO: find optimal value to avoid lag, but also to avoid too many dockUpdate messges */</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5381</span> </span><span class="WHIT">        </span><span class="NAME">targetDiv</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5382</span> </span><span class="WHIT">        </span><span class="NAME">targetDivStyle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="WHIT">            </span><span class="STRN">'background-color'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'magenta'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="WHIT">            </span><span class="STRN">'width'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'8px'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5385</span> </span><span class="WHIT">            </span><span class="STRN">'height'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'8px'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">            </span><span class="STRN">'position'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'fixed'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">            </span><span class="STRN">'border-right'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'8px solid black'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">            </span><span class="STRN">'z-index'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'2147483647'</span><span class="WHIT">
<span class='line'>5389</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5390</span> </span><span class="WHIT">        </span><span class="NAME">frame</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="WHIT">        </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="WHIT">        </span><span class="NAME">position</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="WHIT">        </span><span class="NAME">move</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5394</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockGlobals.isDocked</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5395</span> </span><span class="WHIT">                </span><span class="COMM">// (new Date()).getTime() returns the current time in milliseconds</span><span class="WHIT">
<span class='line'>5396</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">millisecondsSinceLastMove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dockGlobals.timeOfPreviousDocking</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.updateOffsets</span><span class="PUNC">(</span><span class="NAME">dockGlobals.element.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5398</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dockedWindowMoved</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rect.top</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5399</span> </span><span class="WHIT">                        </span><span class="NAME">rect.left</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5400</span> </span><span class="WHIT">                        </span><span class="NAME">rect.height</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.height</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5401</span> </span><span class="WHIT">                        </span><span class="NAME">rect.width</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.width</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5402</span> </span><span class="WHIT">                        </span><span class="NAME">rect.cropTop</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.cropTop</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5403</span> </span><span class="WHIT">                        </span><span class="NAME">rect.cropLeft</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5404</span> </span><span class="WHIT">                        </span><span class="NAME">rect.cropHeight</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.cropHeight</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5405</span> </span><span class="WHIT">                        </span><span class="NAME">rect.cropWidth</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position.cropWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>5406</span> </span><span class="WHIT">                            </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockedWindowMoved</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">millisecondsSinceLastMove</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">dockGlobals.minimalTimeBeforeChangingPosition</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">                    </span><span class="NAME">dockGlobals.timeOfPreviousDocking</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">                    </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="NAME">dockGlobals.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rect</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">                    </span><span class="NAME">dockGlobals.sendMessageToAddOn</span><span class="PUNC">(</span><span class="STRN">"dockUpdate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dockGlobals.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">                </span><span class="NAME">dockGlobals.frame.requestAnimationFrame</span><span class="PUNC">(</span><span class="NAME">dockGlobals.move</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5417</span> </span><span class="WHIT">        </span><span class="NAME">updateOffsets</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">positionWithinInnermostFrame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5418</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5419</span> </span><span class="WHIT">                </span><span class="NAME">currentFrameHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="WHIT">                </span><span class="NAME">currentFrameWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="WHIT">                </span><span class="NAME">currentFrameRect</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">                </span><span class="NAME">parentFrameWidth</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="WHIT">                </span><span class="NAME">parentFrameHeight</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="WHIT">                </span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5425</span> </span><span class="WHIT">                        </span><span class="NAME">cropTop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5426</span> </span><span class="WHIT">                        </span><span class="NAME">cropLeft</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5427</span> </span><span class="WHIT">                        </span><span class="NAME">cropBottom</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5428</span> </span><span class="WHIT">                        </span><span class="NAME">cropRight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5429</span> </span><span class="WHIT">                        </span><span class="NAME">cropWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5430</span> </span><span class="WHIT">                        </span><span class="NAME">cropHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">positionWithinInnermostFrame</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5432</span> </span><span class="WHIT">                </span><span class="NAME">frameBorderOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5433</span> </span><span class="WHIT">                </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5434</span> </span><span class="WHIT">                </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5435</span> </span><span class="WHIT">                </span><span class="NAME">paddingTopOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5436</span> </span><span class="WHIT">                </span><span class="NAME">paddingLeftOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="WHIT">           </span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">            </span><span class="COMM">// we need to take into account the devicePixelRatio and the CSS zoom property</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="WHIT">            </span><span class="COMM">// it won't work if css zoom is set on some of parent elements</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.devicePixelRatio</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'zoom'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5441</span> 
<span class='line'>5442</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="STRN">'ontouchstart'</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="NAME">navigator.maxTouchPoints</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5448</span> </span><span class="WHIT">                 </span><span class="COMM">//running on touch-capable device</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">              </span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.innerWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasScrollbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">currentFrame.document.documentElement.clientWidth</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">               </span><span class="NAME">dockGlobals.lastZoomFactor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.lastZoomFactor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">               </span><span class="COMM">// scrollbar width changes when zooming, we need to calculate it for each scale level</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">               </span><span class="COMM">// on pinch zoom, hasScrollbar very quickly goes below zero, and we should skip that case (no scrollbars on pinch-zoom)</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">               </span><span class="COMM">// ...basically just an aproximation which works currentlly </span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hasScrollbar</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">                   </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hasScrollbar</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">                   </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scrollBarWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dockGlobals.lastZoomFactor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pinchZoomCoefficient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.document.documentElement.clientWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">               </span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pinchZoomCoefficient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">               </span><span class="NAME">dockGlobals.lastZoomFactor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollSizeX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame.document</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollSizeY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame.document</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pinchZoomCoefficient</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1.01</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">                   </span><span class="NAME">scrollX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.scrollX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">                   </span><span class="NAME">scrollY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.scrollY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">                   </span><span class="COMM">// this is complex logic dealing with case when the page (pinchZoom=0) has scrollbars</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">                   </span><span class="COMM">// In that case, when the page is pinche-zoomed, scrollX and scrollY are no longer accurate in providing position of docking container </span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diffY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollSizeY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">                   </span><span class="COMM">// while diff is >0, position.top represent accurate top position</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">                   </span><span class="COMM">// when it goes below 0 (meaning that "original" scrollbar hit the end), position.top gets stuck and then diff value represent how much container is moved</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diffY</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">                       </span><span class="NAME">scrollY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="WHIT">                       </span><span class="NAME">scrollY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">diffY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5487</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diffX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollSizeX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5488</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5489</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diffX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5490</span> </span><span class="WHIT">                       </span><span class="NAME">scrollX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5491</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5492</span> </span><span class="WHIT">                       </span><span class="NAME">scrollX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">diffX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5493</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5495</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diffY</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5496</span> </span><span class="WHIT">                       </span><span class="NAME">dockGlobals.initPosY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">currentFrame.scrollY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">                       </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">dockGlobals.initPosY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollSizeY</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5501</span> </span><span class="WHIT">                       </span><span class="NAME">diffY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">                       </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">                       </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.initPosY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollSizeY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5505</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5506</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">diffX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5507</span> </span><span class="WHIT">                       </span><span class="NAME">dockGlobals.initPosX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">currentFrame.scrollX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="WHIT">                   </span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">                       </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">dockGlobals.initPosX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollSizeX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">                       </span><span class="NAME">diffX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>5513</span> </span><span class="WHIT">                       </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">                       </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.initPosX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">scrollSizeX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>5518</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">            </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">            </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5522</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE TOP: ', position.top);</span><span class="WHIT">
<span class='line'>5524</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE SCROLL: ', scrollY);</span><span class="WHIT">
<span class='line'>5525</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE SCROLL ACTUAL: ', window.scrollY);</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE SCROLL SIZE: ', scrollSizeY);</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE SCROLL DIFF: ', diffY);</span><span class="WHIT">
<span class='line'>5528</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE NORMAL: ', scaleCoefficient);</span><span class="WHIT">
<span class='line'>5529</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE PINCH: ', pinchZoomCoefficient);</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">            </span><span class="COMM">// console.log('SCALE INIT POS: ', dockGlobals.initPos);</span><span class="WHIT">
<span class='line'>5531</span> 
<span class='line'>5532</span> </span><span class="WHIT">            </span><span class="COMM">// calculating crop values for innermost iframe</span><span class="WHIT">
<span class='line'>5533</span> </span><span class="WHIT">            </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">                </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5536</span> </span><span class="WHIT">            </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">                </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5538</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5539</span> </span><span class="WHIT">            </span><span class="NAME">position.cropBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">position.bottom</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">currentFrameHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">            </span><span class="NAME">position.cropRight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">position.right</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">currentFrameWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5541</span> 
<span class='line'>5542</span> </span><span class="WHIT">            </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrame</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">currentFrame.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">                </span><span class="NAME">currentFrameRect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.frameElement.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">                </span><span class="NAME">parentFrameWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame.parent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">                </span><span class="NAME">parentFrameHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">currentFrame.parent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5546</span> 
<span class='line'>5547</span> </span><span class="WHIT">                </span><span class="COMM">// !! converts to boolean: 0 and NaN map to false, the rest of the numbers map to true  </span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.frameBorder</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">                        </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.frameBorder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">                    </span><span class="COMM">// after testing on Chrome, whenever a frameBorder is present, it's size is 2px</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">                    </span><span class="NAME">frameBorderOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">                    </span><span class="NAME">frameBorderOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5555</span> 
<span class='line'>5556</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.borderTopWidth</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">                    </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frameBorderOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5558</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">                    </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.borderTopWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5561</span> </span><span class="WHIT">                </span><span class="NAME">paddingTopOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.paddingTop</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5562</span> 
<span class='line'>5563</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrameRect.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">                        </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingTopOffset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">                        </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingTopOffset</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5570</span> 
<span class='line'>5571</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrameRect.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.height</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">position.cropBottom</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">parentFrameHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5572</span> </span><span class="WHIT">                    </span><span class="NAME">position.cropBottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrameRect.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.height</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parentFrameHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">                </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrameRect.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderTopOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingTopOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.borderLeftWidth</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="WHIT">                    </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frameBorderOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5578</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">                    </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.borderLeftWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="WHIT">                </span><span class="NAME">paddingLeftOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">currentFrame.frameElement.style.paddingLeft</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrameRect.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">                        </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingLeftOffset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">                        </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">currentFrameRect.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingLeftOffset</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5590</span> 
<span class='line'>5591</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentFrameRect.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">position.cropRight</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">parentFrameWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">                    </span><span class="NAME">position.cropRight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrameRect.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parentFrameWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">                </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrameRect.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">borderLeftOffset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddingLeftOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">                </span><span class="NAME">currentFrame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentFrame.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5597</span> 
<span class='line'>5598</span> </span><span class="WHIT">            </span><span class="NAME">position.cropHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">position.height</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropBottom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">            </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.height</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">            </span><span class="NAME">position.cropWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">position.width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropRight</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">            </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.width</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">            </span><span class="COMM">// set target before scaling (Mac) - target is HTML element, it is "immune" to scaling</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">            </span><span class="COMM">// 8 and 16 because of minimal width of magenta target</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockGlobals.isVideoBeingReceived</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">position.cropHeight</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">8</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">position.cropWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">16</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dockGlobals._about.capabilities.showingDockingTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">                </span><span class="NAME">dockGlobals.setTarget</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">                </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"display"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">            </span><span class="COMM">// include scale coefficient</span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">            </span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5613</span> </span><span class="WHIT">            </span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">            </span><span class="NAME">position.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">            </span><span class="NAME">position.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">            </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">            </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">            </span><span class="NAME">position.cropWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.cropWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">            </span><span class="NAME">position.cropHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">position.cropHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">            </span><span class="NAME">position.scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5621</span> 
<span class='line'>5622</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5624</span> </span><span class="WHIT">        </span><span class="NAME">sendMessageToAddOn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addOnMessageContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">                </span><span class="NAME">offsetX</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">                </span><span class="NAME">offsetY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.top</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">                </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">                </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">                </span><span class="NAME">cropOffsetX</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="WHIT">                </span><span class="NAME">cropOffsetY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">                </span><span class="NAME">cropWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.cropWidth</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5633</span> </span><span class="WHIT">                </span><span class="NAME">cropHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">position.cropHeight</span><span class="WHIT">
<span class='line'>5634</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5636</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">position.scaleCoefficient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5637</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msgName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"dockExternalWindow"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">                </span><span class="NAME">addOnMessageContent.title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame.top.document.title</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>5640</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">dockGlobals.frame.top.location.host</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame.top.location.pathname</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame.top.location.search</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5641</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5642</span> </span><span class="WHIT">                </span><span class="NAME">addOnMessageContent.pageWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.frame.top</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5643</span> </span><span class="WHIT">                </span><span class="NAME">addOnMessageContent.pageHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.frame.top</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scaleCoefficient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="NAME">msgName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">addOnMessageContent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO: couple of ms could be saved if we call _plugin.api.sendRequest directly.</span><span class="WHIT">
<span class='line'>5647</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5648</span> </span><span class="WHIT">        </span><span class="NAME">resetPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5649</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="WHIT">                </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'display'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'none'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5651</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5652</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5653</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.timeOfPreviousDocking</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5654</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5655</span> </span><span class="WHIT">        </span><span class="NAME">setTarget</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5656</span> </span><span class="WHIT">            </span><span class="COMM">// if the overlay DOM Element is only partially visible, the target should be at the top left of the visible part of the DOM Element</span><span class="WHIT">
<span class='line'>5657</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">position.bottom</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="COMM">/* magenta target height */</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">                    </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropTop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5659</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">position.right</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="COMM">/* magenta target (+ border) width */</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>5660</span> </span><span class="WHIT">                    </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">position.cropLeft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.createTargetDivIfNeeded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5662</span> </span><span class="WHIT">            </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"display"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">targetTop</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">targetLeft</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5663</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5664</span> </span><span class="WHIT">        </span><span class="NAME">createTargetDivIfNeeded</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="WHIT">                </span><span class="NAME">dockGlobals.targetDiv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame.top.document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">                </span><span class="NAME">dockGlobals.frame.top.document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="WHIT">                </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDiv</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="NAME">dockGlobals.targetDivStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5669</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5671</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5672</span> 
<span class='line'>5673</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5674</span>     * Docks an external video window created by {@link $.fn.cwic-showPreviewInExternalWindow} or {@link $.fn.cwic-showCallInExternalWindow}.&lt;br>
<span class='line'>5675</span>     * Example use:
<span class='line'>5676</span>     * @example
<span class='line'>5677</span>     * // simple case where the target video container is on the same HTML page as cwic.js file
<span class='line'>5678</span>     * $('#videocontainer').cwic('dock');
<span class='line'>5679</span>     * // or an extended form where the window object along with target element could be specified. 
<span class='line'>5680</span>     * // Window object could be from an iFrame or a popup with the same origin as "parent" page
<span class='line'>5681</span>     * $().cwic('dock', {window: windowElementOfSomeHtmlDocument, element: targetElementForVideoOverlay});
<span class='line'>5682</span>     * @param {Object} [args] Information about target element for video overlay
<span class='line'>5683</span>     * @param {DOMWindow} args.window Window object in which the target element is located
<span class='line'>5684</span>     * @param {DOMElement} args.element Target element for video overlay
<span class='line'>5685</span>     * @since 3.1.2
<span class='line'>5686</span>     */</span><span class="WHIT">
<span class='line'>5687</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">dock</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5689</span> </span><span class="WHIT">            </span><span class="NAME">frame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.window</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5690</span> </span><span class="WHIT">            </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">args.element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5691</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">        </span><span class="NAME">dockGlobals._about</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5693</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5694</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockGlobals.hasDockingCapabilities</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">frame.HTMLElement</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5695</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.isDocked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5696</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'dock'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5697</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.resetPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.frame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frame</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5700</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.sendMessageToAddOn</span><span class="PUNC">(</span><span class="STRN">"dockExternalWindow"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">                    </span><span class="NAME">dockGlobals.updateOffsets</span><span class="PUNC">(</span><span class="NAME">dockGlobals.element.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.frame.requestAnimationFrame</span><span class="PUNC">(</span><span class="NAME">dockGlobals.move</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dockGlobals.hasDockingCapabilities</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5704</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.DockingCapabilitiesNotAvailable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5705</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">frame.HTMLElement</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5706</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.DockArgumentNotHTMLElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5707</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5708</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5710</span> 
<span class='line'>5711</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5712</span>     * Undocks an external video window previously docked by {@link $.fn.cwic-dock}&lt;br>
<span class='line'>5713</span>     * Example use:
<span class='line'>5714</span>     * @example
<span class='line'>5715</span>     * $('#videocontainer').cwic('undock');
<span class='line'>5716</span>     * // or:
<span class='line'>5717</span>     * $(document).cwic('undock');
<span class='line'>5718</span>     * // or:
<span class='line'>5719</span>     * $().cwic('undock');
<span class='line'>5720</span>     * @since 3.1.2
<span class='line'>5721</span>     */</span><span class="WHIT">
<span class='line'>5722</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">undock</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5723</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Undocking ...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5724</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5725</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dockGlobals.hasDockingCapabilities</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dockGlobals.isDocked</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5726</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'undock'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5727</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.resetPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5728</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Setting isDocked to false'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="WHIT">            </span><span class="NAME">dockGlobals.isDocked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="WHIT">            </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'undockExternalWindow'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dockGlobals.hasDockingCapabilities</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5732</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.DockingCapabilitiesNotAvailable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5733</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5734</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5735</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5736</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5737</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>5738</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">_triggerDockExternalWindowNeeded</span><span class="PUNC">(</span><span class="NAME">$this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5739</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dockArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">window</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dockGlobals.frame</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dockGlobals.element</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5740</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">        </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Sending new "dock" message with parameters: '</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dockArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>5743</span> </span><span class="WHIT">        </span><span class="NAME">dock</span><span class="PUNC">(</span><span class="NAME">dockArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5745</span> 
<span class='line'>5746</span> </span><span class="WHIT">    </span><span class="COMM">/** @description Gets the current user authorization status.
<span class='line'>5747</span>     * @since 3.0.1
<span class='line'>5748</span>     * @returns {String} a value indicating the current user authorization status.
<span class='line'>5749</span>     * &lt;ul>
<span class='line'>5750</span>     * &lt;li>"UserAuthorized" indicates the user has authorized the Cisco Web Communicator add-on and it is ready to use.&lt;/li>
<span class='line'>5751</span>     * &lt;li>"MustShowAuth" indicates the application must call {@link $.fn.cwic-showUserAuthorization} to show the user authorization dialog.&lt;/li>
<span class='line'>5752</span>     * &lt;li>"UserDenied" indicates the user has denied the application access to the Cisco Web Communicator add-on.&lt;/li>
<span class='line'>5753</span>     * &lt;li>"UserAuthPending" indicates the dialog box is currently displayed and the user has not yet selected "allow", "deny", or "always allow".&lt;/li>
<span class='line'>5754</span>     * &lt;li>"Unknown" indicates status cannot be determined because delay authorization feature is not supported by the current Cisco Web Communicator add-on.
<span class='line'>5755</span>     * This case will trigger {@link $.fn.cwic-errorMap.OperationNotSupported} as well.&lt;/li>
<span class='line'>5756</span>     * &lt;/ul>
<span class='line'>5757</span>     */</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getUserAuthStatus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5760</span> 
<span class='line'>5761</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ab.capabilities.delayedUserAuth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.OperationNotSupported</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Check cwic("about").capabilities.delayedUserAuth'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5763</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'Unknown'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5764</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5765</span> 
<span class='line'>5766</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_plugin.userAuthStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5767</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5768</span> </span><span class="WHIT">    </span><span class="COMM">/** @description Shows the user authorization dialog.  This API must only be called if the application has provided a delayedUserAuth callback
<span class='line'>5769</span>     * in the settings object provided to the init function, and the status returned by {@link $.fn.cwic-getUserAuthStatus} is "MustShowAuth"  If the application
<span class='line'>5770</span>     * receives the {@link $.fn.cwic-settings.delayedUserAuth} callback, the user authorization state will always be "MustShowAuth" so the application can safely call
<span class='line'>5771</span>     * showUserAuthorization from within the delayedUserAuth callback without checking getUserAuthStatus.
<span class='line'>5772</span>     * @since 3.0.1
<span class='line'>5773</span>     * @param {Function} denied A callback that will be called if the user selects "deny" from the user authorization dialog.  If the user
<span class='line'>5774</span>     * selects allow or always allow, the settings.ready callback will be called.
<span class='line'>5775</span>     * @param {Boolean} [force=false] Since 3.1.0 &lt;br>
<span class='line'>5776</span>     * Set &lt;tt>true&lt;/tt> to force the dialog to display even if the page is currently hidden.
<span class='line'>5777</span>     * Setting this may cause the dialog to appear when the page is not yet accessible to the user.
<span class='line'>5778</span>     */</span><span class="WHIT">
<span class='line'>5779</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showUserAuthorization</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">args.denied</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">$.isFunction</span><span class="PUNC">(</span><span class="NAME">args.denied</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5781</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorMap.InvalidArguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'showUserAuthorization: wrong arguments'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5782</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5783</span> 
<span class='line'>5784</span> </span><span class="WHIT">        </span><span class="COMM">// if page is not visible, then wait for visibilitychange event and retry showUserAuthorization</span><span class="WHIT">
<span class='line'>5785</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.hidden</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">args.force</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5786</span> </span><span class="WHIT">            </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'showUserAuthorization deferred with visibilityState: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.visibilityState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5787</span> </span><span class="WHIT">            </span><span class="NAME">_addListener</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">'visibilitychange'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">handleVisibilityChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5788</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.hidden</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">                    </span><span class="COMM">// show deferred dialog and remove listener</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="WHIT">                    </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">'showUserAuthorization detected visibilitychange from hidden to '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.visibilityState</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">                    </span><span class="NAME">showUserAuthorization</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5792</span> </span><span class="WHIT">                    </span><span class="NAME">_removeListener</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">'visibilitychange'</span><span class="PUNC">,</span><span class="NAME">handleVisibilityChange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5793</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5794</span> </span><span class="WHIT">                </span><span class="COMM">// else continue listening for 'visibilitychange' until not hidden</span><span class="WHIT">
<span class='line'>5795</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5796</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5798</span> 
<span class='line'>5799</span> </span><span class="WHIT">        </span><span class="NAME">_sendClientRequest</span><span class="PUNC">(</span><span class="STRN">'showUserAuthorization'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5800</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.deniedCb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.denied</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5801</span> </span><span class="WHIT">            </span><span class="NAME">_plugin.userAuthStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'UserAuthPending'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5803</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5804</span> 
<span class='line'>5805</span> </span><span class="WHIT">    </span><span class="COMM">// a map with all exposed methods</span><span class="WHIT">
<span class='line'>5806</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">methods</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5807</span> </span><span class="WHIT">        </span><span class="NAME">about</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">about</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5808</span> </span><span class="WHIT">        </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">init</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5809</span> </span><span class="WHIT">        </span><span class="NAME">shutdown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">shutdown</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5810</span> </span><span class="WHIT">        </span><span class="NAME">rebootIfBroken</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rebootIfBroken</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="WHIT">        </span><span class="NAME">registerPhone</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registerPhone</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="WHIT">        </span><span class="NAME">manualSignIn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">registerPhone</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5813</span> </span><span class="WHIT">        </span><span class="NAME">switchPhoneMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">switchPhoneMode</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5814</span> </span><span class="WHIT">        </span><span class="NAME">unregisterPhone</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">unregisterPhone</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5815</span> </span><span class="WHIT">        </span><span class="NAME">startConversation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">startConversation</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5816</span> </span><span class="WHIT">        </span><span class="NAME">updateConversation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">updateConversation</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5817</span> </span><span class="WHIT">        </span><span class="NAME">endConversation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endConversation</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5818</span> </span><span class="WHIT">        </span><span class="NAME">createVideoWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">createVideoWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5819</span> </span><span class="WHIT">        </span><span class="NAME">addPreviewWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">addPreviewWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5820</span> </span><span class="WHIT">        </span><span class="NAME">removePreviewWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">removePreviewWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5821</span> </span><span class="WHIT">        </span><span class="NAME">sendDTMF</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sendDTMF</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="WHIT">        </span><span class="NAME">getInstanceId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getInstanceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="WHIT">        </span><span class="NAME">getMultimediaDevices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getMultimediaDevices</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5824</span> </span><span class="WHIT">        </span><span class="NAME">setRecordingDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setRecordingDevice</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5825</span> </span><span class="WHIT">        </span><span class="NAME">setPlayoutDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setPlayoutDevice</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5826</span> </span><span class="WHIT">        </span><span class="NAME">setCaptureDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setCaptureDevice</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5827</span> </span><span class="WHIT">        </span><span class="NAME">setRingerDevice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setRingerDevice</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5828</span> </span><span class="WHIT">        </span><span class="NAME">getUserAuthStatus</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getUserAuthStatus</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5829</span> </span><span class="WHIT">        </span><span class="NAME">showUserAuthorization</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showUserAuthorization</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5830</span> </span><span class="WHIT">        </span><span class="NAME">showCallInExternalWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showCallInExternalWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5831</span> </span><span class="WHIT">        </span><span class="NAME">hideExternalWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">hideExternalWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5832</span> </span><span class="WHIT">        </span><span class="NAME">showPreviewInExternalWindow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showPreviewInExternalWindow</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5833</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowAlwaysOnTop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowAlwaysOnTop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5834</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowShowSelfViewPip</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowSelfViewPip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5835</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowShowControls</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowControls</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowTitle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowTitle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5837</span> </span><span class="WHIT">        </span><span class="NAME">getExternalWindowState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getExternalWindowState</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5838</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowSelfViewPipPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowSelfViewPipPosition</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5839</span> </span><span class="WHIT">        </span><span class="NAME">setExternalWindowShowSelfViewPipBorder</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setExternalWindowShowSelfViewPipBorder</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5840</span> </span><span class="WHIT">        </span><span class="NAME">dock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dock</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5841</span> </span><span class="WHIT">        </span><span class="NAME">undock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undock</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5842</span> </span><span class="WHIT">        </span><span class="NAME">startDiscovery</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">startDiscovery</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5843</span> </span><span class="WHIT">        </span><span class="NAME">cancelSSO</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">cancelSSO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5844</span> </span><span class="WHIT">        </span><span class="NAME">resetData</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resetData</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5845</span> </span><span class="WHIT">        </span><span class="NAME">signOut</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">signOut</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5846</span> </span><span class="WHIT">        </span><span class="NAME">setSpeakerVolume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setSpeakerVolume</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5847</span> </span><span class="WHIT">        </span><span class="NAME">setRingerVolume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setRingerVolume</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5848</span> </span><span class="WHIT">        </span><span class="NAME">setMicrophoneVolume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setMicrophoneVolume</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5849</span> </span><span class="WHIT">        </span><span class="NAME">setRingtone</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setRingtone</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5850</span> </span><span class="WHIT">        </span><span class="NAME">setPlayRingerOnAllDevices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setPlayRingerOnAllDevices</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5851</span> </span><span class="WHIT">        </span><span class="NAME">getMultimediaDeviceVolume</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getMultimediaDeviceVolume</span><span class="WHIT">
<span class='line'>5852</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5853</span> 
<span class='line'>5854</span> </span><span class="WHIT">    </span><span class="COMM">// the jQuery plugin</span><span class="WHIT">
<span class='line'>5855</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5856</span>     * @description
<span class='line'>5857</span>     * CWIC is a jQuery plug-in to access the Cisco Web Communicator&lt;br>
<span class='line'>5858</span>     * Audio and Video media require the Cisco Web Communicator add-on to be installed &lt;br>
<span class='line'>5859</span>     * &lt;h3>Fields overview&lt;/h3>
<span class='line'>5860</span>     * &lt;h3>Methods overview&lt;/h3>
<span class='line'>5861</span>     * All cwic methods are called in the following manner&lt;br>
<span class='line'>5862</span>     * &lt;pre class="code">$('#selector').cwic('method',parameters)&lt;/pre>&lt;br>
<span class='line'>5863</span>     * &lt;h3>Events overview&lt;/h3>
<span class='line'>5864</span>     * All events are part of the cwic namespace.  For example:
<span class='line'>5865</span>     * &lt;ul>
<span class='line'>5866</span>     * &lt;li>conversationStart.cwic&lt;/li>
<span class='line'>5867</span>     * &lt;li>system.cwic&lt;/li>
<span class='line'>5868</span>     * &lt;li>error.cwic&lt;/li>
<span class='line'>5869</span>     * &lt;/ul>
<span class='line'>5870</span>     * &lt;h4>Example conversation events:&lt;/h4>
<span class='line'>5871</span>     * These are conversation-related events that can be triggered by the SDK.&lt;br>
<span class='line'>5872</span>     * The event handlers are passed the conversation properties as a single object. For example:&lt;br>
<span class='line'>5873</span>     * @example
<span class='line'>5874</span>     * // start an audio conversation with phone a number and bind to conversation events
<span class='line'>5875</span>     * jQuery('#conversation')
<span class='line'>5876</span>     *   .cwic('startConversation', '+1 234 567')  // container defaults to $(this)
<span class='line'>5877</span>     *   .bind('conversationStart.cwic', function(event, conversation, container) {
<span class='line'>5878</span>     *      console.log('conversation has just started');
<span class='line'>5879</span>     *      // container is jQuery('#conversation')
<span class='line'>5880</span>     *    })
<span class='line'>5881</span>     *    .bind('conversationUpdate.cwic', function(event, conversation) {
<span class='line'>5882</span>     *      console.log('conversation has just been updated');
<span class='line'>5883</span>     *    })
<span class='line'>5884</span>     *    .bind('conversationEnd.cwic', function(event, conversation) {
<span class='line'>5885</span>     *      console.log('conversation has just ended');
<span class='line'>5886</span>     *    });
<span class='line'>5887</span>     * @example
<span class='line'>5888</span>     * // listen for incoming conversation
<span class='line'>5889</span>     * jQuery('#phone')
<span class='line'>5890</span>     *   .bind('conversationIncoming.cwic', function(event, conversation, container) {
<span class='line'>5891</span>     *     console.log('incoming conversation with id ' + conversation.id);
<span class='line'>5892</span>     *     // attach the 'toast' container to the DOM and bind to events
<span class='line'>5893</span>     *     container
<span class='line'>5894</span>     *       .appendTo('#phone')
<span class='line'>5895</span>     *       .bind('conversationUpdate.cwic', function(event, conversation) {
<span class='line'>5896</span>     *         // update on incoming conversation
<span class='line'>5897</span>     *       })
<span class='line'>5898</span>     *       .bind('conversationEnd.cwic', function(event, conversation) {
<span class='line'>5899</span>     *         // incoming conversation has ended
<span class='line'>5900</span>     *         container.remove();
<span class='line'>5901</span>     *       });
<span class='line'>5902</span>     *     // suppose UI has a button with id 'answer'
<span class='line'>5903</span>     *     jQuery('#answer').click(function() {
<span class='line'>5904</span>     *       // answer the incoming conversation
<span class='line'>5905</span>     *       // conversation has an id property, so startConversation accepts it
<span class='line'>5906</span>     *       // use element #conversation as container
<span class='line'>5907</span>     *       jQuery('#conversation').cwic('startConversation', conversation);
<span class='line'>5908</span>     *       // remove incoming container
<span class='line'>5909</span>     *       container.remove();
<span class='line'>5910</span>     *     });
<span class='line'>5911</span>     *   });
<span class='line'>5912</span>     * @class
<span class='line'>5913</span>     * @static
<span class='line'>5914</span>     * @param {String} method The name of the method to call
<span class='line'>5915</span>     * @param {Variable} arguments trailing arguments are passed to the specific call see methods below
<span class='line'>5916</span>     */</span><span class="WHIT">
<span class='line'>5917</span> </span><span class="WHIT">    </span><span class="NAME">$.fn.cwic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5918</span> 
<span class='line'>5919</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5920</span> </span><span class="WHIT">            </span><span class="COMM">// Method calling logic</span><span class="WHIT">
<span class='line'>5921</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">methods</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">methods</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">method</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">method</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">methods.init.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">method</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">': no such method on jQuery.cwic'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5927</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5928</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5929</span> </span><span class="WHIT">        </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5930</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5931</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.trace</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5932</span> </span><span class="WHIT">                    </span><span class="NAME">console.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5933</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5934</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">console.log</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5935</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Exception occured in $.fn.cwic() '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5936</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5937</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5938</span> </span><span class="WHIT">            </span><span class="NAME">_triggerError</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5939</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5940</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5941</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jQuery</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5942</span> </span></pre></body></html>